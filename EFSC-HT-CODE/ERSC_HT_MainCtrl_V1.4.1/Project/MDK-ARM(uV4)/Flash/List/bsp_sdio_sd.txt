; generated by Component: ARM Compiler 5.06 update 6 (build 750) Tool: ArmCC [4d3637]
; commandline ArmCC [--c99 --list --split_sections --debug -c --asm --interleave -o.\flash\obj\bsp_sdio_sd.o --asm_dir=.\Flash\List\ --list_dir=.\Flash\List\ --depend=.\flash\obj\bsp_sdio_sd.d --cpu=Cortex-M3 --apcs=interwork -O0 --diag_suppress=9931,870 -I..\..\Libraries\CMSIS\Device\ST\STM32F10x\Include -I..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\Libraries\CMSIS\Include -I..\..\User\bsp -I..\..\User\bsp\inc -I..\..\User\app\inc -I..\..\User\FatFS\src -I..\..\User\Mass_Storage\inc -I..\..\User\LCD_Driver -I..\..\User\SYSTEM\sys -I..\..\User\Debugprintf -I..\..\User\LogDebug -I..\..\User\app\inc -I..\..\User\app\src -I..\..\User\bsp\inc -I..\..\User\bsp\src -I.\RTE\_Flash -ID:\Keil_v5\ARM\Packs\ARM\CMSIS\5.5.1\CMSIS\Core\Include -ID:\Keil_v5\ARM\Packs\Keil\STM32F1xx_DFP\2.1.0\Device\Include -D__MICROLIB -D__UVISION_VERSION=527 -D_RTE_ -DSTM32F10X_HD -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD --omf_browse=.\flash\obj\bsp_sdio_sd.crf ..\..\User\bsp\src\bsp_sdio_sd.c]
                          THUMB

                          AREA ||i.CmdError||, CODE, READONLY, ALIGN=1

                  CmdError PROC
;;;2084     */
;;;2085   static SD_Error CmdError(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2086   {
;;;2087     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2088     uint32_t timeout;
;;;2089   
;;;2090     timeout = SDIO_CMD0TIMEOUT; /*!< 10000 */
000004  f44f3480          MOV      r4,#0x10000
;;;2091   
;;;2092     while ((timeout > 0) && (SDIO_GetFlagStatus(SDIO_FLAG_CMDSENT) == RESET))
000008  e000              B        |L1.12|
                  |L1.10|
;;;2093     {
;;;2094       timeout--;
00000a  1e64              SUBS     r4,r4,#1
                  |L1.12|
00000c  b124              CBZ      r4,|L1.24|
00000e  2080              MOVS     r0,#0x80              ;2092
000010  f7fffffe          BL       SDIO_GetFlagStatus
000014  2800              CMP      r0,#0                 ;2092
000016  d0f8              BEQ      |L1.10|
                  |L1.24|
;;;2095     }
;;;2096   
;;;2097     if (timeout == 0)
000018  b914              CBNZ     r4,|L1.32|
;;;2098     {
;;;2099       errorstatus = SD_CMD_RSP_TIMEOUT;
00001a  2503              MOVS     r5,#3
;;;2100       return(errorstatus);
00001c  4628              MOV      r0,r5
                  |L1.30|
;;;2101     }
;;;2102   
;;;2103     /*!< Clear all the static flags */
;;;2104     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2105   
;;;2106     return(errorstatus);
;;;2107   }
00001e  bd70              POP      {r4-r6,pc}
                  |L1.32|
000020  f24050ff          MOV      r0,#0x5ff             ;2104
000024  f7fffffe          BL       SDIO_ClearFlag
000028  4628              MOV      r0,r5                 ;2106
00002a  e7f8              B        |L1.30|
;;;2108   
                          ENDP


                          AREA ||i.CmdResp1Error||, CODE, READONLY, ALIGN=2

                  CmdResp1Error PROC
;;;2150     */
;;;2151   static SD_Error CmdResp1Error(uint8_t cmd)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2152   {
000004  4606              MOV      r6,r0
;;;2153     SD_Error errorstatus = SD_OK;
000006  2700              MOVS     r7,#0
;;;2154     uint32_t status;
;;;2155     uint32_t response_r1;
;;;2156   
;;;2157     status = SDIO->STA;
000008  4848              LDR      r0,|L2.300|
00000a  6b45              LDR      r5,[r0,#0x34]
;;;2158   
;;;2159     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
00000c  e001              B        |L2.18|
                  |L2.14|
;;;2160     {
;;;2161       status = SDIO->STA;
00000e  4847              LDR      r0,|L2.300|
000010  6b45              LDR      r5,[r0,#0x34]
                  |L2.18|
000012  f0050045          AND      r0,r5,#0x45           ;2159
000016  2800              CMP      r0,#0                 ;2159
000018  d0f9              BEQ      |L2.14|
;;;2162     }
;;;2163   
;;;2164     if (status & SDIO_FLAG_CTIMEOUT)
00001a  f0050004          AND      r0,r5,#4
00001e  b130              CBZ      r0,|L2.46|
;;;2165     {
;;;2166       errorstatus = SD_CMD_RSP_TIMEOUT;
000020  2703              MOVS     r7,#3
;;;2167       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000022  2004              MOVS     r0,#4
000024  f7fffffe          BL       SDIO_ClearFlag
;;;2168       return(errorstatus);
000028  4638              MOV      r0,r7
                  |L2.42|
;;;2169     }
;;;2170     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2171     {
;;;2172       errorstatus = SD_CMD_CRC_FAIL;
;;;2173       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2174       return(errorstatus);
;;;2175     }
;;;2176   
;;;2177     /*!< Check response received is of desired command */
;;;2178     if (SDIO_GetCommandResponse() != cmd)
;;;2179     {
;;;2180       errorstatus = SD_ILLEGAL_CMD;
;;;2181       return(errorstatus);
;;;2182     }
;;;2183   
;;;2184     /*!< Clear all the static flags */
;;;2185     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2186   
;;;2187     /*!< We have received response, retrieve it for analysis  */
;;;2188     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2189   
;;;2190     if ((response_r1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2191     {
;;;2192       return(errorstatus);
;;;2193     }
;;;2194   
;;;2195     if (response_r1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2196     {
;;;2197       return(SD_ADDR_OUT_OF_RANGE);
;;;2198     }
;;;2199   
;;;2200     if (response_r1 & SD_OCR_ADDR_MISALIGNED)
;;;2201     {
;;;2202       return(SD_ADDR_MISALIGNED);
;;;2203     }
;;;2204   
;;;2205     if (response_r1 & SD_OCR_BLOCK_LEN_ERR)
;;;2206     {
;;;2207       return(SD_BLOCK_LEN_ERR);
;;;2208     }
;;;2209   
;;;2210     if (response_r1 & SD_OCR_ERASE_SEQ_ERR)
;;;2211     {
;;;2212       return(SD_ERASE_SEQ_ERR);
;;;2213     }
;;;2214   
;;;2215     if (response_r1 & SD_OCR_BAD_ERASE_PARAM)
;;;2216     {
;;;2217       return(SD_BAD_ERASE_PARAM);
;;;2218     }
;;;2219   
;;;2220     if (response_r1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2221     {
;;;2222       return(SD_WRITE_PROT_VIOLATION);
;;;2223     }
;;;2224   
;;;2225     if (response_r1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2226     {
;;;2227       return(SD_LOCK_UNLOCK_FAILED);
;;;2228     }
;;;2229   
;;;2230     if (response_r1 & SD_OCR_COM_CRC_FAILED)
;;;2231     {
;;;2232       return(SD_COM_CRC_FAILED);
;;;2233     }
;;;2234   
;;;2235     if (response_r1 & SD_OCR_ILLEGAL_CMD)
;;;2236     {
;;;2237       return(SD_ILLEGAL_CMD);
;;;2238     }
;;;2239   
;;;2240     if (response_r1 & SD_OCR_CARD_ECC_FAILED)
;;;2241     {
;;;2242       return(SD_CARD_ECC_FAILED);
;;;2243     }
;;;2244   
;;;2245     if (response_r1 & SD_OCR_CC_ERROR)
;;;2246     {
;;;2247       return(SD_CC_ERROR);
;;;2248     }
;;;2249   
;;;2250     if (response_r1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2251     {
;;;2252       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2253     }
;;;2254   
;;;2255     if (response_r1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2256     {
;;;2257       return(SD_STREAM_READ_UNDERRUN);
;;;2258     }
;;;2259   
;;;2260     if (response_r1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2261     {
;;;2262       return(SD_STREAM_WRITE_OVERRUN);
;;;2263     }
;;;2264   
;;;2265     if (response_r1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2266     {
;;;2267       return(SD_CID_CSD_OVERWRITE);
;;;2268     }
;;;2269   
;;;2270     if (response_r1 & SD_OCR_WP_ERASE_SKIP)
;;;2271     {
;;;2272       return(SD_WP_ERASE_SKIP);
;;;2273     }
;;;2274   
;;;2275     if (response_r1 & SD_OCR_CARD_ECC_DISABLED)
;;;2276     {
;;;2277       return(SD_CARD_ECC_DISABLED);
;;;2278     }
;;;2279   
;;;2280     if (response_r1 & SD_OCR_ERASE_RESET)
;;;2281     {
;;;2282       return(SD_ERASE_RESET);
;;;2283     }
;;;2284   
;;;2285     if (response_r1 & SD_OCR_AKE_SEQ_ERROR)
;;;2286     {
;;;2287       return(SD_AKE_SEQ_ERROR);
;;;2288     }
;;;2289     return(errorstatus);
;;;2290   }
00002a  e8bd81f0          POP      {r4-r8,pc}
                  |L2.46|
00002e  f0050001          AND      r0,r5,#1              ;2170
000032  b128              CBZ      r0,|L2.64|
000034  2701              MOVS     r7,#1                 ;2172
000036  2001              MOVS     r0,#1                 ;2173
000038  f7fffffe          BL       SDIO_ClearFlag
00003c  4638              MOV      r0,r7                 ;2174
00003e  e7f4              B        |L2.42|
                  |L2.64|
000040  f7fffffe          BL       SDIO_GetCommandResponse
000044  42b0              CMP      r0,r6                 ;2178
000046  d002              BEQ      |L2.78|
000048  2710              MOVS     r7,#0x10              ;2180
00004a  4638              MOV      r0,r7                 ;2181
00004c  e7ed              B        |L2.42|
                  |L2.78|
00004e  f24050ff          MOV      r0,#0x5ff             ;2185
000052  f7fffffe          BL       SDIO_ClearFlag
000056  2000              MOVS     r0,#0                 ;2188
000058  f7fffffe          BL       SDIO_GetResponse
00005c  4604              MOV      r4,r0                 ;2188
00005e  4834              LDR      r0,|L2.304|
000060  4020              ANDS     r0,r0,r4              ;2190
000062  b908              CBNZ     r0,|L2.104|
000064  4638              MOV      r0,r7                 ;2192
000066  e7e0              B        |L2.42|
                  |L2.104|
000068  f0044000          AND      r0,r4,#0x80000000     ;2195
00006c  b108              CBZ      r0,|L2.114|
00006e  201c              MOVS     r0,#0x1c              ;2197
000070  e7db              B        |L2.42|
                  |L2.114|
000072  f0044080          AND      r0,r4,#0x40000000     ;2200
000076  b108              CBZ      r0,|L2.124|
000078  2009              MOVS     r0,#9                 ;2202
00007a  e7d6              B        |L2.42|
                  |L2.124|
00007c  f0045000          AND      r0,r4,#0x20000000     ;2205
000080  b108              CBZ      r0,|L2.134|
000082  200a              MOVS     r0,#0xa               ;2207
000084  e7d1              B        |L2.42|
                  |L2.134|
000086  f0045080          AND      r0,r4,#0x10000000     ;2210
00008a  b108              CBZ      r0,|L2.144|
00008c  200b              MOVS     r0,#0xb               ;2212
00008e  e7cc              B        |L2.42|
                  |L2.144|
000090  f0046000          AND      r0,r4,#0x8000000      ;2215
000094  b108              CBZ      r0,|L2.154|
000096  200c              MOVS     r0,#0xc               ;2217
000098  e7c7              B        |L2.42|
                  |L2.154|
00009a  f0046080          AND      r0,r4,#0x4000000      ;2220
00009e  b108              CBZ      r0,|L2.164|
0000a0  200d              MOVS     r0,#0xd               ;2222
0000a2  e7c2              B        |L2.42|
                  |L2.164|
0000a4  f0047080          AND      r0,r4,#0x1000000      ;2225
0000a8  b108              CBZ      r0,|L2.174|
0000aa  200e              MOVS     r0,#0xe               ;2227
0000ac  e7bd              B        |L2.42|
                  |L2.174|
0000ae  f4040000          AND      r0,r4,#0x800000       ;2230
0000b2  b108              CBZ      r0,|L2.184|
0000b4  200f              MOVS     r0,#0xf               ;2232
0000b6  e7b8              B        |L2.42|
                  |L2.184|
0000b8  f4040080          AND      r0,r4,#0x400000       ;2235
0000bc  b108              CBZ      r0,|L2.194|
0000be  2010              MOVS     r0,#0x10              ;2237
0000c0  e7b3              B        |L2.42|
                  |L2.194|
0000c2  f4041000          AND      r0,r4,#0x200000       ;2240
0000c6  b108              CBZ      r0,|L2.204|
0000c8  2011              MOVS     r0,#0x11              ;2242
0000ca  e7ae              B        |L2.42|
                  |L2.204|
0000cc  f4041080          AND      r0,r4,#0x100000       ;2245
0000d0  b108              CBZ      r0,|L2.214|
0000d2  2012              MOVS     r0,#0x12              ;2247
0000d4  e7a9              B        |L2.42|
                  |L2.214|
0000d6  f4042000          AND      r0,r4,#0x80000        ;2250
0000da  b108              CBZ      r0,|L2.224|
0000dc  2013              MOVS     r0,#0x13              ;2252
0000de  e7a4              B        |L2.42|
                  |L2.224|
0000e0  f4042080          AND      r0,r4,#0x40000        ;2255
0000e4  b108              CBZ      r0,|L2.234|
0000e6  2014              MOVS     r0,#0x14              ;2257
0000e8  e79f              B        |L2.42|
                  |L2.234|
0000ea  f4043000          AND      r0,r4,#0x20000        ;2260
0000ee  b108              CBZ      r0,|L2.244|
0000f0  2015              MOVS     r0,#0x15              ;2262
0000f2  e79a              B        |L2.42|
                  |L2.244|
0000f4  f4043080          AND      r0,r4,#0x10000        ;2265
0000f8  b108              CBZ      r0,|L2.254|
0000fa  2016              MOVS     r0,#0x16              ;2267
0000fc  e795              B        |L2.42|
                  |L2.254|
0000fe  f4044000          AND      r0,r4,#0x8000         ;2270
000102  b108              CBZ      r0,|L2.264|
000104  2017              MOVS     r0,#0x17              ;2272
000106  e790              B        |L2.42|
                  |L2.264|
000108  f4044080          AND      r0,r4,#0x4000         ;2275
00010c  b108              CBZ      r0,|L2.274|
00010e  2018              MOVS     r0,#0x18              ;2277
000110  e78b              B        |L2.42|
                  |L2.274|
000112  f4045000          AND      r0,r4,#0x2000         ;2280
000116  b108              CBZ      r0,|L2.284|
000118  2019              MOVS     r0,#0x19              ;2282
00011a  e786              B        |L2.42|
                  |L2.284|
00011c  f0040008          AND      r0,r4,#8              ;2285
000120  b108              CBZ      r0,|L2.294|
000122  201a              MOVS     r0,#0x1a              ;2287
000124  e781              B        |L2.42|
                  |L2.294|
000126  4638              MOV      r0,r7                 ;2289
000128  e77f              B        |L2.42|
;;;2291   
                          ENDP

00012a  0000              DCW      0x0000
                  |L2.300|
                          DCD      0x40018000
                  |L2.304|
                          DCD      0xfdffe008

                          AREA ||i.CmdResp2Error||, CODE, READONLY, ALIGN=2

                  CmdResp2Error PROC
;;;2324     */
;;;2325   static SD_Error CmdResp2Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2326   {
;;;2327     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2328     uint32_t status;
;;;2329   
;;;2330     status = SDIO->STA;
000004  4810              LDR      r0,|L3.72|
000006  6b44              LDR      r4,[r0,#0x34]
;;;2331   
;;;2332     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000008  e001              B        |L3.14|
                  |L3.10|
;;;2333     {
;;;2334       status = SDIO->STA;
00000a  480f              LDR      r0,|L3.72|
00000c  6b44              LDR      r4,[r0,#0x34]
                  |L3.14|
00000e  f0040045          AND      r0,r4,#0x45           ;2332
000012  2800              CMP      r0,#0                 ;2332
000014  d0f9              BEQ      |L3.10|
;;;2335     }
;;;2336   
;;;2337     if (status & SDIO_FLAG_CTIMEOUT)
000016  f0040004          AND      r0,r4,#4
00001a  b128              CBZ      r0,|L3.40|
;;;2338     {
;;;2339       errorstatus = SD_CMD_RSP_TIMEOUT;
00001c  2503              MOVS     r5,#3
;;;2340       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001e  2004              MOVS     r0,#4
000020  f7fffffe          BL       SDIO_ClearFlag
;;;2341       return(errorstatus);
000024  4628              MOV      r0,r5
                  |L3.38|
;;;2342     }
;;;2343     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2344     {
;;;2345       errorstatus = SD_CMD_CRC_FAIL;
;;;2346       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2347       return(errorstatus);
;;;2348     }
;;;2349   
;;;2350     /*!< Clear all the static flags */
;;;2351     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2352   
;;;2353     return(errorstatus);
;;;2354   }
000026  bd70              POP      {r4-r6,pc}
                  |L3.40|
000028  f0040001          AND      r0,r4,#1              ;2343
00002c  b128              CBZ      r0,|L3.58|
00002e  2501              MOVS     r5,#1                 ;2345
000030  2001              MOVS     r0,#1                 ;2346
000032  f7fffffe          BL       SDIO_ClearFlag
000036  4628              MOV      r0,r5                 ;2347
000038  e7f5              B        |L3.38|
                  |L3.58|
00003a  f24050ff          MOV      r0,#0x5ff             ;2351
00003e  f7fffffe          BL       SDIO_ClearFlag
000042  4628              MOV      r0,r5                 ;2353
000044  e7ef              B        |L3.38|
;;;2355   
                          ENDP

000046  0000              DCW      0x0000
                  |L3.72|
                          DCD      0x40018000

                          AREA ||i.CmdResp3Error||, CODE, READONLY, ALIGN=2

                  CmdResp3Error PROC
;;;2296     */
;;;2297   static SD_Error CmdResp3Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2298   {
;;;2299     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;2300     uint32_t status;
;;;2301   
;;;2302     status = SDIO->STA;
000004  480b              LDR      r0,|L4.52|
000006  6b44              LDR      r4,[r0,#0x34]
;;;2303   
;;;2304     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000008  e001              B        |L4.14|
                  |L4.10|
;;;2305     {
;;;2306       status = SDIO->STA;
00000a  480a              LDR      r0,|L4.52|
00000c  6b44              LDR      r4,[r0,#0x34]
                  |L4.14|
00000e  f0040045          AND      r0,r4,#0x45           ;2304
000012  2800              CMP      r0,#0                 ;2304
000014  d0f9              BEQ      |L4.10|
;;;2307     }
;;;2308   
;;;2309     if (status & SDIO_FLAG_CTIMEOUT)
000016  f0040004          AND      r0,r4,#4
00001a  b128              CBZ      r0,|L4.40|
;;;2310     {
;;;2311       errorstatus = SD_CMD_RSP_TIMEOUT;
00001c  2503              MOVS     r5,#3
;;;2312       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
00001e  2004              MOVS     r0,#4
000020  f7fffffe          BL       SDIO_ClearFlag
;;;2313       return(errorstatus);
000024  4628              MOV      r0,r5
                  |L4.38|
;;;2314     }
;;;2315     /*!< Clear all the static flags */
;;;2316     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2317     return(errorstatus);
;;;2318   }
000026  bd70              POP      {r4-r6,pc}
                  |L4.40|
000028  f24050ff          MOV      r0,#0x5ff             ;2316
00002c  f7fffffe          BL       SDIO_ClearFlag
000030  4628              MOV      r0,r5                 ;2317
000032  e7f8              B        |L4.38|
;;;2319   
                          ENDP

                  |L4.52|
                          DCD      0x40018000

                          AREA ||i.CmdResp6Error||, CODE, READONLY, ALIGN=2

                  CmdResp6Error PROC
;;;2362     */
;;;2363   static SD_Error CmdResp6Error(uint8_t cmd, uint16_t *prca)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;2364   {
000004  4606              MOV      r6,r0
000006  460f              MOV      r7,r1
;;;2365     SD_Error errorstatus = SD_OK;
000008  f04f0800          MOV      r8,#0
;;;2366     uint32_t status;
;;;2367     uint32_t response_r1;
;;;2368   
;;;2369     status = SDIO->STA;
00000c  4822              LDR      r0,|L5.152|
00000e  6b45              LDR      r5,[r0,#0x34]
;;;2370   
;;;2371     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CTIMEOUT | SDIO_FLAG_CMDREND)))
000010  e001              B        |L5.22|
                  |L5.18|
;;;2372     {
;;;2373       status = SDIO->STA;
000012  4821              LDR      r0,|L5.152|
000014  6b45              LDR      r5,[r0,#0x34]
                  |L5.22|
000016  f0050045          AND      r0,r5,#0x45           ;2371
00001a  2800              CMP      r0,#0                 ;2371
00001c  d0f9              BEQ      |L5.18|
;;;2374     }
;;;2375   
;;;2376     if (status & SDIO_FLAG_CTIMEOUT)
00001e  f0050004          AND      r0,r5,#4
000022  b138              CBZ      r0,|L5.52|
;;;2377     {
;;;2378       errorstatus = SD_CMD_RSP_TIMEOUT;
000024  f04f0803          MOV      r8,#3
;;;2379       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000028  2004              MOVS     r0,#4
00002a  f7fffffe          BL       SDIO_ClearFlag
;;;2380       return(errorstatus);
00002e  4640              MOV      r0,r8
                  |L5.48|
;;;2381     }
;;;2382     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2383     {
;;;2384       errorstatus = SD_CMD_CRC_FAIL;
;;;2385       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2386       return(errorstatus);
;;;2387     }
;;;2388   
;;;2389     /*!< Check response received is of desired command */
;;;2390     if (SDIO_GetCommandResponse() != cmd)
;;;2391     {
;;;2392       errorstatus = SD_ILLEGAL_CMD;
;;;2393       return(errorstatus);
;;;2394     }
;;;2395   
;;;2396     /*!< Clear all the static flags */
;;;2397     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2398   
;;;2399     /*!< We have received response, retrieve it.  */
;;;2400     response_r1 = SDIO_GetResponse(SDIO_RESP1);
;;;2401   
;;;2402     if (SD_ALLZERO == (response_r1 & (SD_R6_GENERAL_UNKNOWN_ERROR | SD_R6_ILLEGAL_CMD | SD_R6_COM_CRC_FAILED)))
;;;2403     {
;;;2404       *prca = (uint16_t) (response_r1 >> 16);
;;;2405       return(errorstatus);
;;;2406     }
;;;2407   
;;;2408     if (response_r1 & SD_R6_GENERAL_UNKNOWN_ERROR)
;;;2409     {
;;;2410       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2411     }
;;;2412   
;;;2413     if (response_r1 & SD_R6_ILLEGAL_CMD)
;;;2414     {
;;;2415       return(SD_ILLEGAL_CMD);
;;;2416     }
;;;2417   
;;;2418     if (response_r1 & SD_R6_COM_CRC_FAILED)
;;;2419     {
;;;2420       return(SD_COM_CRC_FAILED);
;;;2421     }
;;;2422   
;;;2423     return(errorstatus);
;;;2424   }
000030  e8bd81f0          POP      {r4-r8,pc}
                  |L5.52|
000034  f0050001          AND      r0,r5,#1              ;2382
000038  b130              CBZ      r0,|L5.72|
00003a  f04f0801          MOV      r8,#1                 ;2384
00003e  2001              MOVS     r0,#1                 ;2385
000040  f7fffffe          BL       SDIO_ClearFlag
000044  4640              MOV      r0,r8                 ;2386
000046  e7f3              B        |L5.48|
                  |L5.72|
000048  f7fffffe          BL       SDIO_GetCommandResponse
00004c  42b0              CMP      r0,r6                 ;2390
00004e  d003              BEQ      |L5.88|
000050  f04f0810          MOV      r8,#0x10              ;2392
000054  4640              MOV      r0,r8                 ;2393
000056  e7eb              B        |L5.48|
                  |L5.88|
000058  f24050ff          MOV      r0,#0x5ff             ;2397
00005c  f7fffffe          BL       SDIO_ClearFlag
000060  2000              MOVS     r0,#0                 ;2400
000062  f7fffffe          BL       SDIO_GetResponse
000066  4604              MOV      r4,r0                 ;2400
000068  f4044060          AND      r0,r4,#0xe000         ;2402
00006c  b918              CBNZ     r0,|L5.118|
00006e  0c20              LSRS     r0,r4,#16             ;2404
000070  8038              STRH     r0,[r7,#0]            ;2404
000072  4640              MOV      r0,r8                 ;2405
000074  e7dc              B        |L5.48|
                  |L5.118|
000076  f4045000          AND      r0,r4,#0x2000         ;2408
00007a  b108              CBZ      r0,|L5.128|
00007c  2013              MOVS     r0,#0x13              ;2410
00007e  e7d7              B        |L5.48|
                  |L5.128|
000080  f4044080          AND      r0,r4,#0x4000         ;2413
000084  b108              CBZ      r0,|L5.138|
000086  2010              MOVS     r0,#0x10              ;2415
000088  e7d2              B        |L5.48|
                  |L5.138|
00008a  f4044000          AND      r0,r4,#0x8000         ;2418
00008e  b108              CBZ      r0,|L5.148|
000090  200f              MOVS     r0,#0xf               ;2420
000092  e7cd              B        |L5.48|
                  |L5.148|
000094  4640              MOV      r0,r8                 ;2423
000096  e7cb              B        |L5.48|
;;;2425   
                          ENDP

                  |L5.152|
                          DCD      0x40018000

                          AREA ||i.CmdResp7Error||, CODE, READONLY, ALIGN=2

                  CmdResp7Error PROC
;;;2113     */
;;;2114   static SD_Error CmdResp7Error(void)
000000  b570              PUSH     {r4-r6,lr}
;;;2115   {
;;;2116     SD_Error errorstatus = SD_OK;
000002  2600              MOVS     r6,#0
;;;2117     uint32_t status;
;;;2118     uint32_t timeout = SDIO_CMD0TIMEOUT;
000004  f44f3580          MOV      r5,#0x10000
;;;2119   
;;;2120     status = SDIO->STA;
000008  480f              LDR      r0,|L6.72|
00000a  6b44              LDR      r4,[r0,#0x34]
;;;2121   
;;;2122     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)) && (timeout > 0))
00000c  e002              B        |L6.20|
                  |L6.14|
;;;2123     {
;;;2124       timeout--;
00000e  1e6d              SUBS     r5,r5,#1
;;;2125       status = SDIO->STA;
000010  480d              LDR      r0,|L6.72|
000012  6b44              LDR      r4,[r0,#0x34]
                  |L6.20|
000014  f0040045          AND      r0,r4,#0x45           ;2122
000018  b908              CBNZ     r0,|L6.30|
00001a  2d00              CMP      r5,#0                 ;2122
00001c  d1f7              BNE      |L6.14|
                  |L6.30|
;;;2126     }
;;;2127   
;;;2128     if ((timeout == 0) || (status & SDIO_FLAG_CTIMEOUT))
00001e  b115              CBZ      r5,|L6.38|
000020  f0040004          AND      r0,r4,#4
000024  b128              CBZ      r0,|L6.50|
                  |L6.38|
;;;2129     {
;;;2130       /*!< Card is not V2.0 complient or card does not support the set voltage range */
;;;2131       errorstatus = SD_CMD_RSP_TIMEOUT;
000026  2603              MOVS     r6,#3
;;;2132       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000028  2004              MOVS     r0,#4
00002a  f7fffffe          BL       SDIO_ClearFlag
;;;2133       return(errorstatus);
00002e  4630              MOV      r0,r6
                  |L6.48|
;;;2134     }
;;;2135   
;;;2136     if (status & SDIO_FLAG_CMDREND)
;;;2137     {
;;;2138       /*!< Card is SD V2.0 compliant */
;;;2139       errorstatus = SD_OK;
;;;2140       SDIO_ClearFlag(SDIO_FLAG_CMDREND);
;;;2141       return(errorstatus);
;;;2142     }
;;;2143     return(errorstatus);
;;;2144   }
000030  bd70              POP      {r4-r6,pc}
                  |L6.50|
000032  f0040040          AND      r0,r4,#0x40           ;2136
000036  b128              CBZ      r0,|L6.68|
000038  2600              MOVS     r6,#0                 ;2139
00003a  2040              MOVS     r0,#0x40              ;2140
00003c  f7fffffe          BL       SDIO_ClearFlag
000040  4630              MOV      r0,r6                 ;2141
000042  e7f5              B        |L6.48|
                  |L6.68|
000044  4630              MOV      r0,r6                 ;2143
000046  e7f3              B        |L6.48|
;;;2145   
                          ENDP

                  |L6.72|
                          DCD      0x40018000

                          AREA ||i.DMA2_Channel4_5_IRQHandler||, CODE, READONLY, ALIGN=1

                  DMA2_Channel4_5_IRQHandler PROC
;;;3058   */
;;;3059   void SD_SDIO_DMA_IRQHANDLER(void)
000000  b510              PUSH     {r4,lr}
;;;3060   {	
;;;3061   	/* ´¦ÀíDMAÖÐ¶Ï */
;;;3062   	SD_ProcessDMAIRQ();	
000002  f7fffffe          BL       SD_ProcessDMAIRQ
;;;3063   }
000006  bd10              POP      {r4,pc}
;;;3064   
                          ENDP


                          AREA ||i.FindSCR||, CODE, READONLY, ALIGN=2

                  FindSCR PROC
;;;2704     */
;;;2705   static SD_Error FindSCR(uint16_t rca, uint32_t *pscr)
000000  e92d41fc          PUSH     {r2-r8,lr}
;;;2706   {
000004  4607              MOV      r7,r0
000006  460d              MOV      r5,r1
;;;2707     uint32_t index = 0;
000008  2600              MOVS     r6,#0
;;;2708     SD_Error errorstatus = SD_OK;
00000a  2400              MOVS     r4,#0
;;;2709     uint32_t tempscr[2] = {0, 0};
00000c  2000              MOVS     r0,#0
00000e  9000              STR      r0,[sp,#0]
000010  9001              STR      r0,[sp,#4]
;;;2710   
;;;2711     /*!< Set Block Size To 8 Bytes */
;;;2712     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2713     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)8;
000012  2008              MOVS     r0,#8
000014  495a              LDR      r1,|L8.384|
000016  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2714     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000018  2010              MOVS     r0,#0x10
00001a  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2715     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001c  2040              MOVS     r0,#0x40
00001e  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2716     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000020  2000              MOVS     r0,#0
000022  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2717     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000024  f44f6080          MOV      r0,#0x400
000028  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2718     SDIO_SendCommand(&SDIO_CmdInitStructure);
00002a  4608              MOV      r0,r1
00002c  f7fffffe          BL       SDIO_SendCommand
;;;2719   
;;;2720     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000030  2010              MOVS     r0,#0x10
000032  f7fffffe          BL       CmdResp1Error
000036  4604              MOV      r4,r0
;;;2721   
;;;2722     if (errorstatus != SD_OK)
000038  b114              CBZ      r4,|L8.64|
;;;2723     {
;;;2724       return(errorstatus);
00003a  4620              MOV      r0,r4
                  |L8.60|
;;;2725     }
;;;2726   
;;;2727     /*!< Send CMD55 APP_CMD with argument as card's RCA */
;;;2728     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2729     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2730     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2731     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2732     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2733     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2734   
;;;2735     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2736   
;;;2737     if (errorstatus != SD_OK)
;;;2738     {
;;;2739       return(errorstatus);
;;;2740     }
;;;2741     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;2742     SDIO_DataInitStructure.SDIO_DataLength = 8;
;;;2743     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_8b;
;;;2744     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;2745     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;2746     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;2747     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;2748   
;;;2749   
;;;2750     /*!< Send ACMD51 SD_APP_SEND_SCR with argument as 0 */
;;;2751     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;2752     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_SEND_SCR;
;;;2753     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2754     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2755     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2756     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2757   
;;;2758     errorstatus = CmdResp1Error(SD_CMD_SD_APP_SEND_SCR);
;;;2759   
;;;2760     if (errorstatus != SD_OK)
;;;2761     {
;;;2762       return(errorstatus);
;;;2763     }
;;;2764   
;;;2765     while (!(SDIO->STA & (SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;2766     {
;;;2767       if (SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET)
;;;2768       {
;;;2769         *(tempscr + index) = SDIO_ReadData();
;;;2770         index++;
;;;2771       }
;;;2772     }
;;;2773   
;;;2774     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;2775     {
;;;2776       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;2777       errorstatus = SD_DATA_TIMEOUT;
;;;2778       return(errorstatus);
;;;2779     }
;;;2780     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;2781     {
;;;2782       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;2783       errorstatus = SD_DATA_CRC_FAIL;
;;;2784       return(errorstatus);
;;;2785     }
;;;2786     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;2787     {
;;;2788       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;2789       errorstatus = SD_RX_OVERRUN;
;;;2790       return(errorstatus);
;;;2791     }
;;;2792     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;2793     {
;;;2794       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2795       errorstatus = SD_START_BIT_ERR;
;;;2796       return(errorstatus);
;;;2797     }
;;;2798   
;;;2799     /*!< Clear all the static flags */
;;;2800     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2801   
;;;2802     *(pscr + 1) = ((tempscr[0] & SD_0TO7BITS) << 24) | ((tempscr[0] & SD_8TO15BITS) << 8) | ((tempscr[0] & SD_16TO23BITS) >> 8) | ((tempscr[0] & SD_24TO31BITS) >> 24);
;;;2803   
;;;2804     *(pscr) = ((tempscr[1] & SD_0TO7BITS) << 24) | ((tempscr[1] & SD_8TO15BITS) << 8) | ((tempscr[1] & SD_16TO23BITS) >> 8) | ((tempscr[1] & SD_24TO31BITS) >> 24);
;;;2805   
;;;2806     return(errorstatus);
;;;2807   }
00003c  e8bd81fc          POP      {r2-r8,pc}
                  |L8.64|
000040  4850              LDR      r0,|L8.388|
000042  8800              LDRH     r0,[r0,#0]            ;2728  ; RCA
000044  0400              LSLS     r0,r0,#16             ;2728
000046  494e              LDR      r1,|L8.384|
000048  6008              STR      r0,[r1,#0]            ;2728  ; SDIO_CmdInitStructure
00004a  2037              MOVS     r0,#0x37              ;2729
00004c  6048              STR      r0,[r1,#4]            ;2729  ; SDIO_CmdInitStructure
00004e  2040              MOVS     r0,#0x40              ;2730
000050  6088              STR      r0,[r1,#8]            ;2730  ; SDIO_CmdInitStructure
000052  2000              MOVS     r0,#0                 ;2731
000054  60c8              STR      r0,[r1,#0xc]          ;2731  ; SDIO_CmdInitStructure
000056  f44f6080          MOV      r0,#0x400             ;2732
00005a  6108              STR      r0,[r1,#0x10]         ;2732  ; SDIO_CmdInitStructure
00005c  4608              MOV      r0,r1                 ;2733
00005e  f7fffffe          BL       SDIO_SendCommand
000062  2037              MOVS     r0,#0x37              ;2735
000064  f7fffffe          BL       CmdResp1Error
000068  4604              MOV      r4,r0                 ;2735
00006a  b10c              CBZ      r4,|L8.112|
00006c  4620              MOV      r0,r4                 ;2739
00006e  e7e5              B        |L8.60|
                  |L8.112|
000070  4845              LDR      r0,|L8.392|
000072  4946              LDR      r1,|L8.396|
000074  6008              STR      r0,[r1,#0]            ;2741  ; SDIO_DataInitStructure
000076  2008              MOVS     r0,#8                 ;2742
000078  6048              STR      r0,[r1,#4]            ;2742  ; SDIO_DataInitStructure
00007a  2030              MOVS     r0,#0x30              ;2743
00007c  6088              STR      r0,[r1,#8]            ;2743  ; SDIO_DataInitStructure
00007e  2002              MOVS     r0,#2                 ;2744
000080  60c8              STR      r0,[r1,#0xc]          ;2744  ; SDIO_DataInitStructure
000082  2000              MOVS     r0,#0                 ;2745
000084  6108              STR      r0,[r1,#0x10]         ;2745  ; SDIO_DataInitStructure
000086  2001              MOVS     r0,#1                 ;2746
000088  6148              STR      r0,[r1,#0x14]         ;2746  ; SDIO_DataInitStructure
00008a  4608              MOV      r0,r1                 ;2747
00008c  f7fffffe          BL       SDIO_DataConfig
000090  2000              MOVS     r0,#0                 ;2751
000092  493b              LDR      r1,|L8.384|
000094  6008              STR      r0,[r1,#0]            ;2751  ; SDIO_CmdInitStructure
000096  2033              MOVS     r0,#0x33              ;2752
000098  6048              STR      r0,[r1,#4]            ;2752  ; SDIO_CmdInitStructure
00009a  2040              MOVS     r0,#0x40              ;2753
00009c  6088              STR      r0,[r1,#8]            ;2753  ; SDIO_CmdInitStructure
00009e  2000              MOVS     r0,#0                 ;2754
0000a0  60c8              STR      r0,[r1,#0xc]          ;2754  ; SDIO_CmdInitStructure
0000a2  f44f6080          MOV      r0,#0x400             ;2755
0000a6  6108              STR      r0,[r1,#0x10]         ;2755  ; SDIO_CmdInitStructure
0000a8  4608              MOV      r0,r1                 ;2756
0000aa  f7fffffe          BL       SDIO_SendCommand
0000ae  2033              MOVS     r0,#0x33              ;2758
0000b0  f7fffffe          BL       CmdResp1Error
0000b4  4604              MOV      r4,r0                 ;2758
0000b6  b10c              CBZ      r4,|L8.188|
0000b8  4620              MOV      r0,r4                 ;2762
0000ba  e7bf              B        |L8.60|
                  |L8.188|
0000bc  e009              B        |L8.210|
                  |L8.190|
0000be  f44f1000          MOV      r0,#0x200000          ;2767
0000c2  f7fffffe          BL       SDIO_GetFlagStatus
0000c6  b120              CBZ      r0,|L8.210|
0000c8  f7fffffe          BL       SDIO_ReadData
0000cc  f84d0026          STR      r0,[sp,r6,LSL #2]     ;2769
0000d0  1c76              ADDS     r6,r6,#1              ;2770
                  |L8.210|
0000d2  482f              LDR      r0,|L8.400|
0000d4  6b40              LDR      r0,[r0,#0x34]         ;2765
0000d6  f240612a          MOV      r1,#0x62a             ;2765
0000da  4008              ANDS     r0,r0,r1              ;2765
0000dc  2800              CMP      r0,#0                 ;2765
0000de  d0ee              BEQ      |L8.190|
0000e0  2008              MOVS     r0,#8                 ;2774
0000e2  f7fffffe          BL       SDIO_GetFlagStatus
0000e6  b128              CBZ      r0,|L8.244|
0000e8  2008              MOVS     r0,#8                 ;2776
0000ea  f7fffffe          BL       SDIO_ClearFlag
0000ee  2404              MOVS     r4,#4                 ;2777
0000f0  4620              MOV      r0,r4                 ;2778
0000f2  e7a3              B        |L8.60|
                  |L8.244|
0000f4  2002              MOVS     r0,#2                 ;2780
0000f6  f7fffffe          BL       SDIO_GetFlagStatus
0000fa  b128              CBZ      r0,|L8.264|
0000fc  2002              MOVS     r0,#2                 ;2782
0000fe  f7fffffe          BL       SDIO_ClearFlag
000102  2402              MOVS     r4,#2                 ;2783
000104  4620              MOV      r0,r4                 ;2784
000106  e799              B        |L8.60|
                  |L8.264|
000108  2020              MOVS     r0,#0x20              ;2786
00010a  f7fffffe          BL       SDIO_GetFlagStatus
00010e  b128              CBZ      r0,|L8.284|
000110  2020              MOVS     r0,#0x20              ;2788
000112  f7fffffe          BL       SDIO_ClearFlag
000116  2406              MOVS     r4,#6                 ;2789
000118  4620              MOV      r0,r4                 ;2790
00011a  e78f              B        |L8.60|
                  |L8.284|
00011c  f44f7000          MOV      r0,#0x200             ;2792
000120  f7fffffe          BL       SDIO_GetFlagStatus
000124  b130              CBZ      r0,|L8.308|
000126  f44f7000          MOV      r0,#0x200             ;2794
00012a  f7fffffe          BL       SDIO_ClearFlag
00012e  2407              MOVS     r4,#7                 ;2795
000130  4620              MOV      r0,r4                 ;2796
000132  e783              B        |L8.60|
                  |L8.308|
000134  f24050ff          MOV      r0,#0x5ff             ;2800
000138  f7fffffe          BL       SDIO_ClearFlag
00013c  9800              LDR      r0,[sp,#0]            ;2802
00013e  0600              LSLS     r0,r0,#24             ;2802
000140  9900              LDR      r1,[sp,#0]            ;2802
000142  f401417f          AND      r1,r1,#0xff00         ;2802
000146  ea402001          ORR      r0,r0,r1,LSL #8       ;2802
00014a  9900              LDR      r1,[sp,#0]            ;2802
00014c  f401017f          AND      r1,r1,#0xff0000       ;2802
000150  ea402011          ORR      r0,r0,r1,LSR #8       ;2802
000154  9900              LDR      r1,[sp,#0]            ;2802
000156  ea406011          ORR      r0,r0,r1,LSR #24      ;2802
00015a  6068              STR      r0,[r5,#4]            ;2802
00015c  9801              LDR      r0,[sp,#4]            ;2804
00015e  0600              LSLS     r0,r0,#24             ;2804
000160  9901              LDR      r1,[sp,#4]            ;2804
000162  f401417f          AND      r1,r1,#0xff00         ;2804
000166  ea402001          ORR      r0,r0,r1,LSL #8       ;2804
00016a  9901              LDR      r1,[sp,#4]            ;2804
00016c  f401017f          AND      r1,r1,#0xff0000       ;2804
000170  ea402011          ORR      r0,r0,r1,LSR #8       ;2804
000174  9901              LDR      r1,[sp,#4]            ;2804
000176  ea406011          ORR      r0,r0,r1,LSR #24      ;2804
00017a  6028              STR      r0,[r5,#0]            ;2804
00017c  4620              MOV      r0,r4                 ;2806
00017e  e75d              B        |L8.60|
;;;2808   
                          ENDP

                  |L8.384|
                          DCD      SDIO_CmdInitStructure
                  |L8.388|
                          DCD      ||RCA||
                  |L8.392|
                          DCD      0x000fffff
                  |L8.396|
                          DCD      SDIO_DataInitStructure
                  |L8.400|
                          DCD      0x40018000

                          AREA ||i.IsCardProgramming||, CODE, READONLY, ALIGN=2

                  IsCardProgramming PROC
;;;2545     */
;;;2546   static SD_Error IsCardProgramming(uint8_t *pstatus)
000000  b57c              PUSH     {r2-r6,lr}
;;;2547   {
000002  4604              MOV      r4,r0
;;;2548     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;2549     __IO uint32_t respR1 = 0, status = 0;
000006  2000              MOVS     r0,#0
000008  9001              STR      r0,[sp,#4]
00000a  9000              STR      r0,[sp,#0]
;;;2550   
;;;2551     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
00000c  485f              LDR      r0,|L9.396|
00000e  8800              LDRH     r0,[r0,#0]  ; RCA
000010  0400              LSLS     r0,r0,#16
000012  495f              LDR      r1,|L9.400|
000014  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;2552     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
000016  200d              MOVS     r0,#0xd
000018  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;2553     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00001a  2040              MOVS     r0,#0x40
00001c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;2554     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00001e  2000              MOVS     r0,#0
000020  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;2555     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000022  f44f6080          MOV      r0,#0x400
000026  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;2556     SDIO_SendCommand(&SDIO_CmdInitStructure);
000028  4608              MOV      r0,r1
00002a  f7fffffe          BL       SDIO_SendCommand
;;;2557   
;;;2558     status = SDIO->STA;
00002e  4859              LDR      r0,|L9.404|
000030  6b40              LDR      r0,[r0,#0x34]
000032  9000              STR      r0,[sp,#0]
;;;2559     while (!(status & (SDIO_FLAG_CCRCFAIL | SDIO_FLAG_CMDREND | SDIO_FLAG_CTIMEOUT)))
000034  e002              B        |L9.60|
                  |L9.54|
;;;2560     {
;;;2561       status = SDIO->STA;
000036  4857              LDR      r0,|L9.404|
000038  6b40              LDR      r0,[r0,#0x34]
00003a  9000              STR      r0,[sp,#0]
                  |L9.60|
00003c  9800              LDR      r0,[sp,#0]            ;2559
00003e  f0000045          AND      r0,r0,#0x45           ;2559
000042  2800              CMP      r0,#0                 ;2559
000044  d0f7              BEQ      |L9.54|
;;;2562     }
;;;2563   
;;;2564     if (status & SDIO_FLAG_CTIMEOUT)
000046  9800              LDR      r0,[sp,#0]
000048  f0000004          AND      r0,r0,#4
00004c  b128              CBZ      r0,|L9.90|
;;;2565     {
;;;2566       errorstatus = SD_CMD_RSP_TIMEOUT;
00004e  2503              MOVS     r5,#3
;;;2567       SDIO_ClearFlag(SDIO_FLAG_CTIMEOUT);
000050  2004              MOVS     r0,#4
000052  f7fffffe          BL       SDIO_ClearFlag
;;;2568       return(errorstatus);
000056  4628              MOV      r0,r5
                  |L9.88|
;;;2569     }
;;;2570     else if (status & SDIO_FLAG_CCRCFAIL)
;;;2571     {
;;;2572       errorstatus = SD_CMD_CRC_FAIL;
;;;2573       SDIO_ClearFlag(SDIO_FLAG_CCRCFAIL);
;;;2574       return(errorstatus);
;;;2575     }
;;;2576   
;;;2577     status = (uint32_t)SDIO_GetCommandResponse();
;;;2578   
;;;2579     /*!< Check response received is of desired command */
;;;2580     if (status != SD_CMD_SEND_STATUS)
;;;2581     {
;;;2582       errorstatus = SD_ILLEGAL_CMD;
;;;2583       return(errorstatus);
;;;2584     }
;;;2585   
;;;2586     /*!< Clear all the static flags */
;;;2587     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2588   
;;;2589   
;;;2590     /*!< We have received response, retrieve it for analysis  */
;;;2591     respR1 = SDIO_GetResponse(SDIO_RESP1);
;;;2592   
;;;2593     /*!< Find out card status */
;;;2594     *pstatus = (uint8_t) ((respR1 >> 9) & 0x0000000F);
;;;2595   
;;;2596     if ((respR1 & SD_OCR_ERRORBITS) == SD_ALLZERO)
;;;2597     {
;;;2598       return(errorstatus);
;;;2599     }
;;;2600   
;;;2601     if (respR1 & SD_OCR_ADDR_OUT_OF_RANGE)
;;;2602     {
;;;2603       return(SD_ADDR_OUT_OF_RANGE);
;;;2604     }
;;;2605   
;;;2606     if (respR1 & SD_OCR_ADDR_MISALIGNED)
;;;2607     {
;;;2608       return(SD_ADDR_MISALIGNED);
;;;2609     }
;;;2610   
;;;2611     if (respR1 & SD_OCR_BLOCK_LEN_ERR)
;;;2612     {
;;;2613       return(SD_BLOCK_LEN_ERR);
;;;2614     }
;;;2615   
;;;2616     if (respR1 & SD_OCR_ERASE_SEQ_ERR)
;;;2617     {
;;;2618       return(SD_ERASE_SEQ_ERR);
;;;2619     }
;;;2620   
;;;2621     if (respR1 & SD_OCR_BAD_ERASE_PARAM)
;;;2622     {
;;;2623       return(SD_BAD_ERASE_PARAM);
;;;2624     }
;;;2625   
;;;2626     if (respR1 & SD_OCR_WRITE_PROT_VIOLATION)
;;;2627     {
;;;2628       return(SD_WRITE_PROT_VIOLATION);
;;;2629     }
;;;2630   
;;;2631     if (respR1 & SD_OCR_LOCK_UNLOCK_FAILED)
;;;2632     {
;;;2633       return(SD_LOCK_UNLOCK_FAILED);
;;;2634     }
;;;2635   
;;;2636     if (respR1 & SD_OCR_COM_CRC_FAILED)
;;;2637     {
;;;2638       return(SD_COM_CRC_FAILED);
;;;2639     }
;;;2640   
;;;2641     if (respR1 & SD_OCR_ILLEGAL_CMD)
;;;2642     {
;;;2643       return(SD_ILLEGAL_CMD);
;;;2644     }
;;;2645   
;;;2646     if (respR1 & SD_OCR_CARD_ECC_FAILED)
;;;2647     {
;;;2648       return(SD_CARD_ECC_FAILED);
;;;2649     }
;;;2650   
;;;2651     if (respR1 & SD_OCR_CC_ERROR)
;;;2652     {
;;;2653       return(SD_CC_ERROR);
;;;2654     }
;;;2655   
;;;2656     if (respR1 & SD_OCR_GENERAL_UNKNOWN_ERROR)
;;;2657     {
;;;2658       return(SD_GENERAL_UNKNOWN_ERROR);
;;;2659     }
;;;2660   
;;;2661     if (respR1 & SD_OCR_STREAM_READ_UNDERRUN)
;;;2662     {
;;;2663       return(SD_STREAM_READ_UNDERRUN);
;;;2664     }
;;;2665   
;;;2666     if (respR1 & SD_OCR_STREAM_WRITE_OVERRUN)
;;;2667     {
;;;2668       return(SD_STREAM_WRITE_OVERRUN);
;;;2669     }
;;;2670   
;;;2671     if (respR1 & SD_OCR_CID_CSD_OVERWRIETE)
;;;2672     {
;;;2673       return(SD_CID_CSD_OVERWRITE);
;;;2674     }
;;;2675   
;;;2676     if (respR1 & SD_OCR_WP_ERASE_SKIP)
;;;2677     {
;;;2678       return(SD_WP_ERASE_SKIP);
;;;2679     }
;;;2680   
;;;2681     if (respR1 & SD_OCR_CARD_ECC_DISABLED)
;;;2682     {
;;;2683       return(SD_CARD_ECC_DISABLED);
;;;2684     }
;;;2685   
;;;2686     if (respR1 & SD_OCR_ERASE_RESET)
;;;2687     {
;;;2688       return(SD_ERASE_RESET);
;;;2689     }
;;;2690   
;;;2691     if (respR1 & SD_OCR_AKE_SEQ_ERROR)
;;;2692     {
;;;2693       return(SD_AKE_SEQ_ERROR);
;;;2694     }
;;;2695   
;;;2696     return(errorstatus);
;;;2697   }
000058  bd7c              POP      {r2-r6,pc}
                  |L9.90|
00005a  9800              LDR      r0,[sp,#0]            ;2570
00005c  f0000001          AND      r0,r0,#1              ;2570
000060  b128              CBZ      r0,|L9.110|
000062  2501              MOVS     r5,#1                 ;2572
000064  2001              MOVS     r0,#1                 ;2573
000066  f7fffffe          BL       SDIO_ClearFlag
00006a  4628              MOV      r0,r5                 ;2574
00006c  e7f4              B        |L9.88|
                  |L9.110|
00006e  f7fffffe          BL       SDIO_GetCommandResponse
000072  9000              STR      r0,[sp,#0]            ;2577
000074  9800              LDR      r0,[sp,#0]            ;2580
000076  280d              CMP      r0,#0xd               ;2580
000078  d002              BEQ      |L9.128|
00007a  2510              MOVS     r5,#0x10              ;2582
00007c  4628              MOV      r0,r5                 ;2583
00007e  e7eb              B        |L9.88|
                  |L9.128|
000080  f24050ff          MOV      r0,#0x5ff             ;2587
000084  f7fffffe          BL       SDIO_ClearFlag
000088  2000              MOVS     r0,#0                 ;2591
00008a  f7fffffe          BL       SDIO_GetResponse
00008e  9001              STR      r0,[sp,#4]            ;2591
000090  9801              LDR      r0,[sp,#4]            ;2594
000092  f3c02043          UBFX     r0,r0,#9,#4           ;2594
000096  7020              STRB     r0,[r4,#0]            ;2594
000098  493f              LDR      r1,|L9.408|
00009a  9801              LDR      r0,[sp,#4]            ;2596
00009c  4008              ANDS     r0,r0,r1              ;2596
00009e  b908              CBNZ     r0,|L9.164|
0000a0  4628              MOV      r0,r5                 ;2598
0000a2  e7d9              B        |L9.88|
                  |L9.164|
0000a4  9801              LDR      r0,[sp,#4]            ;2601
0000a6  f0004000          AND      r0,r0,#0x80000000     ;2601
0000aa  b108              CBZ      r0,|L9.176|
0000ac  201c              MOVS     r0,#0x1c              ;2603
0000ae  e7d3              B        |L9.88|
                  |L9.176|
0000b0  9801              LDR      r0,[sp,#4]            ;2606
0000b2  f0004080          AND      r0,r0,#0x40000000     ;2606
0000b6  b108              CBZ      r0,|L9.188|
0000b8  2009              MOVS     r0,#9                 ;2608
0000ba  e7cd              B        |L9.88|
                  |L9.188|
0000bc  9801              LDR      r0,[sp,#4]            ;2611
0000be  f0005000          AND      r0,r0,#0x20000000     ;2611
0000c2  b108              CBZ      r0,|L9.200|
0000c4  200a              MOVS     r0,#0xa               ;2613
0000c6  e7c7              B        |L9.88|
                  |L9.200|
0000c8  9801              LDR      r0,[sp,#4]            ;2616
0000ca  f0005080          AND      r0,r0,#0x10000000     ;2616
0000ce  b108              CBZ      r0,|L9.212|
0000d0  200b              MOVS     r0,#0xb               ;2618
0000d2  e7c1              B        |L9.88|
                  |L9.212|
0000d4  9801              LDR      r0,[sp,#4]            ;2621
0000d6  f0006000          AND      r0,r0,#0x8000000      ;2621
0000da  b108              CBZ      r0,|L9.224|
0000dc  200c              MOVS     r0,#0xc               ;2623
0000de  e7bb              B        |L9.88|
                  |L9.224|
0000e0  9801              LDR      r0,[sp,#4]            ;2626
0000e2  f0006080          AND      r0,r0,#0x4000000      ;2626
0000e6  b108              CBZ      r0,|L9.236|
0000e8  200d              MOVS     r0,#0xd               ;2628
0000ea  e7b5              B        |L9.88|
                  |L9.236|
0000ec  9801              LDR      r0,[sp,#4]            ;2631
0000ee  f0007080          AND      r0,r0,#0x1000000      ;2631
0000f2  b108              CBZ      r0,|L9.248|
0000f4  200e              MOVS     r0,#0xe               ;2633
0000f6  e7af              B        |L9.88|
                  |L9.248|
0000f8  9801              LDR      r0,[sp,#4]            ;2636
0000fa  f4000000          AND      r0,r0,#0x800000       ;2636
0000fe  b108              CBZ      r0,|L9.260|
000100  200f              MOVS     r0,#0xf               ;2638
000102  e7a9              B        |L9.88|
                  |L9.260|
000104  9801              LDR      r0,[sp,#4]            ;2641
000106  f4000080          AND      r0,r0,#0x400000       ;2641
00010a  b108              CBZ      r0,|L9.272|
00010c  2010              MOVS     r0,#0x10              ;2643
00010e  e7a3              B        |L9.88|
                  |L9.272|
000110  9801              LDR      r0,[sp,#4]            ;2646
000112  f4001000          AND      r0,r0,#0x200000       ;2646
000116  b108              CBZ      r0,|L9.284|
000118  2011              MOVS     r0,#0x11              ;2648
00011a  e79d              B        |L9.88|
                  |L9.284|
00011c  9801              LDR      r0,[sp,#4]            ;2651
00011e  f4001080          AND      r0,r0,#0x100000       ;2651
000122  b108              CBZ      r0,|L9.296|
000124  2012              MOVS     r0,#0x12              ;2653
000126  e797              B        |L9.88|
                  |L9.296|
000128  9801              LDR      r0,[sp,#4]            ;2656
00012a  f4002000          AND      r0,r0,#0x80000        ;2656
00012e  b108              CBZ      r0,|L9.308|
000130  2013              MOVS     r0,#0x13              ;2658
000132  e791              B        |L9.88|
                  |L9.308|
000134  9801              LDR      r0,[sp,#4]            ;2661
000136  f4002080          AND      r0,r0,#0x40000        ;2661
00013a  b108              CBZ      r0,|L9.320|
00013c  2014              MOVS     r0,#0x14              ;2663
00013e  e78b              B        |L9.88|
                  |L9.320|
000140  9801              LDR      r0,[sp,#4]            ;2666
000142  f4003000          AND      r0,r0,#0x20000        ;2666
000146  b108              CBZ      r0,|L9.332|
000148  2015              MOVS     r0,#0x15              ;2668
00014a  e785              B        |L9.88|
                  |L9.332|
00014c  9801              LDR      r0,[sp,#4]            ;2671
00014e  f4003080          AND      r0,r0,#0x10000        ;2671
000152  b108              CBZ      r0,|L9.344|
000154  2016              MOVS     r0,#0x16              ;2673
000156  e77f              B        |L9.88|
                  |L9.344|
000158  9801              LDR      r0,[sp,#4]            ;2676
00015a  f4004000          AND      r0,r0,#0x8000         ;2676
00015e  b108              CBZ      r0,|L9.356|
000160  2017              MOVS     r0,#0x17              ;2678
000162  e779              B        |L9.88|
                  |L9.356|
000164  9801              LDR      r0,[sp,#4]            ;2681
000166  f4004080          AND      r0,r0,#0x4000         ;2681
00016a  b108              CBZ      r0,|L9.368|
00016c  2018              MOVS     r0,#0x18              ;2683
00016e  e773              B        |L9.88|
                  |L9.368|
000170  9801              LDR      r0,[sp,#4]            ;2686
000172  f4005000          AND      r0,r0,#0x2000         ;2686
000176  b108              CBZ      r0,|L9.380|
000178  2019              MOVS     r0,#0x19              ;2688
00017a  e76d              B        |L9.88|
                  |L9.380|
00017c  9801              LDR      r0,[sp,#4]            ;2691
00017e  f0000008          AND      r0,r0,#8              ;2691
000182  b108              CBZ      r0,|L9.392|
000184  201a              MOVS     r0,#0x1a              ;2693
000186  e767              B        |L9.88|
                  |L9.392|
000188  4628              MOV      r0,r5                 ;2696
00018a  e765              B        |L9.88|
;;;2698   
                          ENDP

                  |L9.396|
                          DCD      ||RCA||
                  |L9.400|
                          DCD      SDIO_CmdInitStructure
                  |L9.404|
                          DCD      0x40018000
                  |L9.408|
                          DCD      0xfdffe008

                          AREA ||i.SDEnWideBus||, CODE, READONLY, ALIGN=2

                  SDEnWideBus PROC
;;;2431     */
;;;2432   static SD_Error SDEnWideBus(FunctionalState NewState)
000000  b57c              PUSH     {r2-r6,lr}
;;;2433   {
000002  4605              MOV      r5,r0
;;;2434     SD_Error errorstatus = SD_OK;
000004  2400              MOVS     r4,#0
;;;2435   
;;;2436     uint32_t scr[2] = {0, 0};
000006  2000              MOVS     r0,#0
000008  9000              STR      r0,[sp,#0]
00000a  9001              STR      r0,[sp,#4]
;;;2437   
;;;2438     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
00000c  f7fffffe          BL       SDIO_GetResponse
000010  f0007000          AND      r0,r0,#0x2000000
000014  b110              CBZ      r0,|L10.28|
;;;2439     {
;;;2440       errorstatus = SD_LOCK_UNLOCK_FAILED;
000016  240e              MOVS     r4,#0xe
;;;2441       return(errorstatus);
000018  4620              MOV      r0,r4
                  |L10.26|
;;;2442     }
;;;2443   
;;;2444     /*!< Get SCR Register */
;;;2445     errorstatus = FindSCR((uint16_t)RCA, scr);
;;;2446   
;;;2447     if (errorstatus != SD_OK)
;;;2448     {
;;;2449       return(errorstatus);
;;;2450     }
;;;2451   
;;;2452     /*!< If wide bus operation to be enabled */
;;;2453     if (NewState == ENABLE)
;;;2454     {
;;;2455       /*!< If requested card supports wide bus operation */
;;;2456       if ((scr[1] & SD_WIDE_BUS_SUPPORT) != SD_ALLZERO)
;;;2457       {
;;;2458         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2459         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2460         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2461         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2462         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2463         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2464         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2465   
;;;2466         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2467   
;;;2468         if (errorstatus != SD_OK)
;;;2469         {
;;;2470           return(errorstatus);
;;;2471         }
;;;2472   
;;;2473         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2474         SDIO_CmdInitStructure.SDIO_Argument = 0x2;
;;;2475         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2476         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2477         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2478         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2479         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2480   
;;;2481         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2482   
;;;2483         if (errorstatus != SD_OK)
;;;2484         {
;;;2485           return(errorstatus);
;;;2486         }
;;;2487         return(errorstatus);
;;;2488       }
;;;2489       else
;;;2490       {
;;;2491         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2492         return(errorstatus);
;;;2493       }
;;;2494     }   /*!< If wide bus operation to be disabled */
;;;2495     else
;;;2496     {
;;;2497       /*!< If requested card supports 1 bit mode operation */
;;;2498       if ((scr[1] & SD_SINGLE_BUS_SUPPORT) != SD_ALLZERO)
;;;2499       {
;;;2500         /*!< Send CMD55 APP_CMD with argument as card's RCA.*/
;;;2501         SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;2502         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;2503         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2504         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2505         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2506         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2507   
;;;2508   
;;;2509         errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;2510   
;;;2511         if (errorstatus != SD_OK)
;;;2512         {
;;;2513           return(errorstatus);
;;;2514         }
;;;2515   
;;;2516         /*!< Send ACMD6 APP_CMD with argument as 2 for wide bus mode */
;;;2517         SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;2518         SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_SD_SET_BUSWIDTH;
;;;2519         SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;2520         SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;2521         SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;2522         SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;2523   
;;;2524         errorstatus = CmdResp1Error(SD_CMD_APP_SD_SET_BUSWIDTH);
;;;2525   
;;;2526         if (errorstatus != SD_OK)
;;;2527         {
;;;2528           return(errorstatus);
;;;2529         }
;;;2530   
;;;2531         return(errorstatus);
;;;2532       }
;;;2533       else
;;;2534       {
;;;2535         errorstatus = SD_REQUEST_NOT_APPLICABLE;
;;;2536         return(errorstatus);
;;;2537       }
;;;2538     }
;;;2539   }
00001a  bd7c              POP      {r2-r6,pc}
                  |L10.28|
00001c  493d              LDR      r1,|L10.276|
00001e  8809              LDRH     r1,[r1,#0]            ;2445  ; RCA
000020  b288              UXTH     r0,r1                 ;2445
000022  4669              MOV      r1,sp                 ;2445
000024  f7fffffe          BL       FindSCR
000028  4604              MOV      r4,r0                 ;2445
00002a  b10c              CBZ      r4,|L10.48|
00002c  4620              MOV      r0,r4                 ;2449
00002e  e7f4              B        |L10.26|
                  |L10.48|
000030  2d01              CMP      r5,#1                 ;2453
000032  d136              BNE      |L10.162|
000034  9801              LDR      r0,[sp,#4]            ;2456
000036  f4002080          AND      r0,r0,#0x40000        ;2456
00003a  2800              CMP      r0,#0                 ;2456
00003c  d02e              BEQ      |L10.156|
00003e  4835              LDR      r0,|L10.276|
000040  8800              LDRH     r0,[r0,#0]            ;2459  ; RCA
000042  0400              LSLS     r0,r0,#16             ;2459
000044  4934              LDR      r1,|L10.280|
000046  6008              STR      r0,[r1,#0]            ;2459  ; SDIO_CmdInitStructure
000048  2037              MOVS     r0,#0x37              ;2460
00004a  6048              STR      r0,[r1,#4]            ;2460  ; SDIO_CmdInitStructure
00004c  2040              MOVS     r0,#0x40              ;2461
00004e  6088              STR      r0,[r1,#8]            ;2461  ; SDIO_CmdInitStructure
000050  2000              MOVS     r0,#0                 ;2462
000052  60c8              STR      r0,[r1,#0xc]          ;2462  ; SDIO_CmdInitStructure
000054  02a8              LSLS     r0,r5,#10             ;2463
000056  6108              STR      r0,[r1,#0x10]         ;2463  ; SDIO_CmdInitStructure
000058  4608              MOV      r0,r1                 ;2464
00005a  f7fffffe          BL       SDIO_SendCommand
00005e  2037              MOVS     r0,#0x37              ;2466
000060  f7fffffe          BL       CmdResp1Error
000064  4604              MOV      r4,r0                 ;2466
000066  b10c              CBZ      r4,|L10.108|
000068  4620              MOV      r0,r4                 ;2470
00006a  e7d6              B        |L10.26|
                  |L10.108|
00006c  2002              MOVS     r0,#2                 ;2474
00006e  492a              LDR      r1,|L10.280|
000070  6008              STR      r0,[r1,#0]            ;2474  ; SDIO_CmdInitStructure
000072  2006              MOVS     r0,#6                 ;2475
000074  6048              STR      r0,[r1,#4]            ;2475  ; SDIO_CmdInitStructure
000076  2040              MOVS     r0,#0x40              ;2476
000078  6088              STR      r0,[r1,#8]            ;2476  ; SDIO_CmdInitStructure
00007a  2000              MOVS     r0,#0                 ;2477
00007c  60c8              STR      r0,[r1,#0xc]          ;2477  ; SDIO_CmdInitStructure
00007e  f44f6080          MOV      r0,#0x400             ;2478
000082  6108              STR      r0,[r1,#0x10]         ;2478  ; SDIO_CmdInitStructure
000084  4608              MOV      r0,r1                 ;2479
000086  f7fffffe          BL       SDIO_SendCommand
00008a  2006              MOVS     r0,#6                 ;2481
00008c  f7fffffe          BL       CmdResp1Error
000090  4604              MOV      r4,r0                 ;2481
000092  b10c              CBZ      r4,|L10.152|
000094  4620              MOV      r0,r4                 ;2485
000096  e7c0              B        |L10.26|
                  |L10.152|
000098  4620              MOV      r0,r4                 ;2487
00009a  e7be              B        |L10.26|
                  |L10.156|
00009c  2425              MOVS     r4,#0x25              ;2491
00009e  4620              MOV      r0,r4                 ;2492
0000a0  e7bb              B        |L10.26|
                  |L10.162|
0000a2  9801              LDR      r0,[sp,#4]            ;2498
0000a4  f4003080          AND      r0,r0,#0x10000        ;2498
0000a8  b378              CBZ      r0,|L10.266|
0000aa  481a              LDR      r0,|L10.276|
0000ac  8800              LDRH     r0,[r0,#0]            ;2501  ; RCA
0000ae  0400              LSLS     r0,r0,#16             ;2501
0000b0  4919              LDR      r1,|L10.280|
0000b2  6008              STR      r0,[r1,#0]            ;2501  ; SDIO_CmdInitStructure
0000b4  2037              MOVS     r0,#0x37              ;2502
0000b6  6048              STR      r0,[r1,#4]            ;2502  ; SDIO_CmdInitStructure
0000b8  2040              MOVS     r0,#0x40              ;2503
0000ba  6088              STR      r0,[r1,#8]            ;2503  ; SDIO_CmdInitStructure
0000bc  2000              MOVS     r0,#0                 ;2504
0000be  60c8              STR      r0,[r1,#0xc]          ;2504  ; SDIO_CmdInitStructure
0000c0  f44f6080          MOV      r0,#0x400             ;2505
0000c4  6108              STR      r0,[r1,#0x10]         ;2505  ; SDIO_CmdInitStructure
0000c6  4608              MOV      r0,r1                 ;2506
0000c8  f7fffffe          BL       SDIO_SendCommand
0000cc  2037              MOVS     r0,#0x37              ;2509
0000ce  f7fffffe          BL       CmdResp1Error
0000d2  4604              MOV      r4,r0                 ;2509
0000d4  b10c              CBZ      r4,|L10.218|
0000d6  4620              MOV      r0,r4                 ;2513
0000d8  e79f              B        |L10.26|
                  |L10.218|
0000da  2000              MOVS     r0,#0                 ;2517
0000dc  490e              LDR      r1,|L10.280|
0000de  6008              STR      r0,[r1,#0]            ;2517  ; SDIO_CmdInitStructure
0000e0  2006              MOVS     r0,#6                 ;2518
0000e2  6048              STR      r0,[r1,#4]            ;2518  ; SDIO_CmdInitStructure
0000e4  2040              MOVS     r0,#0x40              ;2519
0000e6  6088              STR      r0,[r1,#8]            ;2519  ; SDIO_CmdInitStructure
0000e8  2000              MOVS     r0,#0                 ;2520
0000ea  60c8              STR      r0,[r1,#0xc]          ;2520  ; SDIO_CmdInitStructure
0000ec  f44f6080          MOV      r0,#0x400             ;2521
0000f0  6108              STR      r0,[r1,#0x10]         ;2521  ; SDIO_CmdInitStructure
0000f2  4608              MOV      r0,r1                 ;2522
0000f4  f7fffffe          BL       SDIO_SendCommand
0000f8  2006              MOVS     r0,#6                 ;2524
0000fa  f7fffffe          BL       CmdResp1Error
0000fe  4604              MOV      r4,r0                 ;2524
000100  b10c              CBZ      r4,|L10.262|
000102  4620              MOV      r0,r4                 ;2528
000104  e789              B        |L10.26|
                  |L10.262|
000106  4620              MOV      r0,r4                 ;2531
000108  e787              B        |L10.26|
                  |L10.266|
00010a  e7ff              B        |L10.268|
                  |L10.268|
00010c  2425              MOVS     r4,#0x25              ;2535
00010e  4620              MOV      r0,r4                 ;2536
000110  e783              B        |L10.26|
;;;2540   
                          ENDP

000112  0000              DCW      0x0000
                  |L10.276|
                          DCD      ||RCA||
                  |L10.280|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SDIO_IRQHandler||, CODE, READONLY, ALIGN=1

                  SDIO_IRQHandler PROC
;;;3044   */
;;;3045   void SDIO_IRQHandler(void)
000000  b510              PUSH     {r4,lr}
;;;3046   { 	
;;;3047   	/* ´¦ÀíËùÓÐµÄSDIOÖÐ¶ÏÔ´ */
;;;3048   	SD_ProcessIRQSrc();
000002  f7fffffe          BL       SD_ProcessIRQSrc
;;;3049   }
000006  bd10              POP      {r4,pc}
;;;3050   
                          ENDP


                          AREA ||i.SDIO_Interrupts_Config||, CODE, READONLY, ALIGN=1

                  SDIO_Interrupts_Config PROC
;;;3020   */
;;;3021   static void SDIO_Interrupts_Config(void)
000000  b508              PUSH     {r3,lr}
;;;3022   {
;;;3023     NVIC_InitTypeDef NVIC_InitStructure;
;;;3024   
;;;3025     NVIC_InitStructure.NVIC_IRQChannel = SDIO_IRQn;
000002  2031              MOVS     r0,#0x31
000004  f88d0000          STRB     r0,[sp,#0]
;;;3026     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 1;
000008  2001              MOVS     r0,#1
00000a  f88d0001          STRB     r0,[sp,#1]
;;;3027     NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
00000e  2000              MOVS     r0,#0
000010  f88d0002          STRB     r0,[sp,#2]
;;;3028     NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
000014  2001              MOVS     r0,#1
000016  f88d0003          STRB     r0,[sp,#3]
;;;3029     NVIC_Init(&NVIC_InitStructure);
00001a  4668              MOV      r0,sp
00001c  f7fffffe          BL       NVIC_Init
;;;3030   
;;;3031     NVIC_InitStructure.NVIC_IRQChannel = SD_SDIO_DMA_IRQn;
000020  203b              MOVS     r0,#0x3b
000022  f88d0000          STRB     r0,[sp,#0]
;;;3032     NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 2;
000026  2002              MOVS     r0,#2
000028  f88d0001          STRB     r0,[sp,#1]
;;;3033     NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
00002c  2001              MOVS     r0,#1
00002e  f88d0003          STRB     r0,[sp,#3]
;;;3034     NVIC_Init(&NVIC_InitStructure);
000032  4668              MOV      r0,sp
000034  f7fffffe          BL       NVIC_Init
;;;3035   }
000038  bd08              POP      {r3,pc}
;;;3036   
                          ENDP


                          AREA ||i.SD_DMAEndOfTransferStatus||, CODE, READONLY, ALIGN=2

                  SD_DMAEndOfTransferStatus PROC
;;;2998     */
;;;2999   uint32_t SD_DMAEndOfTransferStatus(void)
000000  b510              PUSH     {r4,lr}
;;;3000   {
;;;3001   	return (uint32_t)DMA_GetFlagStatus(DMA2_FLAG_TC4);
000002  4802              LDR      r0,|L13.12|
000004  f7fffffe          BL       DMA_GetFlagStatus
;;;3002   }
000008  bd10              POP      {r4,pc}
;;;3003   
                          ENDP

00000a  0000              DCW      0x0000
                  |L13.12|
                          DCD      0x10002000

                          AREA ||i.SD_DeInit||, CODE, READONLY, ALIGN=1

                  SD_DeInit PROC
;;;413      */
;;;414    void SD_DeInit(void)
000000  b510              PUSH     {r4,lr}
;;;415    { 
;;;416    	SD_LowLevel_DeInit();
000002  f7fffffe          BL       SD_LowLevel_DeInit
;;;417    }
000006  bd10              POP      {r4,pc}
;;;418    
                          ENDP


                          AREA ||i.SD_Detect||, CODE, READONLY, ALIGN=2

                  SD_Detect PROC
;;;538     */
;;;539    uint8_t SD_Detect(void)
000000  b508              PUSH     {r3,lr}
;;;540    {
;;;541      __IO uint8_t status = SD_PRESENT;
000002  2001              MOVS     r0,#1
000004  9000              STR      r0,[sp,#0]
;;;542    
;;;543      /*!< Check GPIO to detect SD */
;;;544      if (GPIO_ReadInputDataBit(SD_DETECT_GPIO_PORT, SD_DETECT_PIN) != Bit_RESET)
000006  2180              MOVS     r1,#0x80
000008  4804              LDR      r0,|L15.28|
00000a  f7fffffe          BL       GPIO_ReadInputDataBit
00000e  b108              CBZ      r0,|L15.20|
;;;545      {
;;;546        status = SD_NOT_PRESENT;
000010  2000              MOVS     r0,#0
000012  9000              STR      r0,[sp,#0]
                  |L15.20|
;;;547      }
;;;548      return status;
000014  f89d0000          LDRB     r0,[sp,#0]
;;;549    }
000018  bd08              POP      {r3,pc}
;;;550    
                          ENDP

00001a  0000              DCW      0x0000
                  |L15.28|
                          DCD      0x40011000

                          AREA ||i.SD_EnableWideBusOperation||, CODE, READONLY, ALIGN=2

                  SD_EnableWideBusOperation PROC
;;;1101     */
;;;1102   SD_Error SD_EnableWideBusOperation(uint32_t WideMode)
000000  b570              PUSH     {r4-r6,lr}
;;;1103   {
000002  4604              MOV      r4,r0
;;;1104     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1105   
;;;1106     /*!< MMC Card doesn't support this feature */
;;;1107     if (SDIO_MULTIMEDIA_CARD == CardType)
000006  4821              LDR      r0,|L16.140|
000008  6800              LDR      r0,[r0,#0]  ; CardType
00000a  2803              CMP      r0,#3
00000c  d102              BNE      |L16.20|
;;;1108     {
;;;1109       errorstatus = SD_UNSUPPORTED_FEATURE;
00000e  2527              MOVS     r5,#0x27
;;;1110       return(errorstatus);
000010  4628              MOV      r0,r5
                  |L16.18|
;;;1111     }
;;;1112     else if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1113     {
;;;1114       if (SDIO_BusWide_8b == WideMode)
;;;1115       {
;;;1116         errorstatus = SD_UNSUPPORTED_FEATURE;
;;;1117         return(errorstatus);
;;;1118       }
;;;1119       else if (SDIO_BusWide_4b == WideMode)
;;;1120       {
;;;1121         errorstatus = SDEnWideBus(ENABLE);
;;;1122   
;;;1123         if (SD_OK == errorstatus)
;;;1124         {
;;;1125           /*!< Configure the SDIO peripheral */
;;;1126           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV; 
;;;1127           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1128           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1129           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1130           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_4b;
;;;1131           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1132           SDIO_Init(&SDIO_InitStructure);
;;;1133         }
;;;1134       }
;;;1135       else
;;;1136       {
;;;1137         errorstatus = SDEnWideBus(DISABLE);
;;;1138   
;;;1139         if (SD_OK == errorstatus)
;;;1140         {
;;;1141           /*!< Configure the SDIO peripheral */
;;;1142           SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV; 
;;;1143           SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;1144           SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;1145           SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;1146           SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;1147           SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;1148           SDIO_Init(&SDIO_InitStructure);
;;;1149         }
;;;1150       }
;;;1151     }
;;;1152   
;;;1153     return(errorstatus);
;;;1154   }
000012  bd70              POP      {r4-r6,pc}
                  |L16.20|
000014  481d              LDR      r0,|L16.140|
000016  6800              LDR      r0,[r0,#0]            ;1112  ; CardType
000018  b138              CBZ      r0,|L16.42|
00001a  481c              LDR      r0,|L16.140|
00001c  6800              LDR      r0,[r0,#0]            ;1112  ; CardType
00001e  2801              CMP      r0,#1                 ;1112
000020  d003              BEQ      |L16.42|
000022  481a              LDR      r0,|L16.140|
000024  6800              LDR      r0,[r0,#0]            ;1112  ; CardType
000026  2802              CMP      r0,#2                 ;1112
000028  d12e              BNE      |L16.136|
                  |L16.42|
00002a  f5b45f80          CMP      r4,#0x1000            ;1114
00002e  d102              BNE      |L16.54|
000030  2527              MOVS     r5,#0x27              ;1116
000032  4628              MOV      r0,r5                 ;1117
000034  e7ed              B        |L16.18|
                  |L16.54|
000036  f5b46f00          CMP      r4,#0x800             ;1119
00003a  d114              BNE      |L16.102|
00003c  2001              MOVS     r0,#1                 ;1121
00003e  f7fffffe          BL       SDEnWideBus
000042  4605              MOV      r5,r0                 ;1121
000044  bb05              CBNZ     r5,|L16.136|
000046  2001              MOVS     r0,#1                 ;1126
000048  4911              LDR      r1,|L16.144|
00004a  7508              STRB     r0,[r1,#0x14]         ;1126
00004c  2000              MOVS     r0,#0                 ;1127
00004e  6008              STR      r0,[r1,#0]            ;1127  ; SDIO_InitStructure
000050  6048              STR      r0,[r1,#4]            ;1128  ; SDIO_InitStructure
000052  6088              STR      r0,[r1,#8]            ;1129  ; SDIO_InitStructure
000054  f44f6000          MOV      r0,#0x800             ;1130
000058  60c8              STR      r0,[r1,#0xc]          ;1130  ; SDIO_InitStructure
00005a  2000              MOVS     r0,#0                 ;1131
00005c  6108              STR      r0,[r1,#0x10]         ;1131  ; SDIO_InitStructure
00005e  4608              MOV      r0,r1                 ;1132
000060  f7fffffe          BL       SDIO_Init
000064  e010              B        |L16.136|
                  |L16.102|
000066  2000              MOVS     r0,#0                 ;1137
000068  f7fffffe          BL       SDEnWideBus
00006c  4605              MOV      r5,r0                 ;1137
00006e  b95d              CBNZ     r5,|L16.136|
000070  2001              MOVS     r0,#1                 ;1142
000072  4907              LDR      r1,|L16.144|
000074  7508              STRB     r0,[r1,#0x14]         ;1142
000076  2000              MOVS     r0,#0                 ;1143
000078  6008              STR      r0,[r1,#0]            ;1143  ; SDIO_InitStructure
00007a  6048              STR      r0,[r1,#4]            ;1144  ; SDIO_InitStructure
00007c  6088              STR      r0,[r1,#8]            ;1145  ; SDIO_InitStructure
00007e  60c8              STR      r0,[r1,#0xc]          ;1146  ; SDIO_InitStructure
000080  6108              STR      r0,[r1,#0x10]         ;1147  ; SDIO_InitStructure
000082  4608              MOV      r0,r1                 ;1148
000084  f7fffffe          BL       SDIO_Init
                  |L16.136|
000088  4628              MOV      r0,r5                 ;1153
00008a  e7c2              B        |L16.18|
;;;1155   
                          ENDP

                  |L16.140|
                          DCD      CardType
                  |L16.144|
                          DCD      SDIO_InitStructure

                          AREA ||i.SD_Erase||, CODE, READONLY, ALIGN=2

                  SD_Erase PROC
;;;1776     */
;;;1777   SD_Error SD_Erase(uint64_t startaddr, uint64_t endaddr)
000000  e92d47fc          PUSH     {r2-r10,lr}
;;;1778   {
000004  4605              MOV      r5,r0
000006  460e              MOV      r6,r1
000008  4617              MOV      r7,r2
00000a  4698              MOV      r8,r3
;;;1779     SD_Error errorstatus = SD_OK;
00000c  2400              MOVS     r4,#0
;;;1780     uint32_t delay = 0;
00000e  46a1              MOV      r9,r4
;;;1781     __IO uint32_t maxdelay = 0;
000010  2000              MOVS     r0,#0
000012  9001              STR      r0,[sp,#4]
;;;1782     uint8_t cardstate = 0;
000014  9000              STR      r0,[sp,#0]
;;;1783   
;;;1784     /*!< Check if the card coomnd class supports erase command */
;;;1785     if (((CSD_Tab[1] >> 20) & SD_CCCC_ERASE) == 0)
000016  4850              LDR      r0,|L17.344|
000018  6840              LDR      r0,[r0,#4]  ; CSD_Tab
00001a  2120              MOVS     r1,#0x20
00001c  ea015010          AND      r0,r1,r0,LSR #20
000020  b918              CBNZ     r0,|L17.42|
;;;1786     {
;;;1787       errorstatus = SD_REQUEST_NOT_APPLICABLE;
000022  2425              MOVS     r4,#0x25
;;;1788       return(errorstatus);
000024  4620              MOV      r0,r4
                  |L17.38|
;;;1789     }
;;;1790   
;;;1791     maxdelay = 120000 / ((SDIO->CLKCR & 0xFF) + 2);
;;;1792   
;;;1793     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
;;;1794     {
;;;1795       errorstatus = SD_LOCK_UNLOCK_FAILED;
;;;1796       return(errorstatus);
;;;1797     }
;;;1798   
;;;1799     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
;;;1800     {
;;;1801       startaddr /= 512;
;;;1802       endaddr /= 512;
;;;1803     }
;;;1804     
;;;1805     /*!< According to sd-card spec 1.0 ERASE_GROUP_START (CMD32) and erase_group_end(CMD33) */
;;;1806     if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) || (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) || (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;1807     {
;;;1808       /*!< Send CMD32 SD_ERASE_GRP_START with argument as addr  */
;;;1809       SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)startaddr;
;;;1810       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_START;
;;;1811       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1812       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1813       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1814       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1815   
;;;1816       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_START);
;;;1817       if (errorstatus != SD_OK)
;;;1818       {
;;;1819         return(errorstatus);
;;;1820       }
;;;1821   
;;;1822       /*!< Send CMD33 SD_ERASE_GRP_END with argument as addr  */
;;;1823       SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)endaddr;
;;;1824       SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_ERASE_GRP_END;
;;;1825       SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1826       SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1827       SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1828       SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1829   
;;;1830       errorstatus = CmdResp1Error(SD_CMD_SD_ERASE_GRP_END);
;;;1831       if (errorstatus != SD_OK)
;;;1832       {
;;;1833         return(errorstatus);
;;;1834       }
;;;1835     }
;;;1836   
;;;1837     /*!< Send CMD38 ERASE */
;;;1838     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1839     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ERASE;
;;;1840     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1841     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1842     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1843     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1844   
;;;1845     errorstatus = CmdResp1Error(SD_CMD_ERASE);
;;;1846   
;;;1847     if (errorstatus != SD_OK)
;;;1848     {
;;;1849       return(errorstatus);
;;;1850     }
;;;1851   
;;;1852     for (delay = 0; delay < maxdelay; delay++)
;;;1853     {}
;;;1854   
;;;1855     /*!< Wait till the card is in programming state */
;;;1856     errorstatus = IsCardProgramming(&cardstate);
;;;1857     delay = SD_DATATIMEOUT;
;;;1858     while ((delay > 0) && (errorstatus == SD_OK) && ((SD_CARD_PROGRAMMING == cardstate) || (SD_CARD_RECEIVING == cardstate)))
;;;1859     {
;;;1860       errorstatus = IsCardProgramming(&cardstate);
;;;1861       delay--;
;;;1862     }
;;;1863   
;;;1864     return(errorstatus);
;;;1865   }
000026  e8bd87fc          POP      {r2-r10,pc}
                  |L17.42|
00002a  484c              LDR      r0,|L17.348|
00002c  6840              LDR      r0,[r0,#4]            ;1791
00002e  b2c0              UXTB     r0,r0                 ;1791
000030  1c80              ADDS     r0,r0,#2              ;1791
000032  494b              LDR      r1,|L17.352|
000034  fbb1f0f0          UDIV     r0,r1,r0              ;1791
000038  9001              STR      r0,[sp,#4]            ;1791
00003a  2000              MOVS     r0,#0                 ;1793
00003c  f7fffffe          BL       SDIO_GetResponse
000040  f0007000          AND      r0,r0,#0x2000000      ;1793
000044  b110              CBZ      r0,|L17.76|
000046  240e              MOVS     r4,#0xe               ;1795
000048  4620              MOV      r0,r4                 ;1796
00004a  e7ec              B        |L17.38|
                  |L17.76|
00004c  4845              LDR      r0,|L17.356|
00004e  6800              LDR      r0,[r0,#0]            ;1799  ; CardType
000050  2802              CMP      r0,#2                 ;1799
000052  d110              BNE      |L17.118|
000054  0202              LSLS     r2,r0,#8              ;1801
000056  2300              MOVS     r3,#0                 ;1801
000058  4628              MOV      r0,r5                 ;1801
00005a  4631              MOV      r1,r6                 ;1801
00005c  f7fffffe          BL       __aeabi_uldivmod
000060  4605              MOV      r5,r0                 ;1801
000062  460e              MOV      r6,r1                 ;1801
000064  f44f7200          MOV      r2,#0x200             ;1802
000068  2300              MOVS     r3,#0                 ;1802
00006a  4638              MOV      r0,r7                 ;1802
00006c  4641              MOV      r1,r8                 ;1802
00006e  f7fffffe          BL       __aeabi_uldivmod
000072  4607              MOV      r7,r0                 ;1802
000074  4688              MOV      r8,r1                 ;1802
                  |L17.118|
000076  483b              LDR      r0,|L17.356|
000078  6800              LDR      r0,[r0,#0]            ;1806  ; CardType
00007a  b138              CBZ      r0,|L17.140|
00007c  4839              LDR      r0,|L17.356|
00007e  6800              LDR      r0,[r0,#0]            ;1806  ; CardType
000080  2801              CMP      r0,#1                 ;1806
000082  d003              BEQ      |L17.140|
000084  4837              LDR      r0,|L17.356|
000086  6800              LDR      r0,[r0,#0]            ;1806  ; CardType
000088  2802              CMP      r0,#2                 ;1806
00008a  d12b              BNE      |L17.228|
                  |L17.140|
00008c  4836              LDR      r0,|L17.360|
00008e  6005              STR      r5,[r0,#0]            ;1809  ; SDIO_CmdInitStructure
000090  2020              MOVS     r0,#0x20              ;1810
000092  4935              LDR      r1,|L17.360|
000094  6048              STR      r0,[r1,#4]            ;1810  ; SDIO_CmdInitStructure
000096  2040              MOVS     r0,#0x40              ;1811
000098  6088              STR      r0,[r1,#8]            ;1811  ; SDIO_CmdInitStructure
00009a  2000              MOVS     r0,#0                 ;1812
00009c  60c8              STR      r0,[r1,#0xc]          ;1812  ; SDIO_CmdInitStructure
00009e  f44f6080          MOV      r0,#0x400             ;1813
0000a2  6108              STR      r0,[r1,#0x10]         ;1813  ; SDIO_CmdInitStructure
0000a4  4608              MOV      r0,r1                 ;1814
0000a6  f7fffffe          BL       SDIO_SendCommand
0000aa  2020              MOVS     r0,#0x20              ;1816
0000ac  f7fffffe          BL       CmdResp1Error
0000b0  4604              MOV      r4,r0                 ;1816
0000b2  b10c              CBZ      r4,|L17.184|
0000b4  4620              MOV      r0,r4                 ;1819
0000b6  e7b6              B        |L17.38|
                  |L17.184|
0000b8  482b              LDR      r0,|L17.360|
0000ba  6007              STR      r7,[r0,#0]            ;1823  ; SDIO_CmdInitStructure
0000bc  2021              MOVS     r0,#0x21              ;1824
0000be  492a              LDR      r1,|L17.360|
0000c0  6048              STR      r0,[r1,#4]            ;1824  ; SDIO_CmdInitStructure
0000c2  2040              MOVS     r0,#0x40              ;1825
0000c4  6088              STR      r0,[r1,#8]            ;1825  ; SDIO_CmdInitStructure
0000c6  2000              MOVS     r0,#0                 ;1826
0000c8  60c8              STR      r0,[r1,#0xc]          ;1826  ; SDIO_CmdInitStructure
0000ca  f44f6080          MOV      r0,#0x400             ;1827
0000ce  6108              STR      r0,[r1,#0x10]         ;1827  ; SDIO_CmdInitStructure
0000d0  4608              MOV      r0,r1                 ;1828
0000d2  f7fffffe          BL       SDIO_SendCommand
0000d6  2021              MOVS     r0,#0x21              ;1830
0000d8  f7fffffe          BL       CmdResp1Error
0000dc  4604              MOV      r4,r0                 ;1830
0000de  b10c              CBZ      r4,|L17.228|
0000e0  4620              MOV      r0,r4                 ;1833
0000e2  e7a0              B        |L17.38|
                  |L17.228|
0000e4  2000              MOVS     r0,#0                 ;1838
0000e6  4920              LDR      r1,|L17.360|
0000e8  6008              STR      r0,[r1,#0]            ;1838  ; SDIO_CmdInitStructure
0000ea  2026              MOVS     r0,#0x26              ;1839
0000ec  6048              STR      r0,[r1,#4]            ;1839  ; SDIO_CmdInitStructure
0000ee  2040              MOVS     r0,#0x40              ;1840
0000f0  6088              STR      r0,[r1,#8]            ;1840  ; SDIO_CmdInitStructure
0000f2  2000              MOVS     r0,#0                 ;1841
0000f4  60c8              STR      r0,[r1,#0xc]          ;1841  ; SDIO_CmdInitStructure
0000f6  f44f6080          MOV      r0,#0x400             ;1842
0000fa  6108              STR      r0,[r1,#0x10]         ;1842  ; SDIO_CmdInitStructure
0000fc  4608              MOV      r0,r1                 ;1843
0000fe  f7fffffe          BL       SDIO_SendCommand
000102  2026              MOVS     r0,#0x26              ;1845
000104  f7fffffe          BL       CmdResp1Error
000108  4604              MOV      r4,r0                 ;1845
00010a  b10c              CBZ      r4,|L17.272|
00010c  4620              MOV      r0,r4                 ;1849
00010e  e78a              B        |L17.38|
                  |L17.272|
000110  f04f0900          MOV      r9,#0                 ;1852
000114  e001              B        |L17.282|
                  |L17.278|
000116  f1090901          ADD      r9,r9,#1              ;1852
                  |L17.282|
00011a  9801              LDR      r0,[sp,#4]            ;1852
00011c  4581              CMP      r9,r0                 ;1852
00011e  d3fa              BCC      |L17.278|
000120  4668              MOV      r0,sp                 ;1856
000122  f7fffffe          BL       IsCardProgramming
000126  4604              MOV      r4,r0                 ;1856
000128  f8df9040          LDR      r9,|L17.364|
00012c  e005              B        |L17.314|
                  |L17.302|
00012e  4668              MOV      r0,sp                 ;1860
000130  f7fffffe          BL       IsCardProgramming
000134  4604              MOV      r4,r0                 ;1860
000136  f1a90901          SUB      r9,r9,#1              ;1861
                  |L17.314|
00013a  f1b90f00          CMP      r9,#0                 ;1858
00013e  d008              BEQ      |L17.338|
000140  b93c              CBNZ     r4,|L17.338|
000142  f89d0000          LDRB     r0,[sp,#0]            ;1858
000146  2807              CMP      r0,#7                 ;1858
000148  d0f1              BEQ      |L17.302|
00014a  f89d0000          LDRB     r0,[sp,#0]            ;1858
00014e  2806              CMP      r0,#6                 ;1858
000150  d0ed              BEQ      |L17.302|
                  |L17.338|
000152  4620              MOV      r0,r4                 ;1864
000154  e767              B        |L17.38|
;;;1866   
                          ENDP

000156  0000              DCW      0x0000
                  |L17.344|
                          DCD      CSD_Tab
                  |L17.348|
                          DCD      0x40018000
                  |L17.352|
                          DCD      0x0001d4c0
                  |L17.356|
                          DCD      CardType
                  |L17.360|
                          DCD      SDIO_CmdInitStructure
                  |L17.364|
                          DCD      0x000fffff

                          AREA ||i.SD_GetCardInfo||, CODE, READONLY, ALIGN=2

                  SD_GetCardInfo PROC
;;;804      */
;;;805    SD_Error SD_GetCardInfo(SD_CardInfo *cardinfo)
000000  b5f0              PUSH     {r4-r7,lr}
;;;806    {
000002  4601              MOV      r1,r0
;;;807      SD_Error errorstatus = SD_OK;
000004  2000              MOVS     r0,#0
;;;808      uint8_t tmp = 0;
000006  2200              MOVS     r2,#0
;;;809    
;;;810      cardinfo->CardType = (uint8_t)CardType;
000008  4bcd              LDR      r3,|L18.832|
00000a  781b              LDRB     r3,[r3,#0]  ; CardType
00000c  f8813056          STRB     r3,[r1,#0x56]
;;;811      cardinfo->RCA = (uint16_t)RCA;
000010  4bcc              LDR      r3,|L18.836|
000012  881b              LDRH     r3,[r3,#0]  ; RCA
000014  f8a13054          STRH     r3,[r1,#0x54]
;;;812    
;;;813      /*!< Byte 0 */
;;;814      tmp = (uint8_t)((CSD_Tab[0] & 0xFF000000) >> 24);
000018  4bcb              LDR      r3,|L18.840|
00001a  681b              LDR      r3,[r3,#0]  ; CSD_Tab
00001c  0e1a              LSRS     r2,r3,#24
;;;815      cardinfo->SD_csd.CSDStruct = (tmp & 0xC0) >> 6;
00001e  0993              LSRS     r3,r2,#6
000020  700b              STRB     r3,[r1,#0]
;;;816      cardinfo->SD_csd.SysSpecVersion = (tmp & 0x3C) >> 2;
000022  f3c20383          UBFX     r3,r2,#2,#4
000026  704b              STRB     r3,[r1,#1]
;;;817      cardinfo->SD_csd.Reserved1 = tmp & 0x03;
000028  f0020303          AND      r3,r2,#3
00002c  708b              STRB     r3,[r1,#2]
;;;818    
;;;819      /*!< Byte 1 */
;;;820      tmp = (uint8_t)((CSD_Tab[0] & 0x00FF0000) >> 16);
00002e  4bc6              LDR      r3,|L18.840|
000030  681b              LDR      r3,[r3,#0]  ; CSD_Tab
000032  f3c34207          UBFX     r2,r3,#16,#8
;;;821      cardinfo->SD_csd.TAAC = tmp;
000036  70ca              STRB     r2,[r1,#3]
;;;822    
;;;823      /*!< Byte 2 */
;;;824      tmp = (uint8_t)((CSD_Tab[0] & 0x0000FF00) >> 8);
000038  4bc3              LDR      r3,|L18.840|
00003a  881b              LDRH     r3,[r3,#0]  ; CSD_Tab
00003c  f3c32207          UBFX     r2,r3,#8,#8
;;;825      cardinfo->SD_csd.NSAC = tmp;
000040  710a              STRB     r2,[r1,#4]
;;;826    
;;;827      /*!< Byte 3 */
;;;828      tmp = (uint8_t)(CSD_Tab[0] & 0x000000FF);
000042  4bc1              LDR      r3,|L18.840|
000044  781a              LDRB     r2,[r3,#0]  ; CSD_Tab
;;;829      cardinfo->SD_csd.MaxBusClkFrec = tmp;
000046  714a              STRB     r2,[r1,#5]
;;;830    
;;;831      /*!< Byte 4 */
;;;832      tmp = (uint8_t)((CSD_Tab[1] & 0xFF000000) >> 24);
000048  685b              LDR      r3,[r3,#4]  ; CSD_Tab
00004a  0e1a              LSRS     r2,r3,#24
;;;833      cardinfo->SD_csd.CardComdClasses = tmp << 4;
00004c  0113              LSLS     r3,r2,#4
00004e  80cb              STRH     r3,[r1,#6]
;;;834    
;;;835      /*!< Byte 5 */
;;;836      tmp = (uint8_t)((CSD_Tab[1] & 0x00FF0000) >> 16);
000050  4bbd              LDR      r3,|L18.840|
000052  685b              LDR      r3,[r3,#4]  ; CSD_Tab
000054  f3c34207          UBFX     r2,r3,#16,#8
;;;837      cardinfo->SD_csd.CardComdClasses |= (tmp & 0xF0) >> 4;
000058  88cb              LDRH     r3,[r1,#6]
00005a  ea431312          ORR      r3,r3,r2,LSR #4
00005e  80cb              STRH     r3,[r1,#6]
;;;838      cardinfo->SD_csd.RdBlockLen = tmp & 0x0F;
000060  f002030f          AND      r3,r2,#0xf
000064  720b              STRB     r3,[r1,#8]
;;;839    
;;;840      /*!< Byte 6 */
;;;841      tmp = (uint8_t)((CSD_Tab[1] & 0x0000FF00) >> 8);
000066  4bb8              LDR      r3,|L18.840|
000068  889b              LDRH     r3,[r3,#4]  ; CSD_Tab
00006a  f3c32207          UBFX     r2,r3,#8,#8
;;;842      cardinfo->SD_csd.PartBlockRead = (tmp & 0x80) >> 7;
00006e  09d3              LSRS     r3,r2,#7
000070  724b              STRB     r3,[r1,#9]
;;;843      cardinfo->SD_csd.WrBlockMisalign = (tmp & 0x40) >> 6;
000072  f3c21380          UBFX     r3,r2,#6,#1
000076  728b              STRB     r3,[r1,#0xa]
;;;844      cardinfo->SD_csd.RdBlockMisalign = (tmp & 0x20) >> 5;
000078  f3c21340          UBFX     r3,r2,#5,#1
00007c  72cb              STRB     r3,[r1,#0xb]
;;;845      cardinfo->SD_csd.DSRImpl = (tmp & 0x10) >> 4;
00007e  f3c21300          UBFX     r3,r2,#4,#1
000082  730b              STRB     r3,[r1,#0xc]
;;;846      cardinfo->SD_csd.Reserved2 = 0; /*!< Reserved */
000084  2300              MOVS     r3,#0
000086  734b              STRB     r3,[r1,#0xd]
;;;847    
;;;848      if ((CardType == SDIO_STD_CAPACITY_SD_CARD_V1_1) || (CardType == SDIO_STD_CAPACITY_SD_CARD_V2_0))
000088  4bad              LDR      r3,|L18.832|
00008a  681b              LDR      r3,[r3,#0]  ; CardType
00008c  b11b              CBZ      r3,|L18.150|
00008e  4bac              LDR      r3,|L18.832|
000090  681b              LDR      r3,[r3,#0]  ; CardType
000092  2b01              CMP      r3,#1
000094  d15b              BNE      |L18.334|
                  |L18.150|
;;;849      {
;;;850        cardinfo->SD_csd.DeviceSize = (tmp & 0x03) << 10;
000096  0793              LSLS     r3,r2,#30
000098  0d1b              LSRS     r3,r3,#20
00009a  17dc              ASRS     r4,r3,#31
00009c  610b              STR      r3,[r1,#0x10]
00009e  614c              STR      r4,[r1,#0x14]
;;;851    
;;;852        /*!< Byte 7 */
;;;853        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
0000a0  4ba9              LDR      r3,|L18.840|
0000a2  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;854        cardinfo->SD_csd.DeviceSize |= (tmp) << 2;
0000a4  690b              LDR      r3,[r1,#0x10]
0000a6  694c              LDR      r4,[r1,#0x14]
0000a8  0095              LSLS     r5,r2,#2
0000aa  432b              ORRS     r3,r3,r5
0000ac  ea4474e5          ORR      r4,r4,r5,ASR #31
0000b0  610b              STR      r3,[r1,#0x10]
0000b2  614c              STR      r4,[r1,#0x14]
;;;855    
;;;856        /*!< Byte 8 */
;;;857        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
0000b4  4ba4              LDR      r3,|L18.840|
0000b6  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000b8  0e1a              LSRS     r2,r3,#24
;;;858        cardinfo->SD_csd.DeviceSize |= (tmp & 0xC0) >> 6;
0000ba  690b              LDR      r3,[r1,#0x10]
0000bc  694c              LDR      r4,[r1,#0x14]
0000be  0995              LSRS     r5,r2,#6
0000c0  432b              ORRS     r3,r3,r5
0000c2  ea4474e5          ORR      r4,r4,r5,ASR #31
0000c6  610b              STR      r3,[r1,#0x10]
0000c8  614c              STR      r4,[r1,#0x14]
;;;859    
;;;860        cardinfo->SD_csd.MaxRdCurrentVDDMin = (tmp & 0x38) >> 3;
0000ca  f3c203c2          UBFX     r3,r2,#3,#3
0000ce  760b              STRB     r3,[r1,#0x18]
;;;861        cardinfo->SD_csd.MaxRdCurrentVDDMax = (tmp & 0x07);
0000d0  f0020307          AND      r3,r2,#7
0000d4  764b              STRB     r3,[r1,#0x19]
;;;862    
;;;863        /*!< Byte 9 */
;;;864        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
0000d6  4b9c              LDR      r3,|L18.840|
0000d8  689b              LDR      r3,[r3,#8]  ; CSD_Tab
0000da  f3c34207          UBFX     r2,r3,#16,#8
;;;865        cardinfo->SD_csd.MaxWrCurrentVDDMin = (tmp & 0xE0) >> 5;
0000de  0953              LSRS     r3,r2,#5
0000e0  768b              STRB     r3,[r1,#0x1a]
;;;866        cardinfo->SD_csd.MaxWrCurrentVDDMax = (tmp & 0x1C) >> 2;
0000e2  f3c20382          UBFX     r3,r2,#2,#3
0000e6  76cb              STRB     r3,[r1,#0x1b]
;;;867        cardinfo->SD_csd.DeviceSizeMul = (tmp & 0x03) << 1;
0000e8  0793              LSLS     r3,r2,#30
0000ea  0f5b              LSRS     r3,r3,#29
0000ec  770b              STRB     r3,[r1,#0x1c]
;;;868        /*!< Byte 10 */
;;;869        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
0000ee  4b96              LDR      r3,|L18.840|
0000f0  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
0000f2  f3c32207          UBFX     r2,r3,#8,#8
;;;870        cardinfo->SD_csd.DeviceSizeMul |= (tmp & 0x80) >> 7;
0000f6  7f0b              LDRB     r3,[r1,#0x1c]
0000f8  ea4313d2          ORR      r3,r3,r2,LSR #7
0000fc  770b              STRB     r3,[r1,#0x1c]
;;;871        
;;;872        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) ;
0000fe  690e              LDR      r6,[r1,#0x10]
000100  694b              LDR      r3,[r1,#0x14]
000102  1c75              ADDS     r5,r6,#1
000104  f1430300          ADC      r3,r3,#0
000108  e9c15312          STRD     r5,r3,[r1,#0x48]
;;;873        cardinfo->CardCapacity *= (1 << (cardinfo->SD_csd.DeviceSizeMul + 2));
00010c  7f0b              LDRB     r3,[r1,#0x1c]
00010e  e9d15412          LDRD     r5,r4,[r1,#0x48]
000112  1c9b              ADDS     r3,r3,#2
000114  2601              MOVS     r6,#1
000116  fa06f303          LSL      r3,r6,r3
00011a  17de              ASRS     r6,r3,#31
00011c  fba57c03          UMULL    r7,r12,r5,r3
000120  fb04c303          MLA      r3,r4,r3,r12
000124  fb053306          MLA      r3,r5,r6,r3
000128  e9c17312          STRD     r7,r3,[r1,#0x48]
;;;874        cardinfo->CardBlockSize = 1 << (cardinfo->SD_csd.RdBlockLen);
00012c  7a0c              LDRB     r4,[r1,#8]
00012e  2301              MOVS     r3,#1
000130  40a3              LSLS     r3,r3,r4
000132  650b              STR      r3,[r1,#0x50]
;;;875        cardinfo->CardCapacity *= cardinfo->CardBlockSize;
000134  2700              MOVS     r7,#0
000136  e9d15412          LDRD     r5,r4,[r1,#0x48]
00013a  6d0b              LDR      r3,[r1,#0x50]
00013c  fba56c03          UMULL    r6,r12,r5,r3
000140  fb04c303          MLA      r3,r4,r3,r12
000144  fb053307          MLA      r3,r5,r7,r3
000148  e9c16312          STRD     r6,r3,[r1,#0x48]
00014c  e040              B        |L18.464|
                  |L18.334|
;;;876      }
;;;877      else if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
00014e  4b7c              LDR      r3,|L18.832|
000150  681b              LDR      r3,[r3,#0]  ; CardType
000152  2b02              CMP      r3,#2
000154  d13c              BNE      |L18.464|
;;;878      {
;;;879        /*!< Byte 7 */
;;;880        tmp = (uint8_t)(CSD_Tab[1] & 0x000000FF);
000156  4b7c              LDR      r3,|L18.840|
000158  791a              LDRB     r2,[r3,#4]  ; CSD_Tab
;;;881        cardinfo->SD_csd.DeviceSize = (tmp & 0x3F) << 16;
00015a  0693              LSLS     r3,r2,#26
00015c  0a9b              LSRS     r3,r3,#10
00015e  17dc              ASRS     r4,r3,#31
000160  610b              STR      r3,[r1,#0x10]
000162  614c              STR      r4,[r1,#0x14]
;;;882    
;;;883        /*!< Byte 8 */
;;;884        tmp = (uint8_t)((CSD_Tab[2] & 0xFF000000) >> 24);
000164  4b78              LDR      r3,|L18.840|
000166  689b              LDR      r3,[r3,#8]  ; CSD_Tab
000168  0e1a              LSRS     r2,r3,#24
;;;885    
;;;886        cardinfo->SD_csd.DeviceSize |= (tmp << 8);
00016a  690c              LDR      r4,[r1,#0x10]
00016c  694b              LDR      r3,[r1,#0x14]
00016e  0215              LSLS     r5,r2,#8
000170  432c              ORRS     r4,r4,r5
000172  ea4373e5          ORR      r3,r3,r5,ASR #31
000176  610c              STR      r4,[r1,#0x10]
000178  614b              STR      r3,[r1,#0x14]
;;;887    
;;;888        /*!< Byte 9 */
;;;889        tmp = (uint8_t)((CSD_Tab[2] & 0x00FF0000) >> 16);
00017a  4b73              LDR      r3,|L18.840|
00017c  689b              LDR      r3,[r3,#8]  ; CSD_Tab
00017e  f3c34207          UBFX     r2,r3,#16,#8
;;;890    
;;;891        cardinfo->SD_csd.DeviceSize |= (tmp);
000182  690b              LDR      r3,[r1,#0x10]
000184  694c              LDR      r4,[r1,#0x14]
000186  4313              ORRS     r3,r3,r2
000188  610b              STR      r3,[r1,#0x10]
00018a  614c              STR      r4,[r1,#0x14]
;;;892    
;;;893        /*!< Byte 10 */
;;;894        tmp = (uint8_t)((CSD_Tab[2] & 0x0000FF00) >> 8);
00018c  4b6e              LDR      r3,|L18.840|
00018e  891b              LDRH     r3,[r3,#8]  ; CSD_Tab
000190  f3c32207          UBFX     r2,r3,#8,#8
;;;895        
;;;896        cardinfo->CardCapacity = (cardinfo->SD_csd.DeviceSize + 1) * 512 * 1024;
000194  690d              LDR      r5,[r1,#0x10]
000196  694b              LDR      r3,[r1,#0x14]
000198  1c6c              ADDS     r4,r5,#1
00019a  f1430700          ADC      r7,r3,#0
00019e  f44f7500          MOV      r5,#0x200
0001a2  2600              MOVS     r6,#0
0001a4  fba43c05          UMULL    r3,r12,r4,r5
0001a8  fb07c505          MLA      r5,r7,r5,r12
0001ac  fb045706          MLA      r7,r4,r6,r5
0001b0  f44f6580          MOV      r5,#0x400
0001b4  4634              MOV      r4,r6
0001b6  461e              MOV      r6,r3
0001b8  463b              MOV      r3,r7
0001ba  4627              MOV      r7,r4
0001bc  fba64c05          UMULL    r4,r12,r6,r5
0001c0  fb03c305          MLA      r3,r3,r5,r12
0001c4  fb063307          MLA      r3,r6,r7,r3
0001c8  e9c14312          STRD     r4,r3,[r1,#0x48]
;;;897        cardinfo->CardBlockSize = 512;    
0001cc  106b              ASRS     r3,r5,#1
0001ce  650b              STR      r3,[r1,#0x50]
                  |L18.464|
;;;898      }
;;;899    
;;;900    
;;;901      cardinfo->SD_csd.EraseGrSize = (tmp & 0x40) >> 6;
0001d0  f3c21380          UBFX     r3,r2,#6,#1
0001d4  f8013f1d          STRB     r3,[r1,#0x1d]!
;;;902      cardinfo->SD_csd.EraseGrMul = (tmp & 0x3F) << 1;
0001d8  0693              LSLS     r3,r2,#26
0001da  0e5b              LSRS     r3,r3,#25
0001dc  704b              STRB     r3,[r1,#1]
;;;903    
;;;904      /*!< Byte 11 */
;;;905      tmp = (uint8_t)(CSD_Tab[2] & 0x000000FF);
0001de  4b5a              LDR      r3,|L18.840|
0001e0  7a1a              LDRB     r2,[r3,#8]  ; CSD_Tab
;;;906      cardinfo->SD_csd.EraseGrMul |= (tmp & 0x80) >> 7;
0001e2  784b              LDRB     r3,[r1,#1]
0001e4  ea4313d2          ORR      r3,r3,r2,LSR #7
0001e8  704b              STRB     r3,[r1,#1]
;;;907      cardinfo->SD_csd.WrProtectGrSize = (tmp & 0x7F);
0001ea  f002037f          AND      r3,r2,#0x7f
0001ee  708b              STRB     r3,[r1,#2]
;;;908    
;;;909      /*!< Byte 12 */
;;;910      tmp = (uint8_t)((CSD_Tab[3] & 0xFF000000) >> 24);
0001f0  4b55              LDR      r3,|L18.840|
0001f2  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
0001f4  0e1a              LSRS     r2,r3,#24
;;;911      cardinfo->SD_csd.WrProtectGrEnable = (tmp & 0x80) >> 7;
0001f6  09d3              LSRS     r3,r2,#7
0001f8  70cb              STRB     r3,[r1,#3]
;;;912      cardinfo->SD_csd.ManDeflECC = (tmp & 0x60) >> 5;
0001fa  f3c21341          UBFX     r3,r2,#5,#2
0001fe  710b              STRB     r3,[r1,#4]
;;;913      cardinfo->SD_csd.WrSpeedFact = (tmp & 0x1C) >> 2;
000200  f3c20382          UBFX     r3,r2,#2,#3
000204  714b              STRB     r3,[r1,#5]
;;;914      cardinfo->SD_csd.MaxWrBlockLen = (tmp & 0x03) << 2;
000206  0793              LSLS     r3,r2,#30
000208  0f1b              LSRS     r3,r3,#28
00020a  718b              STRB     r3,[r1,#6]
;;;915    
;;;916      /*!< Byte 13 */
;;;917      tmp = (uint8_t)((CSD_Tab[3] & 0x00FF0000) >> 16);
00020c  4b4e              LDR      r3,|L18.840|
00020e  68db              LDR      r3,[r3,#0xc]  ; CSD_Tab
000210  f3c34207          UBFX     r2,r3,#16,#8
;;;918      cardinfo->SD_csd.MaxWrBlockLen |= (tmp & 0xC0) >> 6;
000214  798b              LDRB     r3,[r1,#6]
000216  ea431392          ORR      r3,r3,r2,LSR #6
00021a  718b              STRB     r3,[r1,#6]
;;;919      cardinfo->SD_csd.WriteBlockPaPartial = (tmp & 0x20) >> 5;
00021c  f3c21340          UBFX     r3,r2,#5,#1
000220  71cb              STRB     r3,[r1,#7]
;;;920      cardinfo->SD_csd.Reserved3 = 0;
000222  2300              MOVS     r3,#0
000224  720b              STRB     r3,[r1,#8]
;;;921      cardinfo->SD_csd.ContentProtectAppli = (tmp & 0x01);
000226  f0020301          AND      r3,r2,#1
00022a  724b              STRB     r3,[r1,#9]
;;;922    
;;;923      /*!< Byte 14 */
;;;924      tmp = (uint8_t)((CSD_Tab[3] & 0x0000FF00) >> 8);
00022c  4b46              LDR      r3,|L18.840|
00022e  899b              LDRH     r3,[r3,#0xc]  ; CSD_Tab
000230  f3c32207          UBFX     r2,r3,#8,#8
;;;925      cardinfo->SD_csd.FileFormatGrouop = (tmp & 0x80) >> 7;
000234  09d3              LSRS     r3,r2,#7
000236  728b              STRB     r3,[r1,#0xa]
;;;926      cardinfo->SD_csd.CopyFlag = (tmp & 0x40) >> 6;
000238  f3c21380          UBFX     r3,r2,#6,#1
00023c  72cb              STRB     r3,[r1,#0xb]
;;;927      cardinfo->SD_csd.PermWrProtect = (tmp & 0x20) >> 5;
00023e  f3c21340          UBFX     r3,r2,#5,#1
000242  730b              STRB     r3,[r1,#0xc]
;;;928      cardinfo->SD_csd.TempWrProtect = (tmp & 0x10) >> 4;
000244  f3c21300          UBFX     r3,r2,#4,#1
000248  734b              STRB     r3,[r1,#0xd]
;;;929      cardinfo->SD_csd.FileFormat = (tmp & 0x0C) >> 2;
00024a  f3c20381          UBFX     r3,r2,#2,#2
00024e  738b              STRB     r3,[r1,#0xe]
;;;930      cardinfo->SD_csd.ECC = (tmp & 0x03);
000250  f0020303          AND      r3,r2,#3
000254  73cb              STRB     r3,[r1,#0xf]
;;;931    
;;;932      /*!< Byte 15 */
;;;933      tmp = (uint8_t)(CSD_Tab[3] & 0x000000FF);
000256  4b3c              LDR      r3,|L18.840|
000258  7b1a              LDRB     r2,[r3,#0xc]  ; CSD_Tab
;;;934      cardinfo->SD_csd.CSD_CRC = (tmp & 0xFE) >> 1;
00025a  0853              LSRS     r3,r2,#1
00025c  740b              STRB     r3,[r1,#0x10]
;;;935      cardinfo->SD_csd.Reserved4 = 1;
00025e  2301              MOVS     r3,#1
000260  744b              STRB     r3,[r1,#0x11]
;;;936    
;;;937    
;;;938      /*!< Byte 0 */
;;;939      tmp = (uint8_t)((CID_Tab[0] & 0xFF000000) >> 24);
000262  4b3a              LDR      r3,|L18.844|
000264  681b              LDR      r3,[r3,#0]  ; CID_Tab
000266  0e1a              LSRS     r2,r3,#24
;;;940      cardinfo->SD_cid.ManufacturerID = tmp;
000268  74ca              STRB     r2,[r1,#0x13]
00026a  391d              SUBS     r1,r1,#0x1d
;;;941    
;;;942      /*!< Byte 1 */
;;;943      tmp = (uint8_t)((CID_Tab[0] & 0x00FF0000) >> 16);
00026c  4b37              LDR      r3,|L18.844|
00026e  681b              LDR      r3,[r3,#0]  ; CID_Tab
000270  f3c34207          UBFX     r2,r3,#16,#8
;;;944      cardinfo->SD_cid.OEM_AppliID = tmp << 8;
000274  0214              LSLS     r4,r2,#8
000276  864c              STRH     r4,[r1,#0x32]
;;;945    
;;;946      /*!< Byte 2 */
;;;947      tmp = (uint8_t)((CID_Tab[0] & 0x000000FF00) >> 8);
000278  4b34              LDR      r3,|L18.844|
00027a  881b              LDRH     r3,[r3,#0]  ; CID_Tab
00027c  f3c32207          UBFX     r2,r3,#8,#8
;;;948      cardinfo->SD_cid.OEM_AppliID |= tmp;
000280  8e4b              LDRH     r3,[r1,#0x32]
000282  4313              ORRS     r3,r3,r2
000284  864b              STRH     r3,[r1,#0x32]
;;;949    
;;;950      /*!< Byte 3 */
;;;951      tmp = (uint8_t)(CID_Tab[0] & 0x000000FF);
000286  4b31              LDR      r3,|L18.844|
000288  781a              LDRB     r2,[r3,#0]  ; CID_Tab
;;;952      cardinfo->SD_cid.ProdName1 = tmp << 24;
00028a  0614              LSLS     r4,r2,#24
00028c  634c              STR      r4,[r1,#0x34]
;;;953    
;;;954      /*!< Byte 4 */
;;;955      tmp = (uint8_t)((CID_Tab[1] & 0xFF000000) >> 24);
00028e  685b              LDR      r3,[r3,#4]  ; CID_Tab
000290  0e1a              LSRS     r2,r3,#24
;;;956      cardinfo->SD_cid.ProdName1 |= tmp << 16;
000292  6b4b              LDR      r3,[r1,#0x34]
000294  ea434402          ORR      r4,r3,r2,LSL #16
000298  634c              STR      r4,[r1,#0x34]
;;;957    
;;;958      /*!< Byte 5 */
;;;959      tmp = (uint8_t)((CID_Tab[1] & 0x00FF0000) >> 16);
00029a  4b2c              LDR      r3,|L18.844|
00029c  685b              LDR      r3,[r3,#4]  ; CID_Tab
00029e  f3c34207          UBFX     r2,r3,#16,#8
;;;960      cardinfo->SD_cid.ProdName1 |= tmp << 8;
0002a2  6b4b              LDR      r3,[r1,#0x34]
0002a4  ea432402          ORR      r4,r3,r2,LSL #8
0002a8  634c              STR      r4,[r1,#0x34]
;;;961    
;;;962      /*!< Byte 6 */
;;;963      tmp = (uint8_t)((CID_Tab[1] & 0x0000FF00) >> 8);
0002aa  4b28              LDR      r3,|L18.844|
0002ac  889b              LDRH     r3,[r3,#4]  ; CID_Tab
0002ae  f3c32207          UBFX     r2,r3,#8,#8
;;;964      cardinfo->SD_cid.ProdName1 |= tmp;
0002b2  6b4b              LDR      r3,[r1,#0x34]
0002b4  4313              ORRS     r3,r3,r2
0002b6  634b              STR      r3,[r1,#0x34]
;;;965    
;;;966      /*!< Byte 7 */
;;;967      tmp = (uint8_t)(CID_Tab[1] & 0x000000FF);
0002b8  4b24              LDR      r3,|L18.844|
0002ba  791a              LDRB     r2,[r3,#4]  ; CID_Tab
;;;968      cardinfo->SD_cid.ProdName2 = tmp;
0002bc  2338              MOVS     r3,#0x38
0002be  545a              STRB     r2,[r3,r1]
;;;969    
;;;970      /*!< Byte 8 */
;;;971      tmp = (uint8_t)((CID_Tab[2] & 0xFF000000) >> 24);
0002c0  4b22              LDR      r3,|L18.844|
0002c2  689b              LDR      r3,[r3,#8]  ; CID_Tab
0002c4  0e1a              LSRS     r2,r3,#24
;;;972      cardinfo->SD_cid.ProdRev = tmp;
0002c6  2339              MOVS     r3,#0x39
0002c8  545a              STRB     r2,[r3,r1]
;;;973    
;;;974      /*!< Byte 9 */
;;;975      tmp = (uint8_t)((CID_Tab[2] & 0x00FF0000) >> 16);
0002ca  4b20              LDR      r3,|L18.844|
0002cc  689b              LDR      r3,[r3,#8]  ; CID_Tab
0002ce  f3c34207          UBFX     r2,r3,#16,#8
;;;976      cardinfo->SD_cid.ProdSN = tmp << 24;
0002d2  0614              LSLS     r4,r2,#24
0002d4  63cc              STR      r4,[r1,#0x3c]
;;;977    
;;;978      /*!< Byte 10 */
;;;979      tmp = (uint8_t)((CID_Tab[2] & 0x0000FF00) >> 8);
0002d6  4b1d              LDR      r3,|L18.844|
0002d8  891b              LDRH     r3,[r3,#8]  ; CID_Tab
0002da  f3c32207          UBFX     r2,r3,#8,#8
;;;980      cardinfo->SD_cid.ProdSN |= tmp << 16;
0002de  6bcb              LDR      r3,[r1,#0x3c]
0002e0  ea434402          ORR      r4,r3,r2,LSL #16
0002e4  63cc              STR      r4,[r1,#0x3c]
;;;981    
;;;982      /*!< Byte 11 */
;;;983      tmp = (uint8_t)(CID_Tab[2] & 0x000000FF);
0002e6  4b19              LDR      r3,|L18.844|
0002e8  7a1a              LDRB     r2,[r3,#8]  ; CID_Tab
;;;984      cardinfo->SD_cid.ProdSN |= tmp << 8;
0002ea  6bcb              LDR      r3,[r1,#0x3c]
0002ec  ea432402          ORR      r4,r3,r2,LSL #8
0002f0  63cc              STR      r4,[r1,#0x3c]
;;;985    
;;;986      /*!< Byte 12 */
;;;987      tmp = (uint8_t)((CID_Tab[3] & 0xFF000000) >> 24);
0002f2  4b16              LDR      r3,|L18.844|
0002f4  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
0002f6  0e1a              LSRS     r2,r3,#24
;;;988      cardinfo->SD_cid.ProdSN |= tmp;
0002f8  6bcb              LDR      r3,[r1,#0x3c]
0002fa  4313              ORRS     r3,r3,r2
0002fc  63cb              STR      r3,[r1,#0x3c]
;;;989    
;;;990      /*!< Byte 13 */
;;;991      tmp = (uint8_t)((CID_Tab[3] & 0x00FF0000) >> 16);
0002fe  4b13              LDR      r3,|L18.844|
000300  68db              LDR      r3,[r3,#0xc]  ; CID_Tab
000302  f3c34207          UBFX     r2,r3,#16,#8
;;;992      cardinfo->SD_cid.Reserved1 |= (tmp & 0xF0) >> 4;
000306  2340              MOVS     r3,#0x40
000308  5c5b              LDRB     r3,[r3,r1]
00030a  ea431412          ORR      r4,r3,r2,LSR #4
00030e  2340              MOVS     r3,#0x40
000310  545c              STRB     r4,[r3,r1]
;;;993      cardinfo->SD_cid.ManufactDate = (tmp & 0x0F) << 8;
000312  0713              LSLS     r3,r2,#28
000314  0d1c              LSRS     r4,r3,#20
000316  2342              MOVS     r3,#0x42
000318  525c              STRH     r4,[r3,r1]
;;;994    
;;;995      /*!< Byte 14 */
;;;996      tmp = (uint8_t)((CID_Tab[3] & 0x0000FF00) >> 8);
00031a  4b0c              LDR      r3,|L18.844|
00031c  899b              LDRH     r3,[r3,#0xc]  ; CID_Tab
00031e  f3c32207          UBFX     r2,r3,#8,#8
;;;997      cardinfo->SD_cid.ManufactDate |= tmp;
000322  2342              MOVS     r3,#0x42
000324  5a5b              LDRH     r3,[r3,r1]
000326  4313              ORRS     r3,r3,r2
000328  2442              MOVS     r4,#0x42
00032a  5263              STRH     r3,[r4,r1]
;;;998    
;;;999      /*!< Byte 15 */
;;;1000     tmp = (uint8_t)(CID_Tab[3] & 0x000000FF);
00032c  4b07              LDR      r3,|L18.844|
00032e  7b1a              LDRB     r2,[r3,#0xc]  ; CID_Tab
;;;1001     cardinfo->SD_cid.CID_CRC = (tmp & 0xFE) >> 1;
000330  0854              LSRS     r4,r2,#1
000332  2344              MOVS     r3,#0x44
000334  545c              STRB     r4,[r3,r1]
;;;1002     cardinfo->SD_cid.Reserved2 = 1;
000336  2401              MOVS     r4,#1
000338  2345              MOVS     r3,#0x45
00033a  545c              STRB     r4,[r3,r1]
;;;1003     
;;;1004     return(errorstatus);
;;;1005   }
00033c  bdf0              POP      {r4-r7,pc}
;;;1006   
                          ENDP

00033e  0000              DCW      0x0000
                  |L18.832|
                          DCD      CardType
                  |L18.836|
                          DCD      ||RCA||
                  |L18.840|
                          DCD      CSD_Tab
                  |L18.844|
                          DCD      CID_Tab

                          AREA ||i.SD_GetCardStatus||, CODE, READONLY, ALIGN=2

                  SD_GetCardStatus PROC
;;;1016     */
;;;1017   SD_Error SD_GetCardStatus(SD_CardStatus *cardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1018   {
000002  4604              MOV      r4,r0
;;;1019     SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;1020     uint8_t tmp = 0;
000006  2500              MOVS     r5,#0
;;;1021   
;;;1022     errorstatus = SD_SendSDStatus((uint32_t *)SDSTATUS_Tab);
000008  4824              LDR      r0,|L19.156|
00000a  f7fffffe          BL       SD_SendSDStatus
00000e  4606              MOV      r6,r0
;;;1023   
;;;1024     if (errorstatus  != SD_OK)
000010  b10e              CBZ      r6,|L19.22|
;;;1025     {
;;;1026       return(errorstatus);
000012  4630              MOV      r0,r6
                  |L19.20|
;;;1027     }
;;;1028   
;;;1029     /*!< Byte 0 */
;;;1030     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0xC0) >> 6);
;;;1031     cardstatus->DAT_BUS_WIDTH = tmp;
;;;1032   
;;;1033     /*!< Byte 0 */
;;;1034     tmp = (uint8_t)((SDSTATUS_Tab[0] & 0x20) >> 5);
;;;1035     cardstatus->SECURED_MODE = tmp;
;;;1036   
;;;1037     /*!< Byte 2 */
;;;1038     tmp = (uint8_t)((SDSTATUS_Tab[2] & 0xFF));
;;;1039     cardstatus->SD_CARD_TYPE = tmp << 8;
;;;1040   
;;;1041     /*!< Byte 3 */
;;;1042     tmp = (uint8_t)((SDSTATUS_Tab[3] & 0xFF));
;;;1043     cardstatus->SD_CARD_TYPE |= tmp;
;;;1044   
;;;1045     /*!< Byte 4 */
;;;1046     tmp = (uint8_t)(SDSTATUS_Tab[4] & 0xFF);
;;;1047     cardstatus->SIZE_OF_PROTECTED_AREA = tmp << 24;
;;;1048   
;;;1049     /*!< Byte 5 */
;;;1050     tmp = (uint8_t)(SDSTATUS_Tab[5] & 0xFF);
;;;1051     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 16;
;;;1052   
;;;1053     /*!< Byte 6 */
;;;1054     tmp = (uint8_t)(SDSTATUS_Tab[6] & 0xFF);
;;;1055     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp << 8;
;;;1056   
;;;1057     /*!< Byte 7 */
;;;1058     tmp = (uint8_t)(SDSTATUS_Tab[7] & 0xFF);
;;;1059     cardstatus->SIZE_OF_PROTECTED_AREA |= tmp;
;;;1060   
;;;1061     /*!< Byte 8 */
;;;1062     tmp = (uint8_t)((SDSTATUS_Tab[8] & 0xFF));
;;;1063     cardstatus->SPEED_CLASS = tmp;
;;;1064   
;;;1065     /*!< Byte 9 */
;;;1066     tmp = (uint8_t)((SDSTATUS_Tab[9] & 0xFF));
;;;1067     cardstatus->PERFORMANCE_MOVE = tmp;
;;;1068   
;;;1069     /*!< Byte 10 */
;;;1070     tmp = (uint8_t)((SDSTATUS_Tab[10] & 0xF0) >> 4);
;;;1071     cardstatus->AU_SIZE = tmp;
;;;1072   
;;;1073     /*!< Byte 11 */
;;;1074     tmp = (uint8_t)(SDSTATUS_Tab[11] & 0xFF);
;;;1075     cardstatus->ERASE_SIZE = tmp << 8;
;;;1076   
;;;1077     /*!< Byte 12 */
;;;1078     tmp = (uint8_t)(SDSTATUS_Tab[12] & 0xFF);
;;;1079     cardstatus->ERASE_SIZE |= tmp;
;;;1080   
;;;1081     /*!< Byte 13 */
;;;1082     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0xFC) >> 2);
;;;1083     cardstatus->ERASE_TIMEOUT = tmp;
;;;1084   
;;;1085     /*!< Byte 13 */
;;;1086     tmp = (uint8_t)((SDSTATUS_Tab[13] & 0x3));
;;;1087     cardstatus->ERASE_OFFSET = tmp;
;;;1088    
;;;1089     return(errorstatus);
;;;1090   }
000014  bd70              POP      {r4-r6,pc}
                  |L19.22|
000016  4821              LDR      r0,|L19.156|
000018  7800              LDRB     r0,[r0,#0]            ;1030  ; SDSTATUS_Tab
00001a  0985              LSRS     r5,r0,#6              ;1030
00001c  7025              STRB     r5,[r4,#0]            ;1031
00001e  481f              LDR      r0,|L19.156|
000020  7800              LDRB     r0,[r0,#0]            ;1034  ; SDSTATUS_Tab
000022  f3c01540          UBFX     r5,r0,#5,#1           ;1034
000026  7065              STRB     r5,[r4,#1]            ;1035
000028  481c              LDR      r0,|L19.156|
00002a  7885              LDRB     r5,[r0,#2]            ;1038  ; SDSTATUS_Tab
00002c  0228              LSLS     r0,r5,#8              ;1039
00002e  8060              STRH     r0,[r4,#2]            ;1039
000030  481a              LDR      r0,|L19.156|
000032  78c5              LDRB     r5,[r0,#3]            ;1042  ; SDSTATUS_Tab
000034  8860              LDRH     r0,[r4,#2]            ;1043
000036  4328              ORRS     r0,r0,r5              ;1043
000038  8060              STRH     r0,[r4,#2]            ;1043
00003a  4818              LDR      r0,|L19.156|
00003c  7905              LDRB     r5,[r0,#4]            ;1046  ; SDSTATUS_Tab
00003e  0628              LSLS     r0,r5,#24             ;1047
000040  6060              STR      r0,[r4,#4]            ;1047
000042  4816              LDR      r0,|L19.156|
000044  7945              LDRB     r5,[r0,#5]            ;1050  ; SDSTATUS_Tab
000046  6860              LDR      r0,[r4,#4]            ;1051
000048  ea404005          ORR      r0,r0,r5,LSL #16      ;1051
00004c  6060              STR      r0,[r4,#4]            ;1051
00004e  4813              LDR      r0,|L19.156|
000050  7985              LDRB     r5,[r0,#6]            ;1054  ; SDSTATUS_Tab
000052  6860              LDR      r0,[r4,#4]            ;1055
000054  ea402005          ORR      r0,r0,r5,LSL #8       ;1055
000058  6060              STR      r0,[r4,#4]            ;1055
00005a  4810              LDR      r0,|L19.156|
00005c  79c5              LDRB     r5,[r0,#7]            ;1058  ; SDSTATUS_Tab
00005e  6860              LDR      r0,[r4,#4]            ;1059
000060  4328              ORRS     r0,r0,r5              ;1059
000062  6060              STR      r0,[r4,#4]            ;1059
000064  480d              LDR      r0,|L19.156|
000066  7a05              LDRB     r5,[r0,#8]            ;1062  ; SDSTATUS_Tab
000068  7225              STRB     r5,[r4,#8]            ;1063
00006a  7a45              LDRB     r5,[r0,#9]            ;1066  ; SDSTATUS_Tab
00006c  7265              STRB     r5,[r4,#9]            ;1067
00006e  7a80              LDRB     r0,[r0,#0xa]          ;1070  ; SDSTATUS_Tab
000070  0905              LSRS     r5,r0,#4              ;1070
000072  72a5              STRB     r5,[r4,#0xa]          ;1071
000074  4809              LDR      r0,|L19.156|
000076  7ac5              LDRB     r5,[r0,#0xb]          ;1074  ; SDSTATUS_Tab
000078  0228              LSLS     r0,r5,#8              ;1075
00007a  81a0              STRH     r0,[r4,#0xc]          ;1075
00007c  4807              LDR      r0,|L19.156|
00007e  7b05              LDRB     r5,[r0,#0xc]          ;1078  ; SDSTATUS_Tab
000080  89a0              LDRH     r0,[r4,#0xc]          ;1079
000082  4328              ORRS     r0,r0,r5              ;1079
000084  81a0              STRH     r0,[r4,#0xc]          ;1079
000086  4805              LDR      r0,|L19.156|
000088  7b40              LDRB     r0,[r0,#0xd]          ;1082  ; SDSTATUS_Tab
00008a  0885              LSRS     r5,r0,#2              ;1082
00008c  73a5              STRB     r5,[r4,#0xe]          ;1083
00008e  4803              LDR      r0,|L19.156|
000090  7b40              LDRB     r0,[r0,#0xd]          ;1086  ; SDSTATUS_Tab
000092  f0000503          AND      r5,r0,#3              ;1086
000096  73e5              STRB     r5,[r4,#0xf]          ;1087
000098  4630              MOV      r0,r6                 ;1089
00009a  e7bb              B        |L19.20|
;;;1091   
                          ENDP

                  |L19.156|
                          DCD      SDSTATUS_Tab

                          AREA ||i.SD_GetState||, CODE, READONLY, ALIGN=1

                  SD_GetState PROC
;;;512      */
;;;513    SDCardState SD_GetState(void)
000000  b508              PUSH     {r3,lr}
;;;514    {
;;;515      uint32_t resp1 = 0;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;516      
;;;517      if(SD_Detect()== SD_PRESENT)
000006  f7fffffe          BL       SD_Detect
00000a  2801              CMP      r0,#1
00000c  d109              BNE      |L20.34|
;;;518      {
;;;519        if (SD_SendStatus(&resp1) != SD_OK)
00000e  4668              MOV      r0,sp
000010  f7fffffe          BL       SD_SendStatus
000014  b108              CBZ      r0,|L20.26|
;;;520        {
;;;521          return SD_CARD_ERROR;
000016  20ff              MOVS     r0,#0xff
                  |L20.24|
;;;522        }
;;;523        else
;;;524        {
;;;525          return (SDCardState)((resp1 >> 9) & 0x0F);
;;;526        }
;;;527      }
;;;528      else
;;;529      {
;;;530        return SD_CARD_ERROR;
;;;531      }
;;;532    }
000018  bd08              POP      {r3,pc}
                  |L20.26|
00001a  9800              LDR      r0,[sp,#0]            ;525
00001c  f3c02043          UBFX     r0,r0,#9,#4           ;525
000020  e7fa              B        |L20.24|
                  |L20.34|
000022  20ff              MOVS     r0,#0xff              ;530
000024  e7f8              B        |L20.24|
;;;533    
                          ENDP


                          AREA ||i.SD_GetStatus||, CODE, READONLY, ALIGN=1

                  SD_GetStatus PROC
;;;487      */
;;;488    SDTransferState SD_GetStatus(void)
000000  b510              PUSH     {r4,lr}
;;;489    {
;;;490      SDCardState cardstate =  SD_CARD_TRANSFER;
000002  2404              MOVS     r4,#4
;;;491    
;;;492      cardstate = SD_GetState();
000004  f7fffffe          BL       SD_GetState
000008  4604              MOV      r4,r0
;;;493      
;;;494      if (cardstate == SD_CARD_TRANSFER)
00000a  2c04              CMP      r4,#4
00000c  d101              BNE      |L21.18|
;;;495      {
;;;496        return(SD_TRANSFER_OK);
00000e  2000              MOVS     r0,#0
                  |L21.16|
;;;497      }
;;;498      else if(cardstate == SD_CARD_ERROR)
;;;499      {
;;;500        return (SD_TRANSFER_ERROR);
;;;501      }
;;;502      else
;;;503      {
;;;504        return(SD_TRANSFER_BUSY);
;;;505      }
;;;506    }
000010  bd10              POP      {r4,pc}
                  |L21.18|
000012  2cff              CMP      r4,#0xff              ;498
000014  d101              BNE      |L21.26|
000016  2002              MOVS     r0,#2                 ;500
000018  e7fa              B        |L21.16|
                  |L21.26|
00001a  2001              MOVS     r0,#1                 ;504
00001c  e7f8              B        |L21.16|
;;;507    
                          ENDP


                          AREA ||i.SD_GetTransferState||, CODE, READONLY, ALIGN=2

                  SD_GetTransferState PROC
;;;1736     */
;;;1737   SDTransferState SD_GetTransferState(void)
000000  4804              LDR      r0,|L22.20|
;;;1738   {
;;;1739     if (SDIO->STA & (SDIO_FLAG_TXACT | SDIO_FLAG_RXACT))
000002  6b40              LDR      r0,[r0,#0x34]
000004  f4005040          AND      r0,r0,#0x3000
000008  b108              CBZ      r0,|L22.14|
;;;1740     {
;;;1741       return(SD_TRANSFER_BUSY);
00000a  2001              MOVS     r0,#1
                  |L22.12|
;;;1742     }
;;;1743     else
;;;1744     {
;;;1745       return(SD_TRANSFER_OK);
;;;1746     }
;;;1747   }
00000c  4770              BX       lr
                  |L22.14|
00000e  2000              MOVS     r0,#0                 ;1745
000010  e7fc              B        |L22.12|
;;;1748   
                          ENDP

000012  0000              DCW      0x0000
                  |L22.20|
                          DCD      0x40018000

                          AREA ||i.SD_Init||, CODE, READONLY, ALIGN=2

                  SD_Init PROC
;;;424      */
;;;425    SD_Error SD_Init(void)
000000  b508              PUSH     {r3,lr}
;;;426    {
;;;427      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;428      
;;;429      /* ÅäÖÃNVIC */
;;;430      SDIO_Interrupts_Config();
000006  f7fffffe          BL       SDIO_Interrupts_Config
;;;431    	
;;;432      /* SDIO Peripheral Low Level Init */
;;;433      SD_LowLevel_Init();
00000a  f7fffffe          BL       SD_LowLevel_Init
;;;434    
;;;435      SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;436    
;;;437      errorstatus = SD_PowerON();
000012  f7fffffe          BL       SD_PowerON
000016  9000              STR      r0,[sp,#0]
;;;438    
;;;439      if (errorstatus != SD_OK)
000018  f89d0000          LDRB     r0,[sp,#0]
00001c  b110              CBZ      r0,|L23.36|
;;;440      {
;;;441        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;442        return(errorstatus);
00001e  f89d0000          LDRB     r0,[sp,#0]
                  |L23.34|
;;;443      }
;;;444    
;;;445      errorstatus = SD_InitializeCards();
;;;446    
;;;447      if (errorstatus != SD_OK)
;;;448      {
;;;449        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;450        return(errorstatus);
;;;451      }
;;;452    
;;;453      /*!< Configure the SDIO peripheral */
;;;454      /*!< SDIO_CK = SDIOCLK / (SDIO_TRANSFER_CLK_DIV + 2) */
;;;455      SDIO_InitStructure.SDIO_ClockDiv = SDIO_TRANSFER_CLK_DIV;
;;;456      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
;;;457      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
;;;458      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
;;;459      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
;;;460      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
;;;461      SDIO_Init(&SDIO_InitStructure);
;;;462    
;;;463      /*----------------- Read CSD/CID MSD registers ------------------*/
;;;464      errorstatus = SD_GetCardInfo(&SDCardInfo);
;;;465    
;;;466      if (errorstatus == SD_OK)
;;;467      {
;;;468        /*----------------- Select Card --------------------------------*/
;;;469        errorstatus = SD_SelectDeselect((uint32_t) (SDCardInfo.RCA << 16));
;;;470      }
;;;471    
;;;472      if (errorstatus == SD_OK)
;;;473      {
;;;474        errorstatus = SD_EnableWideBusOperation(SDIO_BusWide_4b);
;;;475      }  
;;;476    
;;;477      return(errorstatus);
;;;478    }
000022  bd08              POP      {r3,pc}
                  |L23.36|
000024  f7fffffe          BL       SD_InitializeCards
000028  9000              STR      r0,[sp,#0]            ;445
00002a  f89d0000          LDRB     r0,[sp,#0]            ;447
00002e  b110              CBZ      r0,|L23.54|
000030  f89d0000          LDRB     r0,[sp,#0]            ;450
000034  e7f5              B        |L23.34|
                  |L23.54|
000036  2001              MOVS     r0,#1                 ;455
000038  4912              LDR      r1,|L23.132|
00003a  7508              STRB     r0,[r1,#0x14]         ;455
00003c  2000              MOVS     r0,#0                 ;456
00003e  6008              STR      r0,[r1,#0]            ;456  ; SDIO_InitStructure
000040  6048              STR      r0,[r1,#4]            ;457  ; SDIO_InitStructure
000042  6088              STR      r0,[r1,#8]            ;458  ; SDIO_InitStructure
000044  60c8              STR      r0,[r1,#0xc]          ;459  ; SDIO_InitStructure
000046  6108              STR      r0,[r1,#0x10]         ;460  ; SDIO_InitStructure
000048  4608              MOV      r0,r1                 ;461
00004a  f7fffffe          BL       SDIO_Init
00004e  480e              LDR      r0,|L23.136|
000050  f7fffffe          BL       SD_GetCardInfo
000054  9000              STR      r0,[sp,#0]            ;464
000056  f89d0000          LDRB     r0,[sp,#0]            ;466
00005a  b940              CBNZ     r0,|L23.110|
00005c  480a              LDR      r0,|L23.136|
00005e  f8b00054          LDRH     r0,[r0,#0x54]         ;469  ; SDCardInfo
000062  0402              LSLS     r2,r0,#16             ;469
000064  4610              MOV      r0,r2                 ;469
000066  2100              MOVS     r1,#0                 ;469
000068  f7fffffe          BL       SD_SelectDeselect
00006c  9000              STR      r0,[sp,#0]            ;469
                  |L23.110|
00006e  f89d0000          LDRB     r0,[sp,#0]            ;472
000072  b920              CBNZ     r0,|L23.126|
000074  f44f6000          MOV      r0,#0x800             ;474
000078  f7fffffe          BL       SD_EnableWideBusOperation
00007c  9000              STR      r0,[sp,#0]            ;474
                  |L23.126|
00007e  f89d0000          LDRB     r0,[sp,#0]            ;477
000082  e7ce              B        |L23.34|
;;;479    
                          ENDP

                  |L23.132|
                          DCD      SDIO_InitStructure
                  |L23.136|
                          DCD      SDCardInfo

                          AREA ||i.SD_InitializeCards||, CODE, READONLY, ALIGN=2

                  SD_InitializeCards PROC
;;;715      */
;;;716    SD_Error SD_InitializeCards(void)
000000  b538              PUSH     {r3-r5,lr}
;;;717    {
;;;718      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;719      uint16_t rca = 0x01;
000004  2001              MOVS     r0,#1
000006  9000              STR      r0,[sp,#0]
;;;720    
;;;721      if (SDIO_GetPowerState() == SDIO_PowerState_OFF)
000008  f7fffffe          BL       SDIO_GetPowerState
00000c  b910              CBNZ     r0,|L24.20|
;;;722      {
;;;723        errorstatus = SD_REQUEST_NOT_APPLICABLE;
00000e  2425              MOVS     r4,#0x25
;;;724        return(errorstatus);
000010  4620              MOV      r0,r4
                  |L24.18|
;;;725      }
;;;726    
;;;727      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;728      {
;;;729        /*!< Send CMD2 ALL_SEND_CID */
;;;730        SDIO_CmdInitStructure.SDIO_Argument = 0x0;
;;;731        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_ALL_SEND_CID;
;;;732        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;733        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;734        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;735        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;736    
;;;737        errorstatus = CmdResp2Error();
;;;738    
;;;739        if (SD_OK != errorstatus)
;;;740        {
;;;741          return(errorstatus);
;;;742        }
;;;743    
;;;744        CID_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;745        CID_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;746        CID_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;747        CID_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;748      }
;;;749      if ((SDIO_STD_CAPACITY_SD_CARD_V1_1 == CardType) ||  (SDIO_STD_CAPACITY_SD_CARD_V2_0 == CardType) ||  (SDIO_SECURE_DIGITAL_IO_COMBO_CARD == CardType)
;;;750          ||  (SDIO_HIGH_CAPACITY_SD_CARD == CardType))
;;;751      {
;;;752        /*!< Send CMD3 SET_REL_ADDR with argument 0 */
;;;753        /*!< SD Card publishes its RCA. */
;;;754        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;755        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_REL_ADDR;
;;;756        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;757        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;758        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;759        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;760    
;;;761        errorstatus = CmdResp6Error(SD_CMD_SET_REL_ADDR, &rca);
;;;762    
;;;763        if (SD_OK != errorstatus)
;;;764        {
;;;765          return(errorstatus);
;;;766        }
;;;767      }
;;;768    
;;;769      if (SDIO_SECURE_DIGITAL_IO_CARD != CardType)
;;;770      {
;;;771        RCA = rca;
;;;772    
;;;773        /*!< Send CMD9 SEND_CSD with argument as card's RCA */
;;;774        SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)(rca << 16);
;;;775        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_CSD;
;;;776        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Long;
;;;777        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;778        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;779        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;780    
;;;781        errorstatus = CmdResp2Error();
;;;782    
;;;783        if (SD_OK != errorstatus)
;;;784        {
;;;785          return(errorstatus);
;;;786        }
;;;787    
;;;788        CSD_Tab[0] = SDIO_GetResponse(SDIO_RESP1);
;;;789        CSD_Tab[1] = SDIO_GetResponse(SDIO_RESP2);
;;;790        CSD_Tab[2] = SDIO_GetResponse(SDIO_RESP3);
;;;791        CSD_Tab[3] = SDIO_GetResponse(SDIO_RESP4);
;;;792      }
;;;793    
;;;794      errorstatus = SD_OK; /*!< All cards get intialized */
;;;795    
;;;796      return(errorstatus);
;;;797    }
000012  bd38              POP      {r3-r5,pc}
                  |L24.20|
000014  4844              LDR      r0,|L24.296|
000016  6800              LDR      r0,[r0,#0]            ;727  ; CardType
000018  2804              CMP      r0,#4                 ;727
00001a  d028              BEQ      |L24.110|
00001c  2000              MOVS     r0,#0                 ;730
00001e  4943              LDR      r1,|L24.300|
000020  6008              STR      r0,[r1,#0]            ;730  ; SDIO_CmdInitStructure
000022  2002              MOVS     r0,#2                 ;731
000024  6048              STR      r0,[r1,#4]            ;731  ; SDIO_CmdInitStructure
000026  20c0              MOVS     r0,#0xc0              ;732
000028  6088              STR      r0,[r1,#8]            ;732  ; SDIO_CmdInitStructure
00002a  2000              MOVS     r0,#0                 ;733
00002c  60c8              STR      r0,[r1,#0xc]          ;733  ; SDIO_CmdInitStructure
00002e  f44f6080          MOV      r0,#0x400             ;734
000032  6108              STR      r0,[r1,#0x10]         ;734  ; SDIO_CmdInitStructure
000034  4608              MOV      r0,r1                 ;735
000036  f7fffffe          BL       SDIO_SendCommand
00003a  f7fffffe          BL       CmdResp2Error
00003e  4604              MOV      r4,r0                 ;737
000040  b10c              CBZ      r4,|L24.70|
000042  4620              MOV      r0,r4                 ;741
000044  e7e5              B        |L24.18|
                  |L24.70|
000046  2000              MOVS     r0,#0                 ;744
000048  f7fffffe          BL       SDIO_GetResponse
00004c  4938              LDR      r1,|L24.304|
00004e  6008              STR      r0,[r1,#0]            ;744  ; CID_Tab
000050  2004              MOVS     r0,#4                 ;745
000052  f7fffffe          BL       SDIO_GetResponse
000056  4936              LDR      r1,|L24.304|
000058  6048              STR      r0,[r1,#4]            ;745  ; CID_Tab
00005a  2008              MOVS     r0,#8                 ;746
00005c  f7fffffe          BL       SDIO_GetResponse
000060  4933              LDR      r1,|L24.304|
000062  6088              STR      r0,[r1,#8]            ;746  ; CID_Tab
000064  200c              MOVS     r0,#0xc               ;747
000066  f7fffffe          BL       SDIO_GetResponse
00006a  4931              LDR      r1,|L24.304|
00006c  60c8              STR      r0,[r1,#0xc]          ;747  ; CID_Tab
                  |L24.110|
00006e  482e              LDR      r0,|L24.296|
000070  6800              LDR      r0,[r0,#0]            ;749  ; CardType
000072  b158              CBZ      r0,|L24.140|
000074  482c              LDR      r0,|L24.296|
000076  6800              LDR      r0,[r0,#0]            ;749  ; CardType
000078  2801              CMP      r0,#1                 ;749
00007a  d007              BEQ      |L24.140|
00007c  482a              LDR      r0,|L24.296|
00007e  6800              LDR      r0,[r0,#0]            ;749  ; CardType
000080  2806              CMP      r0,#6                 ;749
000082  d003              BEQ      |L24.140|
000084  4828              LDR      r0,|L24.296|
000086  6800              LDR      r0,[r0,#0]            ;750  ; CardType
000088  2802              CMP      r0,#2                 ;750
00008a  d116              BNE      |L24.186|
                  |L24.140|
00008c  2000              MOVS     r0,#0                 ;754
00008e  4927              LDR      r1,|L24.300|
000090  6008              STR      r0,[r1,#0]            ;754  ; SDIO_CmdInitStructure
000092  2003              MOVS     r0,#3                 ;755
000094  6048              STR      r0,[r1,#4]            ;755  ; SDIO_CmdInitStructure
000096  2040              MOVS     r0,#0x40              ;756
000098  6088              STR      r0,[r1,#8]            ;756  ; SDIO_CmdInitStructure
00009a  2000              MOVS     r0,#0                 ;757
00009c  60c8              STR      r0,[r1,#0xc]          ;757  ; SDIO_CmdInitStructure
00009e  f44f6080          MOV      r0,#0x400             ;758
0000a2  6108              STR      r0,[r1,#0x10]         ;758  ; SDIO_CmdInitStructure
0000a4  4608              MOV      r0,r1                 ;759
0000a6  f7fffffe          BL       SDIO_SendCommand
0000aa  4669              MOV      r1,sp                 ;761
0000ac  2003              MOVS     r0,#3                 ;761
0000ae  f7fffffe          BL       CmdResp6Error
0000b2  4604              MOV      r4,r0                 ;761
0000b4  b10c              CBZ      r4,|L24.186|
0000b6  4620              MOV      r0,r4                 ;765
0000b8  e7ab              B        |L24.18|
                  |L24.186|
0000ba  481b              LDR      r0,|L24.296|
0000bc  6800              LDR      r0,[r0,#0]            ;769  ; CardType
0000be  2804              CMP      r0,#4                 ;769
0000c0  d02e              BEQ      |L24.288|
0000c2  f8bd0000          LDRH     r0,[sp,#0]            ;771
0000c6  491b              LDR      r1,|L24.308|
0000c8  6008              STR      r0,[r1,#0]            ;771  ; RCA
0000ca  f8bd0000          LDRH     r0,[sp,#0]            ;774
0000ce  0400              LSLS     r0,r0,#16             ;774
0000d0  4916              LDR      r1,|L24.300|
0000d2  6008              STR      r0,[r1,#0]            ;774  ; SDIO_CmdInitStructure
0000d4  2009              MOVS     r0,#9                 ;775
0000d6  6048              STR      r0,[r1,#4]            ;775  ; SDIO_CmdInitStructure
0000d8  20c0              MOVS     r0,#0xc0              ;776
0000da  6088              STR      r0,[r1,#8]            ;776  ; SDIO_CmdInitStructure
0000dc  2000              MOVS     r0,#0                 ;777
0000de  60c8              STR      r0,[r1,#0xc]          ;777  ; SDIO_CmdInitStructure
0000e0  f44f6080          MOV      r0,#0x400             ;778
0000e4  6108              STR      r0,[r1,#0x10]         ;778  ; SDIO_CmdInitStructure
0000e6  4608              MOV      r0,r1                 ;779
0000e8  f7fffffe          BL       SDIO_SendCommand
0000ec  f7fffffe          BL       CmdResp2Error
0000f0  4604              MOV      r4,r0                 ;781
0000f2  b10c              CBZ      r4,|L24.248|
0000f4  4620              MOV      r0,r4                 ;785
0000f6  e78c              B        |L24.18|
                  |L24.248|
0000f8  2000              MOVS     r0,#0                 ;788
0000fa  f7fffffe          BL       SDIO_GetResponse
0000fe  490e              LDR      r1,|L24.312|
000100  6008              STR      r0,[r1,#0]            ;788  ; CSD_Tab
000102  2004              MOVS     r0,#4                 ;789
000104  f7fffffe          BL       SDIO_GetResponse
000108  490b              LDR      r1,|L24.312|
00010a  6048              STR      r0,[r1,#4]            ;789  ; CSD_Tab
00010c  2008              MOVS     r0,#8                 ;790
00010e  f7fffffe          BL       SDIO_GetResponse
000112  4909              LDR      r1,|L24.312|
000114  6088              STR      r0,[r1,#8]            ;790  ; CSD_Tab
000116  200c              MOVS     r0,#0xc               ;791
000118  f7fffffe          BL       SDIO_GetResponse
00011c  4906              LDR      r1,|L24.312|
00011e  60c8              STR      r0,[r1,#0xc]          ;791  ; CSD_Tab
                  |L24.288|
000120  2400              MOVS     r4,#0                 ;794
000122  4620              MOV      r0,r4                 ;796
000124  e775              B        |L24.18|
;;;798    
                          ENDP

000126  0000              DCW      0x0000
                  |L24.296|
                          DCD      CardType
                  |L24.300|
                          DCD      SDIO_CmdInitStructure
                  |L24.304|
                          DCD      CID_Tab
                  |L24.308|
                          DCD      ||RCA||
                  |L24.312|
                          DCD      CSD_Tab

                          AREA ||i.SD_LowLevel_DMA_RxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_RxConfig PROC
;;;2964     */
;;;2965   void SD_LowLevel_DMA_RxConfig(uint32_t *BufferDST, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2966   {
000002  b08b              SUB      sp,sp,#0x2c
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
;;;2967   	DMA_InitTypeDef DMA_InitStructure;
;;;2968   	
;;;2969   	DMA_ClearFlag(SD_SDIO_DMA_FLAG_TC | SD_SDIO_DMA_FLAG_TE | SD_SDIO_DMA_FLAG_HT | SD_SDIO_DMA_FLAG_GL);
000008  4815              LDR      r0,|L25.96|
00000a  f7fffffe          BL       DMA_ClearFlag
;;;2970   	
;;;2971   	/*!< SDIO DMA CHANNEL disable */
;;;2972   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, DISABLE);
00000e  2100              MOVS     r1,#0
000010  4814              LDR      r0,|L25.100|
000012  f7fffffe          BL       DMA_Cmd
;;;2973   	
;;;2974   	/*!< SDIO DMA CHANNEL Config */
;;;2975   	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000016  4814              LDR      r0,|L25.104|
000018  9000              STR      r0,[sp,#0]
;;;2976   	DMA_InitStructure.DMA_MemoryBaseAddr = (uint32_t)BufferDST;
00001a  9501              STR      r5,[sp,#4]
;;;2977   	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralSRC;
00001c  2000              MOVS     r0,#0
00001e  9002              STR      r0,[sp,#8]
;;;2978   	DMA_InitStructure.DMA_BufferSize = BufferSize / 4;
000020  08a0              LSRS     r0,r4,#2
000022  9003              STR      r0,[sp,#0xc]
;;;2979   	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000024  2000              MOVS     r0,#0
000026  9004              STR      r0,[sp,#0x10]
;;;2980   	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000028  2080              MOVS     r0,#0x80
00002a  9005              STR      r0,[sp,#0x14]
;;;2981   	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00002c  0080              LSLS     r0,r0,#2
00002e  9006              STR      r0,[sp,#0x18]
;;;2982   	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
000030  0080              LSLS     r0,r0,#2
000032  9007              STR      r0,[sp,#0x1c]
;;;2983   	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000034  2000              MOVS     r0,#0
000036  9008              STR      r0,[sp,#0x20]
;;;2984   	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
000038  f44f5000          MOV      r0,#0x2000
00003c  9009              STR      r0,[sp,#0x24]
;;;2985   	DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
00003e  2000              MOVS     r0,#0
000040  900a              STR      r0,[sp,#0x28]
;;;2986   	DMA_Init(SD_SDIO_DMA_CHANNEL, &DMA_InitStructure);
000042  4669              MOV      r1,sp
000044  4807              LDR      r0,|L25.100|
000046  f7fffffe          BL       DMA_Init
;;;2987   	
;;;2988   	DMA_ITConfig(SD_SDIO_DMA_CHANNEL, DMA_IT_TC, ENABLE);
00004a  2201              MOVS     r2,#1
00004c  2102              MOVS     r1,#2
00004e  4805              LDR      r0,|L25.100|
000050  f7fffffe          BL       DMA_ITConfig
;;;2989   	
;;;2990   	/*!< SDIO DMA CHANNEL enable */
;;;2991   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, ENABLE);  
000054  2101              MOVS     r1,#1
000056  4803              LDR      r0,|L25.100|
000058  f7fffffe          BL       DMA_Cmd
;;;2992   }
00005c  b00b              ADD      sp,sp,#0x2c
00005e  bd30              POP      {r4,r5,pc}
;;;2993   
                          ENDP

                  |L25.96|
                          DCD      0x1000f000
                  |L25.100|
                          DCD      0x40020444
                  |L25.104|
                          DCD      0x40018080

                          AREA ||i.SD_LowLevel_DMA_TxConfig||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DMA_TxConfig PROC
;;;2929     */
;;;2930   void SD_LowLevel_DMA_TxConfig(uint32_t *BufferSRC, uint32_t BufferSize)
000000  b530              PUSH     {r4,r5,lr}
;;;2931   {
000002  b08b              SUB      sp,sp,#0x2c
000004  4605              MOV      r5,r0
000006  460c              MOV      r4,r1
;;;2932   	DMA_InitTypeDef DMA_InitStructure;
;;;2933   	
;;;2934   	DMA_ClearFlag(SD_SDIO_DMA_FLAG_TC | SD_SDIO_DMA_FLAG_TE | SD_SDIO_DMA_FLAG_HT | SD_SDIO_DMA_FLAG_GL);
000008  4815              LDR      r0,|L26.96|
00000a  f7fffffe          BL       DMA_ClearFlag
;;;2935   	
;;;2936   	/*!< DMA2 Channel4 disable */
;;;2937   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, DISABLE);
00000e  2100              MOVS     r1,#0
000010  4814              LDR      r0,|L26.100|
000012  f7fffffe          BL       DMA_Cmd
;;;2938   	
;;;2939   	/*!< SDIO DMA CHANNEL Config */
;;;2940   	DMA_InitStructure.DMA_PeripheralBaseAddr = (uint32_t)SDIO_FIFO_ADDRESS;
000016  4814              LDR      r0,|L26.104|
000018  9000              STR      r0,[sp,#0]
;;;2941   	DMA_InitStructure.DMA_MemoryBaseAddr = (uint32_t)BufferSRC;
00001a  9501              STR      r5,[sp,#4]
;;;2942   	DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralDST;
00001c  2010              MOVS     r0,#0x10
00001e  9002              STR      r0,[sp,#8]
;;;2943   	DMA_InitStructure.DMA_BufferSize = BufferSize / 4;
000020  08a0              LSRS     r0,r4,#2
000022  9003              STR      r0,[sp,#0xc]
;;;2944   	DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable;
000024  2000              MOVS     r0,#0
000026  9004              STR      r0,[sp,#0x10]
;;;2945   	DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;
000028  2080              MOVS     r0,#0x80
00002a  9005              STR      r0,[sp,#0x14]
;;;2946   	DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Word;
00002c  0080              LSLS     r0,r0,#2
00002e  9006              STR      r0,[sp,#0x18]
;;;2947   	DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Word;
000030  0080              LSLS     r0,r0,#2
000032  9007              STR      r0,[sp,#0x1c]
;;;2948   	DMA_InitStructure.DMA_Mode = DMA_Mode_Normal;
000034  2000              MOVS     r0,#0
000036  9008              STR      r0,[sp,#0x20]
;;;2949   	DMA_InitStructure.DMA_Priority = DMA_Priority_High;
000038  f44f5000          MOV      r0,#0x2000
00003c  9009              STR      r0,[sp,#0x24]
;;;2950   	DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
00003e  2000              MOVS     r0,#0
000040  900a              STR      r0,[sp,#0x28]
;;;2951   	DMA_Init(SD_SDIO_DMA_CHANNEL, &DMA_InitStructure);
000042  4669              MOV      r1,sp
000044  4807              LDR      r0,|L26.100|
000046  f7fffffe          BL       DMA_Init
;;;2952   	
;;;2953   	DMA_ITConfig(SD_SDIO_DMA_CHANNEL, DMA_IT_TC, ENABLE);
00004a  2201              MOVS     r2,#1
00004c  2102              MOVS     r1,#2
00004e  4805              LDR      r0,|L26.100|
000050  f7fffffe          BL       DMA_ITConfig
;;;2954   	
;;;2955   	/*!< SDIO DMA CHANNEL enable */
;;;2956   	DMA_Cmd(SD_SDIO_DMA_CHANNEL, ENABLE);  
000054  2101              MOVS     r1,#1
000056  4803              LDR      r0,|L26.100|
000058  f7fffffe          BL       DMA_Cmd
;;;2957   }
00005c  b00b              ADD      sp,sp,#0x2c
00005e  bd30              POP      {r4,r5,pc}
;;;2958   
                          ENDP

                  |L26.96|
                          DCD      0x1000f000
                  |L26.100|
                          DCD      0x40020444
                  |L26.104|
                          DCD      0x40018080

                          AREA ||i.SD_LowLevel_DeInit||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_DeInit PROC
;;;2862     */
;;;2863   void SD_LowLevel_DeInit(void)
000000  b508              PUSH     {r3,lr}
;;;2864   {
;;;2865   	GPIO_InitTypeDef  GPIO_InitStructure;
;;;2866   	
;;;2867   	/*!< Disable SDIO Clock */
;;;2868   	SDIO_ClockCmd(DISABLE);
000002  2000              MOVS     r0,#0
000004  f7fffffe          BL       SDIO_ClockCmd
;;;2869   	
;;;2870   	/*!< Set Power State to OFF */
;;;2871   	SDIO_SetPowerState(SDIO_PowerState_OFF);
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_SetPowerState
;;;2872   	
;;;2873   	/*!< DeInitializes the SDIO peripheral */
;;;2874   	SDIO_DeInit();
00000e  f7fffffe          BL       SDIO_DeInit
;;;2875   	
;;;2876   	/*!< Disable the SDIO AHB Clock */
;;;2877   	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_SDIO, DISABLE);
000012  2100              MOVS     r1,#0
000014  f44f6080          MOV      r0,#0x400
000018  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2878   	
;;;2879   	/*!< Configure PC.08, PC.09, PC.10, PC.11, PC.12 pin: D0, D1, D2, D3, CLK pin */
;;;2880   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12;
00001c  f44f50f8          MOV      r0,#0x1f00
000020  f8ad0000          STRH     r0,[sp,#0]
;;;2881   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
000024  2004              MOVS     r0,#4
000026  f88d0003          STRB     r0,[sp,#3]
;;;2882   	GPIO_Init(GPIOC, &GPIO_InitStructure);
00002a  4669              MOV      r1,sp
00002c  4805              LDR      r0,|L27.68|
00002e  f7fffffe          BL       GPIO_Init
;;;2883   	
;;;2884   	/*!< Configure PD.02 CMD line */
;;;2885   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000032  2004              MOVS     r0,#4
000034  f8ad0000          STRH     r0,[sp,#0]
;;;2886   	GPIO_Init(GPIOD, &GPIO_InitStructure);
000038  4669              MOV      r1,sp
00003a  4803              LDR      r0,|L27.72|
00003c  f7fffffe          BL       GPIO_Init
;;;2887   }
000040  bd08              POP      {r3,pc}
;;;2888   
                          ENDP

000042  0000              DCW      0x0000
                  |L27.68|
                          DCD      0x40011000
                  |L27.72|
                          DCD      0x40011400

                          AREA ||i.SD_LowLevel_Init||, CODE, READONLY, ALIGN=2

                  SD_LowLevel_Init PROC
;;;2894     */
;;;2895   void SD_LowLevel_Init(void)
000000  b508              PUSH     {r3,lr}
;;;2896   {
;;;2897   	GPIO_InitTypeDef  GPIO_InitStructure;
;;;2898   	
;;;2899   	/*!< GPIOC and GPIOD Periph clock enable */
;;;2900   	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC | RCC_APB2Periph_GPIOD | SD_DETECT_GPIO_CLK, ENABLE);
000002  2101              MOVS     r1,#1
000004  2030              MOVS     r0,#0x30
000006  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;2901   	
;;;2902   	/*!< Configure PC.08, PC.09, PC.10, PC.11, PC.12 pin: D0, D1, D2, D3, CLK pin */
;;;2903   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8 | GPIO_Pin_9 | GPIO_Pin_10 | GPIO_Pin_11 | GPIO_Pin_12;
00000a  f44f50f8          MOV      r0,#0x1f00
00000e  f8ad0000          STRH     r0,[sp,#0]
;;;2904   	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
000012  2003              MOVS     r0,#3
000014  f88d0002          STRB     r0,[sp,#2]
;;;2905   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
000018  2018              MOVS     r0,#0x18
00001a  f88d0003          STRB     r0,[sp,#3]
;;;2906   	GPIO_Init(GPIOC, &GPIO_InitStructure);
00001e  4669              MOV      r1,sp
000020  480e              LDR      r0,|L28.92|
000022  f7fffffe          BL       GPIO_Init
;;;2907   	
;;;2908   	/*!< Configure PD.02 CMD line */
;;;2909   	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;
000026  2004              MOVS     r0,#4
000028  f8ad0000          STRH     r0,[sp,#0]
;;;2910   	GPIO_Init(GPIOD, &GPIO_InitStructure);
00002c  4669              MOV      r1,sp
00002e  480c              LDR      r0,|L28.96|
000030  f7fffffe          BL       GPIO_Init
;;;2911   	
;;;2912   	/*!< Configure SD_SPI_DETECT_PIN pin: SD Card detect pin */
;;;2913   	GPIO_InitStructure.GPIO_Pin = SD_DETECT_PIN;
000034  2080              MOVS     r0,#0x80
000036  f8ad0000          STRH     r0,[sp,#0]
;;;2914   	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IPU;
00003a  2048              MOVS     r0,#0x48
00003c  f88d0003          STRB     r0,[sp,#3]
;;;2915   	GPIO_Init(SD_DETECT_GPIO_PORT, &GPIO_InitStructure);
000040  4669              MOV      r1,sp
000042  4806              LDR      r0,|L28.92|
000044  f7fffffe          BL       GPIO_Init
;;;2916   	
;;;2917   	/*!< Enable the SDIO AHB Clock */
;;;2918   	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_SDIO, ENABLE);
000048  2101              MOVS     r1,#1
00004a  0288              LSLS     r0,r1,#10
00004c  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2919   	
;;;2920   	/*!< Enable the DMA2 Clock */
;;;2921   	RCC_AHBPeriphClockCmd(SD_SDIO_DMA_CLK, ENABLE);
000050  2101              MOVS     r1,#1
000052  2002              MOVS     r0,#2
000054  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;2922   }
000058  bd08              POP      {r3,pc}
;;;2923   
                          ENDP

00005a  0000              DCW      0x0000
                  |L28.92|
                          DCD      0x40011000
                  |L28.96|
                          DCD      0x40011400

                          AREA ||i.SD_PowerOFF||, CODE, READONLY, ALIGN=1

                  SD_PowerOFF PROC
;;;699      */
;;;700    SD_Error SD_PowerOFF(void)
000000  b510              PUSH     {r4,lr}
;;;701    {
;;;702      SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;703    
;;;704      /*!< Set Power State to OFF */
;;;705      SDIO_SetPowerState(SDIO_PowerState_OFF);
000004  2000              MOVS     r0,#0
000006  f7fffffe          BL       SDIO_SetPowerState
;;;706    
;;;707      return(errorstatus);
00000a  4620              MOV      r0,r4
;;;708    }
00000c  bd10              POP      {r4,pc}
;;;709    
                          ENDP


                          AREA ||i.SD_PowerON||, CODE, READONLY, ALIGN=2

                  SD_PowerON PROC
;;;556      */
;;;557    SD_Error SD_PowerON(void)
000000  b5f8              PUSH     {r3-r7,lr}
;;;558    {
;;;559      __IO SD_Error errorstatus = SD_OK;
000002  2000              MOVS     r0,#0
000004  9000              STR      r0,[sp,#0]
;;;560      uint32_t response = 0, count = 0, validvoltage = 0;
000006  2500              MOVS     r5,#0
000008  2400              MOVS     r4,#0
00000a  2600              MOVS     r6,#0
;;;561      uint32_t SDType = SD_STD_CAPACITY;
00000c  2700              MOVS     r7,#0
;;;562    
;;;563      /*!< Power ON Sequence -----------------------------------------------------*/
;;;564      /*!< Configure the SDIO peripheral */
;;;565      /*!< SDIO_CK = SDIOCLK / (SDIO_INIT_CLK_DIV + 2) */
;;;566      /*!< SDIO_CK for initialization should not exceed 400 KHz */  
;;;567      SDIO_InitStructure.SDIO_ClockDiv = SDIO_INIT_CLK_DIV;
00000e  20b2              MOVS     r0,#0xb2
000010  495f              LDR      r1,|L30.400|
000012  7508              STRB     r0,[r1,#0x14]
;;;568      SDIO_InitStructure.SDIO_ClockEdge = SDIO_ClockEdge_Rising;
000014  2000              MOVS     r0,#0
000016  6008              STR      r0,[r1,#0]  ; SDIO_InitStructure
;;;569      SDIO_InitStructure.SDIO_ClockBypass = SDIO_ClockBypass_Disable;
000018  6048              STR      r0,[r1,#4]  ; SDIO_InitStructure
;;;570      SDIO_InitStructure.SDIO_ClockPowerSave = SDIO_ClockPowerSave_Disable;
00001a  6088              STR      r0,[r1,#8]  ; SDIO_InitStructure
;;;571      SDIO_InitStructure.SDIO_BusWide = SDIO_BusWide_1b;
00001c  60c8              STR      r0,[r1,#0xc]  ; SDIO_InitStructure
;;;572      SDIO_InitStructure.SDIO_HardwareFlowControl = SDIO_HardwareFlowControl_Disable;
00001e  6108              STR      r0,[r1,#0x10]  ; SDIO_InitStructure
;;;573      SDIO_Init(&SDIO_InitStructure);
000020  4608              MOV      r0,r1
000022  f7fffffe          BL       SDIO_Init
;;;574    
;;;575      /*!< Set Power State to ON */
;;;576      SDIO_SetPowerState(SDIO_PowerState_ON);
000026  2003              MOVS     r0,#3
000028  f7fffffe          BL       SDIO_SetPowerState
;;;577    
;;;578      /*!< Enable SDIO Clock */
;;;579      SDIO_ClockCmd(ENABLE);
00002c  2001              MOVS     r0,#1
00002e  f7fffffe          BL       SDIO_ClockCmd
;;;580    
;;;581      /*!< CMD0: GO_IDLE_STATE ---------------------------------------------------*/
;;;582      /*!< No CMD response required */
;;;583      SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000032  2000              MOVS     r0,#0
000034  4957              LDR      r1,|L30.404|
000036  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;584      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_GO_IDLE_STATE;
000038  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;585      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_No;
00003a  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;586      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00003c  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;587      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00003e  f44f6080          MOV      r0,#0x400
000042  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;588      SDIO_SendCommand(&SDIO_CmdInitStructure);
000044  4608              MOV      r0,r1
000046  f7fffffe          BL       SDIO_SendCommand
;;;589    
;;;590      errorstatus = CmdError();
00004a  f7fffffe          BL       CmdError
00004e  9000              STR      r0,[sp,#0]
;;;591    
;;;592      if (errorstatus != SD_OK)
000050  f89d0000          LDRB     r0,[sp,#0]
000054  b110              CBZ      r0,|L30.92|
;;;593      {
;;;594        /*!< CMD Response TimeOut (wait for CMDSENT flag) */
;;;595        return(errorstatus);
000056  f89d0000          LDRB     r0,[sp,#0]
                  |L30.90|
;;;596      }
;;;597    
;;;598      /*!< CMD8: SEND_IF_COND ----------------------------------------------------*/
;;;599      /*!< Send CMD8 to verify SD card interface operating condition */
;;;600      /*!< Argument: - [31:12]: Reserved (shall be set to '0')
;;;601                   - [11:8]: Supply Voltage (VHS) 0x1 (Range: 2.7-3.6 V)
;;;602                   - [7:0]: Check Pattern (recommended 0xAA) */
;;;603      /*!< CMD Response: R7 */
;;;604      SDIO_CmdInitStructure.SDIO_Argument = SD_CHECK_PATTERN;
;;;605      SDIO_CmdInitStructure.SDIO_CmdIndex = SDIO_SEND_IF_COND;
;;;606      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;607      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;608      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;609      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;610    
;;;611      errorstatus = CmdResp7Error();
;;;612    
;;;613      if (errorstatus == SD_OK)
;;;614      {
;;;615        CardType = SDIO_STD_CAPACITY_SD_CARD_V2_0; /*!< SD Card 2.0 */
;;;616        SDType = SD_HIGH_CAPACITY;
;;;617      }
;;;618      else
;;;619      {
;;;620        /*!< CMD55 */
;;;621        SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;622        SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;623        SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;624        SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;625        SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;626        SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;627        errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;628      }
;;;629      /*!< CMD55 */
;;;630      SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;631      SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;632      SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;633      SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;634      SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;635      SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;636      errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;637    
;;;638      /*!< If errorstatus is Command TimeOut, it is a MMC card */
;;;639      /*!< If errorstatus is SD_OK it is a SD card: SD card 2.0 (voltage range mismatch)
;;;640         or SD card 1.x */
;;;641      if (errorstatus == SD_OK)
;;;642      {
;;;643        /*!< SD CARD */
;;;644        /*!< Send ACMD41 SD_APP_OP_COND with Argument 0x80100000 */
;;;645        while ((!validvoltage) && (count < SD_MAX_VOLT_TRIAL))
;;;646        {
;;;647    
;;;648          /*!< SEND CMD55 APP_CMD with RCA as 0 */
;;;649          SDIO_CmdInitStructure.SDIO_Argument = 0x00;
;;;650          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;651          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;652          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;653          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;654          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;655    
;;;656          errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;657    
;;;658          if (errorstatus != SD_OK)
;;;659          {
;;;660            return(errorstatus);
;;;661          }
;;;662          SDIO_CmdInitStructure.SDIO_Argument = SD_VOLTAGE_WINDOW_SD | SDType;
;;;663          SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_OP_COND;
;;;664          SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;665          SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;666          SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;667          SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;668    
;;;669          errorstatus = CmdResp3Error();
;;;670          if (errorstatus != SD_OK)
;;;671          {
;;;672            return(errorstatus);
;;;673          }
;;;674    
;;;675          response = SDIO_GetResponse(SDIO_RESP1);
;;;676          validvoltage = (((response >> 31) == 1) ? 1 : 0);
;;;677          count++;
;;;678        }
;;;679        if (count >= SD_MAX_VOLT_TRIAL)
;;;680        {
;;;681          errorstatus = SD_INVALID_VOLTRANGE;
;;;682          return(errorstatus);
;;;683        }
;;;684    
;;;685        if (response &= SD_HIGH_CAPACITY)
;;;686        {
;;;687          CardType = SDIO_HIGH_CAPACITY_SD_CARD;
;;;688        }
;;;689    
;;;690      }/*!< else MMC Card */
;;;691    
;;;692      return(errorstatus);
;;;693    }
00005a  bdf8              POP      {r3-r7,pc}
                  |L30.92|
00005c  f44f70d5          MOV      r0,#0x1aa             ;604
000060  494c              LDR      r1,|L30.404|
000062  6008              STR      r0,[r1,#0]            ;604  ; SDIO_CmdInitStructure
000064  2008              MOVS     r0,#8                 ;605
000066  6048              STR      r0,[r1,#4]            ;605  ; SDIO_CmdInitStructure
000068  2040              MOVS     r0,#0x40              ;606
00006a  6088              STR      r0,[r1,#8]            ;606  ; SDIO_CmdInitStructure
00006c  2000              MOVS     r0,#0                 ;607
00006e  60c8              STR      r0,[r1,#0xc]          ;607  ; SDIO_CmdInitStructure
000070  f44f6080          MOV      r0,#0x400             ;608
000074  6108              STR      r0,[r1,#0x10]         ;608  ; SDIO_CmdInitStructure
000076  4608              MOV      r0,r1                 ;609
000078  f7fffffe          BL       SDIO_SendCommand
00007c  f7fffffe          BL       CmdResp7Error
000080  9000              STR      r0,[sp,#0]            ;611
000082  f89d0000          LDRB     r0,[sp,#0]            ;613
000086  b920              CBNZ     r0,|L30.146|
000088  2001              MOVS     r0,#1                 ;615
00008a  4943              LDR      r1,|L30.408|
00008c  6008              STR      r0,[r1,#0]            ;615  ; CardType
00008e  0787              LSLS     r7,r0,#30             ;616
000090  e012              B        |L30.184|
                  |L30.146|
000092  2000              MOVS     r0,#0                 ;621
000094  493f              LDR      r1,|L30.404|
000096  6008              STR      r0,[r1,#0]            ;621  ; SDIO_CmdInitStructure
000098  2037              MOVS     r0,#0x37              ;622
00009a  6048              STR      r0,[r1,#4]            ;622  ; SDIO_CmdInitStructure
00009c  2040              MOVS     r0,#0x40              ;623
00009e  6088              STR      r0,[r1,#8]            ;623  ; SDIO_CmdInitStructure
0000a0  2000              MOVS     r0,#0                 ;624
0000a2  60c8              STR      r0,[r1,#0xc]          ;624  ; SDIO_CmdInitStructure
0000a4  f44f6080          MOV      r0,#0x400             ;625
0000a8  6108              STR      r0,[r1,#0x10]         ;625  ; SDIO_CmdInitStructure
0000aa  4608              MOV      r0,r1                 ;626
0000ac  f7fffffe          BL       SDIO_SendCommand
0000b0  2037              MOVS     r0,#0x37              ;627
0000b2  f7fffffe          BL       CmdResp1Error
0000b6  9000              STR      r0,[sp,#0]            ;627
                  |L30.184|
0000b8  2000              MOVS     r0,#0                 ;630
0000ba  4936              LDR      r1,|L30.404|
0000bc  6008              STR      r0,[r1,#0]            ;630  ; SDIO_CmdInitStructure
0000be  2037              MOVS     r0,#0x37              ;631
0000c0  6048              STR      r0,[r1,#4]            ;631  ; SDIO_CmdInitStructure
0000c2  2040              MOVS     r0,#0x40              ;632
0000c4  6088              STR      r0,[r1,#8]            ;632  ; SDIO_CmdInitStructure
0000c6  2000              MOVS     r0,#0                 ;633
0000c8  60c8              STR      r0,[r1,#0xc]          ;633  ; SDIO_CmdInitStructure
0000ca  f44f6080          MOV      r0,#0x400             ;634
0000ce  6108              STR      r0,[r1,#0x10]         ;634  ; SDIO_CmdInitStructure
0000d0  4608              MOV      r0,r1                 ;635
0000d2  f7fffffe          BL       SDIO_SendCommand
0000d6  2037              MOVS     r0,#0x37              ;636
0000d8  f7fffffe          BL       CmdResp1Error
0000dc  9000              STR      r0,[sp,#0]            ;636
0000de  f89d0000          LDRB     r0,[sp,#0]            ;641
0000e2  2800              CMP      r0,#0                 ;641
0000e4  d151              BNE      |L30.394|
0000e6  e03b              B        |L30.352|
                  |L30.232|
0000e8  2000              MOVS     r0,#0                 ;649
0000ea  492a              LDR      r1,|L30.404|
0000ec  6008              STR      r0,[r1,#0]            ;649  ; SDIO_CmdInitStructure
0000ee  2037              MOVS     r0,#0x37              ;650
0000f0  6048              STR      r0,[r1,#4]            ;650  ; SDIO_CmdInitStructure
0000f2  2040              MOVS     r0,#0x40              ;651
0000f4  6088              STR      r0,[r1,#8]            ;651  ; SDIO_CmdInitStructure
0000f6  2000              MOVS     r0,#0                 ;652
0000f8  60c8              STR      r0,[r1,#0xc]          ;652  ; SDIO_CmdInitStructure
0000fa  f44f6080          MOV      r0,#0x400             ;653
0000fe  6108              STR      r0,[r1,#0x10]         ;653  ; SDIO_CmdInitStructure
000100  4608              MOV      r0,r1                 ;654
000102  f7fffffe          BL       SDIO_SendCommand
000106  2037              MOVS     r0,#0x37              ;656
000108  f7fffffe          BL       CmdResp1Error
00010c  9000              STR      r0,[sp,#0]            ;656
00010e  f89d0000          LDRB     r0,[sp,#0]            ;658
000112  b110              CBZ      r0,|L30.282|
000114  f89d0000          LDRB     r0,[sp,#0]            ;660
000118  e79f              B        |L30.90|
                  |L30.282|
00011a  4820              LDR      r0,|L30.412|
00011c  4338              ORRS     r0,r0,r7              ;662
00011e  491d              LDR      r1,|L30.404|
000120  6008              STR      r0,[r1,#0]            ;662  ; SDIO_CmdInitStructure
000122  2029              MOVS     r0,#0x29              ;663
000124  6048              STR      r0,[r1,#4]            ;663  ; SDIO_CmdInitStructure
000126  2040              MOVS     r0,#0x40              ;664
000128  6088              STR      r0,[r1,#8]            ;664  ; SDIO_CmdInitStructure
00012a  2000              MOVS     r0,#0                 ;665
00012c  60c8              STR      r0,[r1,#0xc]          ;665  ; SDIO_CmdInitStructure
00012e  f44f6080          MOV      r0,#0x400             ;666
000132  6108              STR      r0,[r1,#0x10]         ;666  ; SDIO_CmdInitStructure
000134  4608              MOV      r0,r1                 ;667
000136  f7fffffe          BL       SDIO_SendCommand
00013a  f7fffffe          BL       CmdResp3Error
00013e  9000              STR      r0,[sp,#0]            ;669
000140  f89d0000          LDRB     r0,[sp,#0]            ;670
000144  b110              CBZ      r0,|L30.332|
000146  f89d0000          LDRB     r0,[sp,#0]            ;672
00014a  e786              B        |L30.90|
                  |L30.332|
00014c  2000              MOVS     r0,#0                 ;675
00014e  f7fffffe          BL       SDIO_GetResponse
000152  4605              MOV      r5,r0                 ;675
000154  2001              MOVS     r0,#1                 ;676
000156  ea8070d5          EOR      r0,r0,r5,LSR #31      ;676
00015a  f0800601          EOR      r6,r0,#1              ;676
00015e  1c64              ADDS     r4,r4,#1              ;677
                  |L30.352|
000160  b91e              CBNZ     r6,|L30.362|
000162  f64f70ff          MOV      r0,#0xffff            ;645
000166  4284              CMP      r4,r0                 ;645
000168  d3be              BCC      |L30.232|
                  |L30.362|
00016a  f64f70ff          MOV      r0,#0xffff            ;679
00016e  4284              CMP      r4,r0                 ;679
000170  d304              BCC      |L30.380|
000172  201b              MOVS     r0,#0x1b              ;681
000174  9000              STR      r0,[sp,#0]            ;681
000176  f89d0000          LDRB     r0,[sp,#0]            ;682
00017a  e76e              B        |L30.90|
                  |L30.380|
00017c  f0054080          AND      r0,r5,#0x40000000     ;685
000180  1e05              SUBS     r5,r0,#0              ;685
000182  d002              BEQ      |L30.394|
000184  2002              MOVS     r0,#2                 ;687
000186  4904              LDR      r1,|L30.408|
000188  6008              STR      r0,[r1,#0]            ;687  ; CardType
                  |L30.394|
00018a  f89d0000          LDRB     r0,[sp,#0]            ;692
00018e  e764              B        |L30.90|
;;;694    
                          ENDP

                  |L30.400|
                          DCD      SDIO_InitStructure
                  |L30.404|
                          DCD      SDIO_CmdInitStructure
                  |L30.408|
                          DCD      CardType
                  |L30.412|
                          DCD      0x80100000

                          AREA ||i.SD_ProcessDMAIRQ||, CODE, READONLY, ALIGN=2

                  SD_ProcessDMAIRQ PROC
;;;2069     */
;;;2070   void SD_ProcessDMAIRQ(void)
000000  b510              PUSH     {r4,lr}
;;;2071   {
;;;2072     if(DMA2->ISR & DMA2_FLAG_TC4)
000002  4806              LDR      r0,|L31.28|
000004  6800              LDR      r0,[r0,#0]
000006  4906              LDR      r1,|L31.32|
000008  4008              ANDS     r0,r0,r1
00000a  b128              CBZ      r0,|L31.24|
;;;2073     {
;;;2074       DMAEndOfTransfer = 0x01;
00000c  2001              MOVS     r0,#1
00000e  4905              LDR      r1,|L31.36|
000010  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;2075       DMA_ClearFlag(DMA2_FLAG_TC4 | DMA2_FLAG_TE4 | DMA2_FLAG_HT4 | DMA2_FLAG_GL4);
000012  4805              LDR      r0,|L31.40|
000014  f7fffffe          BL       DMA_ClearFlag
                  |L31.24|
;;;2076   //    DMA_ClearFlag(SD_SDIO_DMA_STREAM, SD_SDIO_DMA_FLAG_TCIF|SD_SDIO_DMA_FLAG_FEIF);
;;;2077     }
;;;2078   }
000018  bd10              POP      {r4,pc}
;;;2079   
                          ENDP

00001a  0000              DCW      0x0000
                  |L31.28|
                          DCD      0x40020400
                  |L31.32|
                          DCD      0x10002000
                  |L31.36|
                          DCD      DMAEndOfTransfer
                  |L31.40|
                          DCD      0x1000f000

                          AREA ||i.SD_ProcessIRQSrc||, CODE, READONLY, ALIGN=2

                  SD_ProcessIRQSrc PROC
;;;2024     */
;;;2025   SD_Error SD_ProcessIRQSrc(void)
000000  b510              PUSH     {r4,lr}
;;;2026   { 
;;;2027     if (SDIO_GetITStatus(SDIO_IT_DATAEND) != RESET)
000002  f44f7080          MOV      r0,#0x100
000006  f7fffffe          BL       SDIO_GetITStatus
00000a  b150              CBZ      r0,|L32.34|
;;;2028     {
;;;2029       TransferError = SD_OK;
00000c  2000              MOVS     r0,#0
00000e  4925              LDR      r1,|L32.164|
000010  7008              STRB     r0,[r1,#0]
;;;2030       SDIO_ClearITPendingBit(SDIO_IT_DATAEND);
000012  f44f7080          MOV      r0,#0x100
000016  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2031       TransferEnd = 1;
00001a  2001              MOVS     r0,#1
00001c  4922              LDR      r1,|L32.168|
00001e  6008              STR      r0,[r1,#0]  ; TransferEnd
000020  e037              B        |L32.146|
                  |L32.34|
;;;2032     }  
;;;2033     else if (SDIO_GetITStatus(SDIO_IT_DCRCFAIL) != RESET)
000022  2002              MOVS     r0,#2
000024  f7fffffe          BL       SDIO_GetITStatus
000028  b130              CBZ      r0,|L32.56|
;;;2034     {
;;;2035       SDIO_ClearITPendingBit(SDIO_IT_DCRCFAIL);
00002a  2002              MOVS     r0,#2
00002c  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2036       TransferError = SD_DATA_CRC_FAIL;
000030  2002              MOVS     r0,#2
000032  491c              LDR      r1,|L32.164|
000034  7008              STRB     r0,[r1,#0]
000036  e02c              B        |L32.146|
                  |L32.56|
;;;2037     }
;;;2038     else if (SDIO_GetITStatus(SDIO_IT_DTIMEOUT) != RESET)
000038  2008              MOVS     r0,#8
00003a  f7fffffe          BL       SDIO_GetITStatus
00003e  b130              CBZ      r0,|L32.78|
;;;2039     {
;;;2040       SDIO_ClearITPendingBit(SDIO_IT_DTIMEOUT);
000040  2008              MOVS     r0,#8
000042  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2041       TransferError = SD_DATA_TIMEOUT;
000046  2004              MOVS     r0,#4
000048  4916              LDR      r1,|L32.164|
00004a  7008              STRB     r0,[r1,#0]
00004c  e021              B        |L32.146|
                  |L32.78|
;;;2042     }
;;;2043     else if (SDIO_GetITStatus(SDIO_IT_RXOVERR) != RESET)
00004e  2020              MOVS     r0,#0x20
000050  f7fffffe          BL       SDIO_GetITStatus
000054  b130              CBZ      r0,|L32.100|
;;;2044     {
;;;2045       SDIO_ClearITPendingBit(SDIO_IT_RXOVERR);
000056  2020              MOVS     r0,#0x20
000058  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2046       TransferError = SD_RX_OVERRUN;
00005c  2006              MOVS     r0,#6
00005e  4911              LDR      r1,|L32.164|
000060  7008              STRB     r0,[r1,#0]
000062  e016              B        |L32.146|
                  |L32.100|
;;;2047     }
;;;2048     else if (SDIO_GetITStatus(SDIO_IT_TXUNDERR) != RESET)
000064  2010              MOVS     r0,#0x10
000066  f7fffffe          BL       SDIO_GetITStatus
00006a  b130              CBZ      r0,|L32.122|
;;;2049     {
;;;2050       SDIO_ClearITPendingBit(SDIO_IT_TXUNDERR);
00006c  2010              MOVS     r0,#0x10
00006e  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2051       TransferError = SD_TX_UNDERRUN;
000072  2005              MOVS     r0,#5
000074  490b              LDR      r1,|L32.164|
000076  7008              STRB     r0,[r1,#0]
000078  e00b              B        |L32.146|
                  |L32.122|
;;;2052     }
;;;2053     else if (SDIO_GetITStatus(SDIO_IT_STBITERR) != RESET)
00007a  f44f7000          MOV      r0,#0x200
00007e  f7fffffe          BL       SDIO_GetITStatus
000082  b130              CBZ      r0,|L32.146|
;;;2054     {
;;;2055       SDIO_ClearITPendingBit(SDIO_IT_STBITERR);
000084  f44f7000          MOV      r0,#0x200
000088  f7fffffe          BL       SDIO_ClearITPendingBit
;;;2056       TransferError = SD_START_BIT_ERR;
00008c  2007              MOVS     r0,#7
00008e  4905              LDR      r1,|L32.164|
000090  7008              STRB     r0,[r1,#0]
                  |L32.146|
;;;2057     }
;;;2058   
;;;2059     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND |
000092  2100              MOVS     r1,#0
000094  f24c303a          MOV      r0,#0xc33a
000098  f7fffffe          BL       SDIO_ITConfig
;;;2060                   SDIO_IT_TXFIFOHE | SDIO_IT_RXFIFOHF | SDIO_IT_TXUNDERR |
;;;2061                   SDIO_IT_RXOVERR | SDIO_IT_STBITERR, DISABLE);
;;;2062     return(TransferError);
00009c  4801              LDR      r0,|L32.164|
00009e  7800              LDRB     r0,[r0,#0]  ; TransferError
;;;2063   }
0000a0  bd10              POP      {r4,pc}
;;;2064   
                          ENDP

0000a2  0000              DCW      0x0000
                  |L32.164|
                          DCD      TransferError
                  |L32.168|
                          DCD      TransferEnd

                          AREA ||i.SD_ReadBlock||, CODE, READONLY, ALIGN=2

                  SD_ReadBlock PROC
;;;1191     */
;;;1192   SD_Error SD_ReadBlock(uint8_t *readbuff, uint64_t ReadAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1193   {
000004  4680              MOV      r8,r0
000006  4614              MOV      r4,r2
000008  461d              MOV      r5,r3
00000a  9e06              LDR      r6,[sp,#0x18]
;;;1194     SD_Error errorstatus = SD_OK;
00000c  2700              MOVS     r7,#0
;;;1195   #if defined (SD_POLLING_MODE) 
;;;1196     uint32_t count = 0, *tempbuff = (uint32_t *)readbuff;
;;;1197   #endif
;;;1198   
;;;1199     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  492f              LDR      r1,|L33.208|
000012  7008              STRB     r0,[r1,#0]
;;;1200     TransferEnd = 0;
000014  492f              LDR      r1,|L33.212|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1201     StopCondition = 0;
000018  492f              LDR      r1,|L33.216|
00001a  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1202     
;;;1203     SDIO->DCTRL = 0x0;
00001c  492f              LDR      r1,|L33.220|
00001e  62c8              STR      r0,[r1,#0x2c]
;;;1204   
;;;1205     
;;;1206     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000020  482f              LDR      r0,|L33.224|
000022  6800              LDR      r0,[r0,#0]  ; CardType
000024  2802              CMP      r0,#2
000026  d108              BNE      |L33.58|
;;;1207     {
;;;1208       BlockSize = 512;
000028  0206              LSLS     r6,r0,#8
;;;1209       ReadAddr /= 512;
00002a  0202              LSLS     r2,r0,#8
00002c  2300              MOVS     r3,#0
00002e  4620              MOV      r0,r4
000030  4629              MOV      r1,r5
000032  f7fffffe          BL       __aeabi_uldivmod
000036  4604              MOV      r4,r0
000038  460d              MOV      r5,r1
                  |L33.58|
;;;1210     }
;;;1211   
;;;1212     /* Set Block Size for Card */ 
;;;1213     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00003a  482a              LDR      r0,|L33.228|
00003c  6006              STR      r6,[r0,#0]  ; SDIO_CmdInitStructure
;;;1214     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00003e  2010              MOVS     r0,#0x10
000040  4928              LDR      r1,|L33.228|
000042  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1215     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000044  2040              MOVS     r0,#0x40
000046  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1216     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000048  2000              MOVS     r0,#0
00004a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1217     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00004c  f44f6080          MOV      r0,#0x400
000050  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1218     SDIO_SendCommand(&SDIO_CmdInitStructure);
000052  4608              MOV      r0,r1
000054  f7fffffe          BL       SDIO_SendCommand
;;;1219   
;;;1220     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000058  2010              MOVS     r0,#0x10
00005a  f7fffffe          BL       CmdResp1Error
00005e  4607              MOV      r7,r0
;;;1221   
;;;1222     if (SD_OK != errorstatus)
000060  b117              CBZ      r7,|L33.104|
;;;1223     {
;;;1224       return(errorstatus);
000062  4638              MOV      r0,r7
                  |L33.100|
;;;1225     }
;;;1226     
;;;1227     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1228     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1229     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1230     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1231     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1232     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1233     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1234   
;;;1235     /*!< Send CMD17 READ_SINGLE_BLOCK */
;;;1236     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1237     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_SINGLE_BLOCK;
;;;1238     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1239     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1240     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1241     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1242   
;;;1243     errorstatus = CmdResp1Error(SD_CMD_READ_SINGLE_BLOCK);
;;;1244   
;;;1245     if (errorstatus != SD_OK)
;;;1246     {
;;;1247       return(errorstatus);
;;;1248     }
;;;1249   
;;;1250   #if defined (SD_POLLING_MODE)  
;;;1251     /*!< In case of single block transfer, no need of stop transfer at all.*/
;;;1252     /*!< Polling mode */
;;;1253     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1254     {
;;;1255       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1256       {
;;;1257         for (count = 0; count < 8; count++)
;;;1258         {
;;;1259           *(tempbuff + count) = SDIO_ReadData();
;;;1260         }
;;;1261         tempbuff += 8;
;;;1262       }
;;;1263     }
;;;1264   
;;;1265     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1266     {
;;;1267       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1268       errorstatus = SD_DATA_TIMEOUT;
;;;1269       return(errorstatus);
;;;1270     }
;;;1271     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1272     {
;;;1273       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1274       errorstatus = SD_DATA_CRC_FAIL;
;;;1275       return(errorstatus);
;;;1276     }
;;;1277     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1278     {
;;;1279       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1280       errorstatus = SD_RX_OVERRUN;
;;;1281       return(errorstatus);
;;;1282     }
;;;1283     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1284     {
;;;1285       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1286       errorstatus = SD_START_BIT_ERR;
;;;1287       return(errorstatus);
;;;1288     }
;;;1289     count = SD_DATATIMEOUT;
;;;1290     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;1291     {
;;;1292       *tempbuff = SDIO_ReadData();
;;;1293       tempbuff++;
;;;1294       count--;
;;;1295     }
;;;1296     
;;;1297     /*!< Clear all the static flags */
;;;1298     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;1299   
;;;1300   #elif defined (SD_DMA_MODE)
;;;1301       SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1302       SDIO_DMACmd(ENABLE);
;;;1303       SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, BlockSize);
;;;1304   #endif
;;;1305   
;;;1306     return(errorstatus);
;;;1307   }
000064  e8bd81f0          POP      {r4-r8,pc}
                  |L33.104|
000068  481f              LDR      r0,|L33.232|
00006a  4920              LDR      r1,|L33.236|
00006c  6008              STR      r0,[r1,#0]            ;1227  ; SDIO_DataInitStructure
00006e  4608              MOV      r0,r1                 ;1228
000070  6046              STR      r6,[r0,#4]            ;1228  ; SDIO_DataInitStructure
000072  2090              MOVS     r0,#0x90              ;1229
000074  6088              STR      r0,[r1,#8]            ;1229  ; SDIO_DataInitStructure
000076  2002              MOVS     r0,#2                 ;1230
000078  60c8              STR      r0,[r1,#0xc]          ;1230  ; SDIO_DataInitStructure
00007a  2000              MOVS     r0,#0                 ;1231
00007c  6108              STR      r0,[r1,#0x10]         ;1231  ; SDIO_DataInitStructure
00007e  2001              MOVS     r0,#1                 ;1232
000080  6148              STR      r0,[r1,#0x14]         ;1232  ; SDIO_DataInitStructure
000082  4608              MOV      r0,r1                 ;1233
000084  f7fffffe          BL       SDIO_DataConfig
000088  4816              LDR      r0,|L33.228|
00008a  6004              STR      r4,[r0,#0]            ;1236  ; SDIO_CmdInitStructure
00008c  2011              MOVS     r0,#0x11              ;1237
00008e  4915              LDR      r1,|L33.228|
000090  6048              STR      r0,[r1,#4]            ;1237  ; SDIO_CmdInitStructure
000092  2040              MOVS     r0,#0x40              ;1238
000094  6088              STR      r0,[r1,#8]            ;1238  ; SDIO_CmdInitStructure
000096  2000              MOVS     r0,#0                 ;1239
000098  60c8              STR      r0,[r1,#0xc]          ;1239  ; SDIO_CmdInitStructure
00009a  f44f6080          MOV      r0,#0x400             ;1240
00009e  6108              STR      r0,[r1,#0x10]         ;1240  ; SDIO_CmdInitStructure
0000a0  4608              MOV      r0,r1                 ;1241
0000a2  f7fffffe          BL       SDIO_SendCommand
0000a6  2011              MOVS     r0,#0x11              ;1243
0000a8  f7fffffe          BL       CmdResp1Error
0000ac  4607              MOV      r7,r0                 ;1243
0000ae  b10f              CBZ      r7,|L33.180|
0000b0  4638              MOV      r0,r7                 ;1247
0000b2  e7d7              B        |L33.100|
                  |L33.180|
0000b4  2101              MOVS     r1,#1                 ;1301
0000b6  f240302a          MOV      r0,#0x32a             ;1301
0000ba  f7fffffe          BL       SDIO_ITConfig
0000be  2001              MOVS     r0,#1                 ;1302
0000c0  f7fffffe          BL       SDIO_DMACmd
0000c4  4631              MOV      r1,r6                 ;1303
0000c6  4640              MOV      r0,r8                 ;1303
0000c8  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000cc  4638              MOV      r0,r7                 ;1306
0000ce  e7c9              B        |L33.100|
;;;1308   
                          ENDP

                  |L33.208|
                          DCD      TransferError
                  |L33.212|
                          DCD      TransferEnd
                  |L33.216|
                          DCD      StopCondition
                  |L33.220|
                          DCD      0x40018000
                  |L33.224|
                          DCD      CardType
                  |L33.228|
                          DCD      SDIO_CmdInitStructure
                  |L33.232|
                          DCD      0x000fffff
                  |L33.236|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_ReadMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_ReadMultiBlocks PROC
;;;1323     */
;;;1324   SD_Error SD_ReadMultiBlocks(uint8_t *readbuff, uint64_t ReadAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1325   {
000004  4681              MOV      r9,r0
000006  4614              MOV      r4,r2
000008  461d              MOV      r5,r3
00000a  e9dd6808          LDRD     r6,r8,[sp,#0x20]
;;;1326     SD_Error errorstatus = SD_OK;
00000e  2700              MOVS     r7,#0
;;;1327     TransferError = SD_OK;
000010  2000              MOVS     r0,#0
000012  4932              LDR      r1,|L34.220|
000014  7008              STRB     r0,[r1,#0]
;;;1328     TransferEnd = 0;
000016  4932              LDR      r1,|L34.224|
000018  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1329     StopCondition = 1;
00001a  2001              MOVS     r0,#1
00001c  4931              LDR      r1,|L34.228|
00001e  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1330   	
;;;1331     SDIO->DCTRL = 0x0;
000020  2000              MOVS     r0,#0
000022  4931              LDR      r1,|L34.232|
000024  62c8              STR      r0,[r1,#0x2c]
;;;1332   
;;;1333     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000026  4831              LDR      r0,|L34.236|
000028  6800              LDR      r0,[r0,#0]  ; CardType
00002a  2802              CMP      r0,#2
00002c  d108              BNE      |L34.64|
;;;1334     {
;;;1335       BlockSize = 512;
00002e  0206              LSLS     r6,r0,#8
;;;1336       ReadAddr /= 512;
000030  0202              LSLS     r2,r0,#8
000032  2300              MOVS     r3,#0
000034  4620              MOV      r0,r4
000036  4629              MOV      r1,r5
000038  f7fffffe          BL       __aeabi_uldivmod
00003c  4604              MOV      r4,r0
00003e  460d              MOV      r5,r1
                  |L34.64|
;;;1337     }
;;;1338   
;;;1339     /*!< Set Block Size for Card */
;;;1340     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000040  482b              LDR      r0,|L34.240|
000042  6006              STR      r6,[r0,#0]  ; SDIO_CmdInitStructure
;;;1341     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000044  2010              MOVS     r0,#0x10
000046  492a              LDR      r1,|L34.240|
000048  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1342     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00004a  2040              MOVS     r0,#0x40
00004c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1343     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00004e  2000              MOVS     r0,#0
000050  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1344     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000052  f44f6080          MOV      r0,#0x400
000056  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1345     SDIO_SendCommand(&SDIO_CmdInitStructure);
000058  4608              MOV      r0,r1
00005a  f7fffffe          BL       SDIO_SendCommand
;;;1346   
;;;1347     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00005e  2010              MOVS     r0,#0x10
000060  f7fffffe          BL       CmdResp1Error
000064  4607              MOV      r7,r0
;;;1348   
;;;1349     if (SD_OK != errorstatus)
000066  b117              CBZ      r7,|L34.110|
;;;1350     {
;;;1351       return(errorstatus);
000068  4638              MOV      r0,r7
                  |L34.106|
;;;1352     }
;;;1353       
;;;1354     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1355     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1356     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1357     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1358     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1359     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1360     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1361   
;;;1362     /*!< Send CMD18 READ_MULT_BLOCK with argument data address */
;;;1363     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)ReadAddr;
;;;1364     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_READ_MULT_BLOCK;
;;;1365     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1366     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1367     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1368     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1369   
;;;1370     errorstatus = CmdResp1Error(SD_CMD_READ_MULT_BLOCK);
;;;1371   
;;;1372     if (errorstatus != SD_OK)
;;;1373     {
;;;1374       return(errorstatus);
;;;1375     }
;;;1376   
;;;1377     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);  
;;;1378     SD_LowLevel_DMA_RxConfig((uint32_t *)readbuff, (NumberOfBlocks * BlockSize));
;;;1379     SDIO_DMACmd(ENABLE);
;;;1380     
;;;1381     return(errorstatus);
;;;1382   }
00006a  e8bd87f0          POP      {r4-r10,pc}
                  |L34.110|
00006e  4821              LDR      r0,|L34.244|
000070  4921              LDR      r1,|L34.248|
000072  6008              STR      r0,[r1,#0]            ;1354  ; SDIO_DataInitStructure
000074  fb08f006          MUL      r0,r8,r6              ;1355
000078  6048              STR      r0,[r1,#4]            ;1355  ; SDIO_DataInitStructure
00007a  2090              MOVS     r0,#0x90              ;1356
00007c  6088              STR      r0,[r1,#8]            ;1356  ; SDIO_DataInitStructure
00007e  2002              MOVS     r0,#2                 ;1357
000080  60c8              STR      r0,[r1,#0xc]          ;1357  ; SDIO_DataInitStructure
000082  2000              MOVS     r0,#0                 ;1358
000084  6108              STR      r0,[r1,#0x10]         ;1358  ; SDIO_DataInitStructure
000086  2001              MOVS     r0,#1                 ;1359
000088  6148              STR      r0,[r1,#0x14]         ;1359  ; SDIO_DataInitStructure
00008a  4608              MOV      r0,r1                 ;1360
00008c  f7fffffe          BL       SDIO_DataConfig
000090  4817              LDR      r0,|L34.240|
000092  6004              STR      r4,[r0,#0]            ;1363  ; SDIO_CmdInitStructure
000094  2012              MOVS     r0,#0x12              ;1364
000096  4916              LDR      r1,|L34.240|
000098  6048              STR      r0,[r1,#4]            ;1364  ; SDIO_CmdInitStructure
00009a  2040              MOVS     r0,#0x40              ;1365
00009c  6088              STR      r0,[r1,#8]            ;1365  ; SDIO_CmdInitStructure
00009e  2000              MOVS     r0,#0                 ;1366
0000a0  60c8              STR      r0,[r1,#0xc]          ;1366  ; SDIO_CmdInitStructure
0000a2  f44f6080          MOV      r0,#0x400             ;1367
0000a6  6108              STR      r0,[r1,#0x10]         ;1367  ; SDIO_CmdInitStructure
0000a8  4608              MOV      r0,r1                 ;1368
0000aa  f7fffffe          BL       SDIO_SendCommand
0000ae  2012              MOVS     r0,#0x12              ;1370
0000b0  f7fffffe          BL       CmdResp1Error
0000b4  4607              MOV      r7,r0                 ;1370
0000b6  b10f              CBZ      r7,|L34.188|
0000b8  4638              MOV      r0,r7                 ;1374
0000ba  e7d6              B        |L34.106|
                  |L34.188|
0000bc  2101              MOVS     r1,#1                 ;1377
0000be  f240302a          MOV      r0,#0x32a             ;1377
0000c2  f7fffffe          BL       SDIO_ITConfig
0000c6  fb08f106          MUL      r1,r8,r6              ;1378
0000ca  4648              MOV      r0,r9                 ;1378
0000cc  f7fffffe          BL       SD_LowLevel_DMA_RxConfig
0000d0  2001              MOVS     r0,#1                 ;1379
0000d2  f7fffffe          BL       SDIO_DMACmd
0000d6  4638              MOV      r0,r7                 ;1381
0000d8  e7c7              B        |L34.106|
;;;1383   
                          ENDP

0000da  0000              DCW      0x0000
                  |L34.220|
                          DCD      TransferError
                  |L34.224|
                          DCD      TransferEnd
                  |L34.228|
                          DCD      StopCondition
                  |L34.232|
                          DCD      0x40018000
                  |L34.236|
                          DCD      CardType
                  |L34.240|
                          DCD      SDIO_CmdInitStructure
                  |L34.244|
                          DCD      0x000fffff
                  |L34.248|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_SelectDeselect||, CODE, READONLY, ALIGN=2

                  SD_SelectDeselect PROC
;;;1160     */
;;;1161   SD_Error SD_SelectDeselect(uint64_t addr)
000000  b570              PUSH     {r4-r6,lr}
;;;1162   {
000002  4604              MOV      r4,r0
000004  460d              MOV      r5,r1
;;;1163     SD_Error errorstatus = SD_OK;
000006  2600              MOVS     r6,#0
;;;1164   
;;;1165     /*!< Send CMD7 SDIO_SEL_DESEL_CARD */
;;;1166     SDIO_CmdInitStructure.SDIO_Argument =  (uint32_t)addr;
000008  480a              LDR      r0,|L35.52|
00000a  6004              STR      r4,[r0,#0]  ; SDIO_CmdInitStructure
;;;1167     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEL_DESEL_CARD;
00000c  2007              MOVS     r0,#7
00000e  4909              LDR      r1,|L35.52|
000010  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1168     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000012  2040              MOVS     r0,#0x40
000014  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1169     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000016  2000              MOVS     r0,#0
000018  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1170     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00001a  f44f6080          MOV      r0,#0x400
00001e  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1171     SDIO_SendCommand(&SDIO_CmdInitStructure);
000020  4608              MOV      r0,r1
000022  f7fffffe          BL       SDIO_SendCommand
;;;1172   
;;;1173     errorstatus = CmdResp1Error(SD_CMD_SEL_DESEL_CARD);
000026  2007              MOVS     r0,#7
000028  f7fffffe          BL       CmdResp1Error
00002c  4606              MOV      r6,r0
;;;1174   
;;;1175     return(errorstatus);
00002e  4630              MOV      r0,r6
;;;1176   }
000030  bd70              POP      {r4-r6,pc}
;;;1177   
                          ENDP

000032  0000              DCW      0x0000
                  |L35.52|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_SendSDStatus||, CODE, READONLY, ALIGN=2

                  SD_SendSDStatus PROC
;;;1907     */
;;;1908   SD_Error SD_SendSDStatus(uint32_t *psdstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1909   {
000002  4604              MOV      r4,r0
;;;1910     SD_Error errorstatus = SD_OK;
000004  2600              MOVS     r6,#0
;;;1911     uint32_t count = 0;
000006  2500              MOVS     r5,#0
;;;1912   
;;;1913     if (SDIO_GetResponse(SDIO_RESP1) & SD_CARD_LOCKED)
000008  2000              MOVS     r0,#0
00000a  f7fffffe          BL       SDIO_GetResponse
00000e  f0007000          AND      r0,r0,#0x2000000
000012  b110              CBZ      r0,|L36.26|
;;;1914     {
;;;1915       errorstatus = SD_LOCK_UNLOCK_FAILED;
000014  260e              MOVS     r6,#0xe
;;;1916       return(errorstatus);
000016  4630              MOV      r0,r6
                  |L36.24|
;;;1917     }
;;;1918   
;;;1919     /*!< Set block size for card if it is not equal to current block size for card. */
;;;1920     SDIO_CmdInitStructure.SDIO_Argument = 64;
;;;1921     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
;;;1922     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1923     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1924     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1925     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1926   
;;;1927     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
;;;1928   
;;;1929     if (errorstatus != SD_OK)
;;;1930     {
;;;1931       return(errorstatus);
;;;1932     }
;;;1933   
;;;1934     /*!< CMD55 */
;;;1935     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1936     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1937     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1938     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1939     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1940     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1941     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1942   
;;;1943     if (errorstatus != SD_OK)
;;;1944     {
;;;1945       return(errorstatus);
;;;1946     }
;;;1947   
;;;1948     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1949     SDIO_DataInitStructure.SDIO_DataLength = 64;
;;;1950     SDIO_DataInitStructure.SDIO_DataBlockSize = SDIO_DataBlockSize_64b;
;;;1951     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToSDIO;
;;;1952     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1953     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1954     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1955   
;;;1956     /*!< Send ACMD13 SD_APP_STAUS  with argument as card's RCA.*/
;;;1957     SDIO_CmdInitStructure.SDIO_Argument = 0;
;;;1958     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SD_APP_STAUS;
;;;1959     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1960     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1961     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1962     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1963     errorstatus = CmdResp1Error(SD_CMD_SD_APP_STAUS);
;;;1964   
;;;1965     if (errorstatus != SD_OK)
;;;1966     {
;;;1967       return(errorstatus);
;;;1968     }
;;;1969   
;;;1970     while (!(SDIO->STA &(SDIO_FLAG_RXOVERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_DBCKEND | SDIO_FLAG_STBITERR)))
;;;1971     {
;;;1972       if (SDIO_GetFlagStatus(SDIO_FLAG_RXFIFOHF) != RESET)
;;;1973       {
;;;1974         for (count = 0; count < 8; count++)
;;;1975         {
;;;1976           *(psdstatus + count) = SDIO_ReadData();
;;;1977         }
;;;1978         psdstatus += 8;
;;;1979       }
;;;1980     }
;;;1981   
;;;1982     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1983     {
;;;1984       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1985       errorstatus = SD_DATA_TIMEOUT;
;;;1986       return(errorstatus);
;;;1987     }
;;;1988     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1989     {
;;;1990       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1991       errorstatus = SD_DATA_CRC_FAIL;
;;;1992       return(errorstatus);
;;;1993     }
;;;1994     else if (SDIO_GetFlagStatus(SDIO_FLAG_RXOVERR) != RESET)
;;;1995     {
;;;1996       SDIO_ClearFlag(SDIO_FLAG_RXOVERR);
;;;1997       errorstatus = SD_RX_OVERRUN;
;;;1998       return(errorstatus);
;;;1999     }
;;;2000     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;2001     {
;;;2002       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;2003       errorstatus = SD_START_BIT_ERR;
;;;2004       return(errorstatus);
;;;2005     }
;;;2006   
;;;2007     count = SD_DATATIMEOUT;
;;;2008     while ((SDIO_GetFlagStatus(SDIO_FLAG_RXDAVL) != RESET) && (count > 0))
;;;2009     {
;;;2010       *psdstatus = SDIO_ReadData();
;;;2011       psdstatus++;
;;;2012       count--;
;;;2013     }
;;;2014     /*!< Clear all the static status flags*/
;;;2015     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
;;;2016   
;;;2017     return(errorstatus);
;;;2018   }
000018  bd70              POP      {r4-r6,pc}
                  |L36.26|
00001a  2040              MOVS     r0,#0x40              ;1920
00001c  4953              LDR      r1,|L36.364|
00001e  6008              STR      r0,[r1,#0]            ;1920  ; SDIO_CmdInitStructure
000020  2010              MOVS     r0,#0x10              ;1921
000022  6048              STR      r0,[r1,#4]            ;1921  ; SDIO_CmdInitStructure
000024  2040              MOVS     r0,#0x40              ;1922
000026  6088              STR      r0,[r1,#8]            ;1922  ; SDIO_CmdInitStructure
000028  2000              MOVS     r0,#0                 ;1923
00002a  60c8              STR      r0,[r1,#0xc]          ;1923  ; SDIO_CmdInitStructure
00002c  f44f6080          MOV      r0,#0x400             ;1924
000030  6108              STR      r0,[r1,#0x10]         ;1924  ; SDIO_CmdInitStructure
000032  4608              MOV      r0,r1                 ;1925
000034  f7fffffe          BL       SDIO_SendCommand
000038  2010              MOVS     r0,#0x10              ;1927
00003a  f7fffffe          BL       CmdResp1Error
00003e  4606              MOV      r6,r0                 ;1927
000040  b10e              CBZ      r6,|L36.70|
000042  4630              MOV      r0,r6                 ;1931
000044  e7e8              B        |L36.24|
                  |L36.70|
000046  484a              LDR      r0,|L36.368|
000048  8800              LDRH     r0,[r0,#0]            ;1935  ; RCA
00004a  0400              LSLS     r0,r0,#16             ;1935
00004c  4947              LDR      r1,|L36.364|
00004e  6008              STR      r0,[r1,#0]            ;1935  ; SDIO_CmdInitStructure
000050  2037              MOVS     r0,#0x37              ;1936
000052  6048              STR      r0,[r1,#4]            ;1936  ; SDIO_CmdInitStructure
000054  2040              MOVS     r0,#0x40              ;1937
000056  6088              STR      r0,[r1,#8]            ;1937  ; SDIO_CmdInitStructure
000058  2000              MOVS     r0,#0                 ;1938
00005a  60c8              STR      r0,[r1,#0xc]          ;1938  ; SDIO_CmdInitStructure
00005c  f44f6080          MOV      r0,#0x400             ;1939
000060  6108              STR      r0,[r1,#0x10]         ;1939  ; SDIO_CmdInitStructure
000062  4608              MOV      r0,r1                 ;1940
000064  f7fffffe          BL       SDIO_SendCommand
000068  2037              MOVS     r0,#0x37              ;1941
00006a  f7fffffe          BL       CmdResp1Error
00006e  4606              MOV      r6,r0                 ;1941
000070  b10e              CBZ      r6,|L36.118|
000072  4630              MOV      r0,r6                 ;1945
000074  e7d0              B        |L36.24|
                  |L36.118|
000076  483f              LDR      r0,|L36.372|
000078  493f              LDR      r1,|L36.376|
00007a  6008              STR      r0,[r1,#0]            ;1948  ; SDIO_DataInitStructure
00007c  2040              MOVS     r0,#0x40              ;1949
00007e  6048              STR      r0,[r1,#4]            ;1949  ; SDIO_DataInitStructure
000080  2060              MOVS     r0,#0x60              ;1950
000082  6088              STR      r0,[r1,#8]            ;1950  ; SDIO_DataInitStructure
000084  2002              MOVS     r0,#2                 ;1951
000086  60c8              STR      r0,[r1,#0xc]          ;1951  ; SDIO_DataInitStructure
000088  2000              MOVS     r0,#0                 ;1952
00008a  6108              STR      r0,[r1,#0x10]         ;1952  ; SDIO_DataInitStructure
00008c  2001              MOVS     r0,#1                 ;1953
00008e  6148              STR      r0,[r1,#0x14]         ;1953  ; SDIO_DataInitStructure
000090  4608              MOV      r0,r1                 ;1954
000092  f7fffffe          BL       SDIO_DataConfig
000096  2000              MOVS     r0,#0                 ;1957
000098  4934              LDR      r1,|L36.364|
00009a  6008              STR      r0,[r1,#0]            ;1957  ; SDIO_CmdInitStructure
00009c  200d              MOVS     r0,#0xd               ;1958
00009e  6048              STR      r0,[r1,#4]            ;1958  ; SDIO_CmdInitStructure
0000a0  2040              MOVS     r0,#0x40              ;1959
0000a2  6088              STR      r0,[r1,#8]            ;1959  ; SDIO_CmdInitStructure
0000a4  2000              MOVS     r0,#0                 ;1960
0000a6  60c8              STR      r0,[r1,#0xc]          ;1960  ; SDIO_CmdInitStructure
0000a8  f44f6080          MOV      r0,#0x400             ;1961
0000ac  6108              STR      r0,[r1,#0x10]         ;1961  ; SDIO_CmdInitStructure
0000ae  4608              MOV      r0,r1                 ;1962
0000b0  f7fffffe          BL       SDIO_SendCommand
0000b4  200d              MOVS     r0,#0xd               ;1963
0000b6  f7fffffe          BL       CmdResp1Error
0000ba  4606              MOV      r6,r0                 ;1963
0000bc  b10e              CBZ      r6,|L36.194|
0000be  4630              MOV      r0,r6                 ;1967
0000c0  e7aa              B        |L36.24|
                  |L36.194|
0000c2  e00e              B        |L36.226|
                  |L36.196|
0000c4  f44f4000          MOV      r0,#0x8000            ;1972
0000c8  f7fffffe          BL       SDIO_GetFlagStatus
0000cc  b148              CBZ      r0,|L36.226|
0000ce  2500              MOVS     r5,#0                 ;1974
0000d0  e004              B        |L36.220|
                  |L36.210|
0000d2  f7fffffe          BL       SDIO_ReadData
0000d6  f8440025          STR      r0,[r4,r5,LSL #2]     ;1976
0000da  1c6d              ADDS     r5,r5,#1              ;1974
                  |L36.220|
0000dc  2d08              CMP      r5,#8                 ;1974
0000de  d3f8              BCC      |L36.210|
0000e0  3420              ADDS     r4,r4,#0x20           ;1978
                  |L36.226|
0000e2  4826              LDR      r0,|L36.380|
0000e4  6b40              LDR      r0,[r0,#0x34]         ;1970
0000e6  f240612a          MOV      r1,#0x62a             ;1970
0000ea  4008              ANDS     r0,r0,r1              ;1970
0000ec  2800              CMP      r0,#0                 ;1970
0000ee  d0e9              BEQ      |L36.196|
0000f0  2008              MOVS     r0,#8                 ;1982
0000f2  f7fffffe          BL       SDIO_GetFlagStatus
0000f6  b128              CBZ      r0,|L36.260|
0000f8  2008              MOVS     r0,#8                 ;1984
0000fa  f7fffffe          BL       SDIO_ClearFlag
0000fe  2604              MOVS     r6,#4                 ;1985
000100  4630              MOV      r0,r6                 ;1986
000102  e789              B        |L36.24|
                  |L36.260|
000104  2002              MOVS     r0,#2                 ;1988
000106  f7fffffe          BL       SDIO_GetFlagStatus
00010a  b128              CBZ      r0,|L36.280|
00010c  2002              MOVS     r0,#2                 ;1990
00010e  f7fffffe          BL       SDIO_ClearFlag
000112  2602              MOVS     r6,#2                 ;1991
000114  4630              MOV      r0,r6                 ;1992
000116  e77f              B        |L36.24|
                  |L36.280|
000118  2020              MOVS     r0,#0x20              ;1994
00011a  f7fffffe          BL       SDIO_GetFlagStatus
00011e  b128              CBZ      r0,|L36.300|
000120  2020              MOVS     r0,#0x20              ;1996
000122  f7fffffe          BL       SDIO_ClearFlag
000126  2606              MOVS     r6,#6                 ;1997
000128  4630              MOV      r0,r6                 ;1998
00012a  e775              B        |L36.24|
                  |L36.300|
00012c  f44f7000          MOV      r0,#0x200             ;2000
000130  f7fffffe          BL       SDIO_GetFlagStatus
000134  b130              CBZ      r0,|L36.324|
000136  f44f7000          MOV      r0,#0x200             ;2002
00013a  f7fffffe          BL       SDIO_ClearFlag
00013e  2607              MOVS     r6,#7                 ;2003
000140  4630              MOV      r0,r6                 ;2004
000142  e769              B        |L36.24|
                  |L36.324|
000144  4d0b              LDR      r5,|L36.372|
000146  e004              B        |L36.338|
                  |L36.328|
000148  f7fffffe          BL       SDIO_ReadData
00014c  6020              STR      r0,[r4,#0]            ;2010
00014e  1d24              ADDS     r4,r4,#4              ;2011
000150  1e6d              SUBS     r5,r5,#1              ;2012
                  |L36.338|
000152  f44f1000          MOV      r0,#0x200000          ;2008
000156  f7fffffe          BL       SDIO_GetFlagStatus
00015a  b108              CBZ      r0,|L36.352|
00015c  2d00              CMP      r5,#0                 ;2008
00015e  d1f3              BNE      |L36.328|
                  |L36.352|
000160  f24050ff          MOV      r0,#0x5ff             ;2015
000164  f7fffffe          BL       SDIO_ClearFlag
000168  4630              MOV      r0,r6                 ;2017
00016a  e755              B        |L36.24|
;;;2019   
                          ENDP

                  |L36.364|
                          DCD      SDIO_CmdInitStructure
                  |L36.368|
                          DCD      ||RCA||
                  |L36.372|
                          DCD      0x000fffff
                  |L36.376|
                          DCD      SDIO_DataInitStructure
                  |L36.380|
                          DCD      0x40018000

                          AREA ||i.SD_SendStatus||, CODE, READONLY, ALIGN=2

                  SD_SendStatus PROC
;;;1872     */
;;;1873   SD_Error SD_SendStatus(uint32_t *pcardstatus)
000000  b570              PUSH     {r4-r6,lr}
;;;1874   {
000002  4604              MOV      r4,r0
;;;1875     SD_Error errorstatus = SD_OK;
000004  2500              MOVS     r5,#0
;;;1876   
;;;1877     if (pcardstatus == NULL)
000006  b914              CBNZ     r4,|L37.14|
;;;1878     {
;;;1879       errorstatus = SD_INVALID_PARAMETER;
000008  2526              MOVS     r5,#0x26
;;;1880       return(errorstatus);
00000a  4628              MOV      r0,r5
                  |L37.12|
;;;1881     }
;;;1882   
;;;1883     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) RCA << 16;
;;;1884     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SEND_STATUS;
;;;1885     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1886     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1887     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1888     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1889   
;;;1890     errorstatus = CmdResp1Error(SD_CMD_SEND_STATUS);
;;;1891   
;;;1892     if (errorstatus != SD_OK)
;;;1893     {
;;;1894       return(errorstatus);
;;;1895     }
;;;1896   
;;;1897     *pcardstatus = SDIO_GetResponse(SDIO_RESP1);
;;;1898   
;;;1899     return(errorstatus);
;;;1900   }
00000c  bd70              POP      {r4-r6,pc}
                  |L37.14|
00000e  480f              LDR      r0,|L37.76|
000010  8800              LDRH     r0,[r0,#0]            ;1883  ; RCA
000012  0400              LSLS     r0,r0,#16             ;1883
000014  490e              LDR      r1,|L37.80|
000016  6008              STR      r0,[r1,#0]            ;1883  ; SDIO_CmdInitStructure
000018  200d              MOVS     r0,#0xd               ;1884
00001a  6048              STR      r0,[r1,#4]            ;1884  ; SDIO_CmdInitStructure
00001c  2040              MOVS     r0,#0x40              ;1885
00001e  6088              STR      r0,[r1,#8]            ;1885  ; SDIO_CmdInitStructure
000020  2000              MOVS     r0,#0                 ;1886
000022  60c8              STR      r0,[r1,#0xc]          ;1886  ; SDIO_CmdInitStructure
000024  f44f6080          MOV      r0,#0x400             ;1887
000028  6108              STR      r0,[r1,#0x10]         ;1887  ; SDIO_CmdInitStructure
00002a  4608              MOV      r0,r1                 ;1888
00002c  f7fffffe          BL       SDIO_SendCommand
000030  200d              MOVS     r0,#0xd               ;1890
000032  f7fffffe          BL       CmdResp1Error
000036  4605              MOV      r5,r0                 ;1890
000038  b10d              CBZ      r5,|L37.62|
00003a  4628              MOV      r0,r5                 ;1894
00003c  e7e6              B        |L37.12|
                  |L37.62|
00003e  2000              MOVS     r0,#0                 ;1897
000040  f7fffffe          BL       SDIO_GetResponse
000044  6020              STR      r0,[r4,#0]            ;1897
000046  4628              MOV      r0,r5                 ;1899
000048  e7e0              B        |L37.12|
;;;1901   
                          ENDP

00004a  0000              DCW      0x0000
                  |L37.76|
                          DCD      ||RCA||
                  |L37.80|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_StopTransfer||, CODE, READONLY, ALIGN=2

                  SD_StopTransfer PROC
;;;1753     */
;;;1754   SD_Error SD_StopTransfer(void)
000000  b510              PUSH     {r4,lr}
;;;1755   {
;;;1756     SD_Error errorstatus = SD_OK;
000002  2400              MOVS     r4,#0
;;;1757   
;;;1758     /*!< Send CMD12 STOP_TRANSMISSION  */
;;;1759     SDIO_CmdInitStructure.SDIO_Argument = 0x0;
000004  2000              MOVS     r0,#0
000006  490a              LDR      r1,|L38.48|
000008  6008              STR      r0,[r1,#0]  ; SDIO_CmdInitStructure
;;;1760     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_STOP_TRANSMISSION;
00000a  200c              MOVS     r0,#0xc
00000c  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1761     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00000e  2040              MOVS     r0,#0x40
000010  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1762     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000012  2000              MOVS     r0,#0
000014  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1763     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000016  f44f6080          MOV      r0,#0x400
00001a  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1764     SDIO_SendCommand(&SDIO_CmdInitStructure);
00001c  4608              MOV      r0,r1
00001e  f7fffffe          BL       SDIO_SendCommand
;;;1765   
;;;1766     errorstatus = CmdResp1Error(SD_CMD_STOP_TRANSMISSION);
000022  200c              MOVS     r0,#0xc
000024  f7fffffe          BL       CmdResp1Error
000028  4604              MOV      r4,r0
;;;1767   
;;;1768     return(errorstatus);
00002a  4620              MOV      r0,r4
;;;1769   }
00002c  bd10              POP      {r4,pc}
;;;1770   
                          ENDP

00002e  0000              DCW      0x0000
                  |L38.48|
                          DCD      SDIO_CmdInitStructure

                          AREA ||i.SD_WaitReadOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitReadOperation PROC
;;;1391     */
;;;1392   SD_Error SD_WaitReadOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1393   {
;;;1394     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1395     uint32_t timeout;
;;;1396   
;;;1397     timeout = SD_DATATIMEOUT;
000004  4c19              LDR      r4,|L39.108|
;;;1398     
;;;1399     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L39.10|
                  |L39.8|
;;;1400     {
;;;1401       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L39.10|
00000a  4819              LDR      r0,|L39.112|
00000c  6800              LDR      r0,[r0,#0]            ;1399  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L39.32|
000010  4818              LDR      r0,|L39.116|
000012  6800              LDR      r0,[r0,#0]            ;1399  ; TransferEnd
000014  b920              CBNZ     r0,|L39.32|
000016  4818              LDR      r0,|L39.120|
000018  7800              LDRB     r0,[r0,#0]            ;1399  ; TransferError
00001a  b908              CBNZ     r0,|L39.32|
00001c  2c00              CMP      r4,#0                 ;1399
00001e  d1f3              BNE      |L39.8|
                  |L39.32|
;;;1402     }
;;;1403     
;;;1404     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4913              LDR      r1,|L39.112|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1405   
;;;1406     timeout = SD_DATATIMEOUT;
000026  4c11              LDR      r4,|L39.108|
;;;1407     
;;;1408     while(((SDIO->STA & SDIO_FLAG_RXACT)) && (timeout > 0))
000028  e000              B        |L39.44|
                  |L39.42|
;;;1409     {
;;;1410       timeout--;  
00002a  1e64              SUBS     r4,r4,#1
                  |L39.44|
00002c  4813              LDR      r0,|L39.124|
00002e  6b40              LDR      r0,[r0,#0x34]         ;1408
000030  f4005000          AND      r0,r0,#0x2000         ;1408
000034  b108              CBZ      r0,|L39.58|
000036  2c00              CMP      r4,#0                 ;1408
000038  d1f7              BNE      |L39.42|
                  |L39.58|
;;;1411     }
;;;1412   
;;;1413     if (StopCondition == 1)
00003a  4811              LDR      r0,|L39.128|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L39.78|
;;;1414     {
;;;1415   	  errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1416   	  StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490d              LDR      r1,|L39.128|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L39.78|
;;;1417     }
;;;1418     
;;;1419     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L39.84|
000050  b905              CBNZ     r5,|L39.84|
;;;1420     {
;;;1421       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L39.84|
;;;1422     }
;;;1423     
;;;1424     /*!< Clear all the static flags */
;;;1425     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1426   
;;;1427     if (TransferError != SD_OK)
00005c  4806              LDR      r0,|L39.120|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L39.104|
;;;1428     {
;;;1429       return(TransferError);
000062  4805              LDR      r0,|L39.120|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L39.102|
;;;1430     }
;;;1431     else
;;;1432     {
;;;1433       return(errorstatus);  
;;;1434     }
;;;1435   }
000066  bd70              POP      {r4-r6,pc}
                  |L39.104|
000068  4628              MOV      r0,r5                 ;1433
00006a  e7fc              B        |L39.102|
;;;1436   
                          ENDP

                  |L39.108|
                          DCD      0x000fffff
                  |L39.112|
                          DCD      DMAEndOfTransfer
                  |L39.116|
                          DCD      TransferEnd
                  |L39.120|
                          DCD      TransferError
                  |L39.124|
                          DCD      0x40018000
                  |L39.128|
                          DCD      StopCondition

                          AREA ||i.SD_WaitWriteOperation||, CODE, READONLY, ALIGN=2

                  SD_WaitWriteOperation PROC
;;;1683     */
;;;1684   SD_Error SD_WaitWriteOperation(void)
000000  b570              PUSH     {r4-r6,lr}
;;;1685   {
;;;1686     SD_Error errorstatus = SD_OK;
000002  2500              MOVS     r5,#0
;;;1687     uint32_t timeout;
;;;1688   
;;;1689     timeout = SD_DATATIMEOUT;
000004  4c19              LDR      r4,|L40.108|
;;;1690     
;;;1691     while ((DMAEndOfTransfer == 0x00) && (TransferEnd == 0) && (TransferError == SD_OK) && (timeout > 0))
000006  e000              B        |L40.10|
                  |L40.8|
;;;1692     {
;;;1693       timeout--;
000008  1e64              SUBS     r4,r4,#1
                  |L40.10|
00000a  4819              LDR      r0,|L40.112|
00000c  6800              LDR      r0,[r0,#0]            ;1691  ; DMAEndOfTransfer
00000e  b938              CBNZ     r0,|L40.32|
000010  4818              LDR      r0,|L40.116|
000012  6800              LDR      r0,[r0,#0]            ;1691  ; TransferEnd
000014  b920              CBNZ     r0,|L40.32|
000016  4818              LDR      r0,|L40.120|
000018  7800              LDRB     r0,[r0,#0]            ;1691  ; TransferError
00001a  b908              CBNZ     r0,|L40.32|
00001c  2c00              CMP      r4,#0                 ;1691
00001e  d1f3              BNE      |L40.8|
                  |L40.32|
;;;1694     }
;;;1695     
;;;1696     DMAEndOfTransfer = 0x00;
000020  2000              MOVS     r0,#0
000022  4913              LDR      r1,|L40.112|
000024  6008              STR      r0,[r1,#0]  ; DMAEndOfTransfer
;;;1697   
;;;1698     timeout = SD_DATATIMEOUT;
000026  4c11              LDR      r4,|L40.108|
;;;1699     
;;;1700     while(((SDIO->STA & SDIO_FLAG_TXACT)) && (timeout > 0))
000028  e000              B        |L40.44|
                  |L40.42|
;;;1701     {
;;;1702       timeout--;  
00002a  1e64              SUBS     r4,r4,#1
                  |L40.44|
00002c  4813              LDR      r0,|L40.124|
00002e  6b40              LDR      r0,[r0,#0x34]         ;1700
000030  f4005080          AND      r0,r0,#0x1000         ;1700
000034  b108              CBZ      r0,|L40.58|
000036  2c00              CMP      r4,#0                 ;1700
000038  d1f7              BNE      |L40.42|
                  |L40.58|
;;;1703     }
;;;1704   
;;;1705     if (StopCondition == 1)
00003a  4811              LDR      r0,|L40.128|
00003c  6800              LDR      r0,[r0,#0]  ; StopCondition
00003e  2801              CMP      r0,#1
000040  d105              BNE      |L40.78|
;;;1706     {
;;;1707       errorstatus = SD_StopTransfer();
000042  f7fffffe          BL       SD_StopTransfer
000046  4605              MOV      r5,r0
;;;1708   	StopCondition = 0;
000048  2000              MOVS     r0,#0
00004a  490d              LDR      r1,|L40.128|
00004c  6008              STR      r0,[r1,#0]  ; StopCondition
                  |L40.78|
;;;1709     }
;;;1710     
;;;1711     if ((timeout == 0) && (errorstatus == SD_OK))
00004e  b90c              CBNZ     r4,|L40.84|
000050  b905              CBNZ     r5,|L40.84|
;;;1712     {
;;;1713       errorstatus = SD_DATA_TIMEOUT;
000052  2504              MOVS     r5,#4
                  |L40.84|
;;;1714     }
;;;1715     
;;;1716     /*!< Clear all the static flags */
;;;1717     SDIO_ClearFlag(SDIO_STATIC_FLAGS);
000054  f24050ff          MOV      r0,#0x5ff
000058  f7fffffe          BL       SDIO_ClearFlag
;;;1718     
;;;1719     if (TransferError != SD_OK)
00005c  4806              LDR      r0,|L40.120|
00005e  7800              LDRB     r0,[r0,#0]  ; TransferError
000060  b110              CBZ      r0,|L40.104|
;;;1720     {
;;;1721       return(TransferError);
000062  4805              LDR      r0,|L40.120|
000064  7800              LDRB     r0,[r0,#0]  ; TransferError
                  |L40.102|
;;;1722     }
;;;1723     else
;;;1724     {
;;;1725       return(errorstatus);
;;;1726     }
;;;1727   }
000066  bd70              POP      {r4-r6,pc}
                  |L40.104|
000068  4628              MOV      r0,r5                 ;1725
00006a  e7fc              B        |L40.102|
;;;1728   
                          ENDP

                  |L40.108|
                          DCD      0x000fffff
                  |L40.112|
                          DCD      DMAEndOfTransfer
                  |L40.116|
                          DCD      TransferEnd
                  |L40.120|
                          DCD      TransferError
                  |L40.124|
                          DCD      0x40018000
                  |L40.128|
                          DCD      StopCondition

                          AREA ||i.SD_WriteBlock||, CODE, READONLY, ALIGN=2

                  SD_WriteBlock PROC
;;;1450     */
;;;1451   SD_Error SD_WriteBlock(uint8_t *writebuff, uint64_t WriteAddr, uint16_t BlockSize)
000000  e92d41f0          PUSH     {r4-r8,lr}
;;;1452   {
000004  4680              MOV      r8,r0
000006  4614              MOV      r4,r2
000008  461d              MOV      r5,r3
00000a  9e06              LDR      r6,[sp,#0x18]
;;;1453     SD_Error errorstatus = SD_OK;
00000c  2700              MOVS     r7,#0
;;;1454   
;;;1455   #if defined (SD_POLLING_MODE)
;;;1456     uint32_t bytestransferred = 0, count = 0, restwords = 0;
;;;1457     uint32_t *tempbuff = (uint32_t *)writebuff;
;;;1458   #endif
;;;1459   
;;;1460     TransferError = SD_OK;
00000e  2000              MOVS     r0,#0
000010  492f              LDR      r1,|L41.208|
000012  7008              STRB     r0,[r1,#0]
;;;1461     TransferEnd = 0;
000014  492f              LDR      r1,|L41.212|
000016  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1462     StopCondition = 0;
000018  492f              LDR      r1,|L41.216|
00001a  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1463     
;;;1464     SDIO->DCTRL = 0x0;
00001c  492f              LDR      r1,|L41.220|
00001e  62c8              STR      r0,[r1,#0x2c]
;;;1465   
;;;1466   
;;;1467     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000020  482f              LDR      r0,|L41.224|
000022  6800              LDR      r0,[r0,#0]  ; CardType
000024  2802              CMP      r0,#2
000026  d108              BNE      |L41.58|
;;;1468     {
;;;1469       BlockSize = 512;
000028  0206              LSLS     r6,r0,#8
;;;1470       WriteAddr /= 512;
00002a  0202              LSLS     r2,r0,#8
00002c  2300              MOVS     r3,#0
00002e  4620              MOV      r0,r4
000030  4629              MOV      r1,r5
000032  f7fffffe          BL       __aeabi_uldivmod
000036  4604              MOV      r4,r0
000038  460d              MOV      r5,r1
                  |L41.58|
;;;1471     }
;;;1472   
;;;1473     /* Set Block Size for Card */ 
;;;1474     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
00003a  482a              LDR      r0,|L41.228|
00003c  6006              STR      r6,[r0,#0]  ; SDIO_CmdInitStructure
;;;1475     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
00003e  2010              MOVS     r0,#0x10
000040  4928              LDR      r1,|L41.228|
000042  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1476     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
000044  2040              MOVS     r0,#0x40
000046  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1477     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
000048  2000              MOVS     r0,#0
00004a  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1478     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
00004c  f44f6080          MOV      r0,#0x400
000050  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1479     SDIO_SendCommand(&SDIO_CmdInitStructure);
000052  4608              MOV      r0,r1
000054  f7fffffe          BL       SDIO_SendCommand
;;;1480   
;;;1481     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
000058  2010              MOVS     r0,#0x10
00005a  f7fffffe          BL       CmdResp1Error
00005e  4607              MOV      r7,r0
;;;1482   
;;;1483     if (SD_OK != errorstatus)
000060  b117              CBZ      r7,|L41.104|
;;;1484     {
;;;1485       return(errorstatus);
000062  4638              MOV      r0,r7
                  |L41.100|
;;;1486     }
;;;1487       
;;;1488     /*!< Send CMD24 WRITE_SINGLE_BLOCK */
;;;1489     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)WriteAddr;
;;;1490     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_SINGLE_BLOCK;
;;;1491     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1492     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1493     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1494     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1495   
;;;1496     errorstatus = CmdResp1Error(SD_CMD_WRITE_SINGLE_BLOCK);
;;;1497   
;;;1498     if (errorstatus != SD_OK)
;;;1499     {
;;;1500       return(errorstatus);
;;;1501     }
;;;1502   
;;;1503     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1504     SDIO_DataInitStructure.SDIO_DataLength = BlockSize;
;;;1505     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1506     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1507     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1508     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1509     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1510   
;;;1511     /*!< In case of single data block transfer no need of stop command at all */
;;;1512   #if defined (SD_POLLING_MODE) 
;;;1513     while (!(SDIO->STA & (SDIO_FLAG_DBCKEND | SDIO_FLAG_TXUNDERR | SDIO_FLAG_DCRCFAIL | SDIO_FLAG_DTIMEOUT | SDIO_FLAG_STBITERR)))
;;;1514     {
;;;1515       if (SDIO_GetFlagStatus(SDIO_FLAG_TXFIFOHE) != RESET)
;;;1516       {
;;;1517         if ((512 - bytestransferred) < 32)
;;;1518         {
;;;1519           restwords = ((512 - bytestransferred) % 4 == 0) ? ((512 - bytestransferred) / 4) : (( 512 -  bytestransferred) / 4 + 1);
;;;1520           for (count = 0; count < restwords; count++, tempbuff++, bytestransferred += 4)
;;;1521           {
;;;1522             SDIO_WriteData(*tempbuff);
;;;1523           }
;;;1524         }
;;;1525         else
;;;1526         {
;;;1527           for (count = 0; count < 8; count++)
;;;1528           {
;;;1529             SDIO_WriteData(*(tempbuff + count));
;;;1530           }
;;;1531           tempbuff += 8;
;;;1532           bytestransferred += 32;
;;;1533         }
;;;1534       }
;;;1535     }
;;;1536     if (SDIO_GetFlagStatus(SDIO_FLAG_DTIMEOUT) != RESET)
;;;1537     {
;;;1538       SDIO_ClearFlag(SDIO_FLAG_DTIMEOUT);
;;;1539       errorstatus = SD_DATA_TIMEOUT;
;;;1540       return(errorstatus);
;;;1541     }
;;;1542     else if (SDIO_GetFlagStatus(SDIO_FLAG_DCRCFAIL) != RESET)
;;;1543     {
;;;1544       SDIO_ClearFlag(SDIO_FLAG_DCRCFAIL);
;;;1545       errorstatus = SD_DATA_CRC_FAIL;
;;;1546       return(errorstatus);
;;;1547     }
;;;1548     else if (SDIO_GetFlagStatus(SDIO_FLAG_TXUNDERR) != RESET)
;;;1549     {
;;;1550       SDIO_ClearFlag(SDIO_FLAG_TXUNDERR);
;;;1551       errorstatus = SD_TX_UNDERRUN;
;;;1552       return(errorstatus);
;;;1553     }
;;;1554     else if (SDIO_GetFlagStatus(SDIO_FLAG_STBITERR) != RESET)
;;;1555     {
;;;1556       SDIO_ClearFlag(SDIO_FLAG_STBITERR);
;;;1557       errorstatus = SD_START_BIT_ERR;
;;;1558       return(errorstatus);
;;;1559     }
;;;1560   #elif defined (SD_DMA_MODE)
;;;1561     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);
;;;1562     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, BlockSize);
;;;1563     SDIO_DMACmd(ENABLE);
;;;1564   #endif
;;;1565   
;;;1566     return(errorstatus);
;;;1567   }
000064  e8bd81f0          POP      {r4-r8,pc}
                  |L41.104|
000068  481e              LDR      r0,|L41.228|
00006a  6004              STR      r4,[r0,#0]            ;1489  ; SDIO_CmdInitStructure
00006c  2018              MOVS     r0,#0x18              ;1490
00006e  491d              LDR      r1,|L41.228|
000070  6048              STR      r0,[r1,#4]            ;1490  ; SDIO_CmdInitStructure
000072  2040              MOVS     r0,#0x40              ;1491
000074  6088              STR      r0,[r1,#8]            ;1491  ; SDIO_CmdInitStructure
000076  2000              MOVS     r0,#0                 ;1492
000078  60c8              STR      r0,[r1,#0xc]          ;1492  ; SDIO_CmdInitStructure
00007a  f44f6080          MOV      r0,#0x400             ;1493
00007e  6108              STR      r0,[r1,#0x10]         ;1493  ; SDIO_CmdInitStructure
000080  4608              MOV      r0,r1                 ;1494
000082  f7fffffe          BL       SDIO_SendCommand
000086  2018              MOVS     r0,#0x18              ;1496
000088  f7fffffe          BL       CmdResp1Error
00008c  4607              MOV      r7,r0                 ;1496
00008e  b10f              CBZ      r7,|L41.148|
000090  4638              MOV      r0,r7                 ;1500
000092  e7e7              B        |L41.100|
                  |L41.148|
000094  4814              LDR      r0,|L41.232|
000096  4915              LDR      r1,|L41.236|
000098  6008              STR      r0,[r1,#0]            ;1503  ; SDIO_DataInitStructure
00009a  4608              MOV      r0,r1                 ;1504
00009c  6046              STR      r6,[r0,#4]            ;1504  ; SDIO_DataInitStructure
00009e  2090              MOVS     r0,#0x90              ;1505
0000a0  6088              STR      r0,[r1,#8]            ;1505  ; SDIO_DataInitStructure
0000a2  2000              MOVS     r0,#0                 ;1506
0000a4  60c8              STR      r0,[r1,#0xc]          ;1506  ; SDIO_DataInitStructure
0000a6  6108              STR      r0,[r1,#0x10]         ;1507  ; SDIO_DataInitStructure
0000a8  2001              MOVS     r0,#1                 ;1508
0000aa  6148              STR      r0,[r1,#0x14]         ;1508  ; SDIO_DataInitStructure
0000ac  4608              MOV      r0,r1                 ;1509
0000ae  f7fffffe          BL       SDIO_DataConfig
0000b2  2101              MOVS     r1,#1                 ;1561
0000b4  f240302a          MOV      r0,#0x32a             ;1561
0000b8  f7fffffe          BL       SDIO_ITConfig
0000bc  4631              MOV      r1,r6                 ;1562
0000be  4640              MOV      r0,r8                 ;1562
0000c0  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
0000c4  2001              MOVS     r0,#1                 ;1563
0000c6  f7fffffe          BL       SDIO_DMACmd
0000ca  4638              MOV      r0,r7                 ;1566
0000cc  e7ca              B        |L41.100|
;;;1568   
                          ENDP

0000ce  0000              DCW      0x0000
                  |L41.208|
                          DCD      TransferError
                  |L41.212|
                          DCD      TransferEnd
                  |L41.216|
                          DCD      StopCondition
                  |L41.220|
                          DCD      0x40018000
                  |L41.224|
                          DCD      CardType
                  |L41.228|
                          DCD      SDIO_CmdInitStructure
                  |L41.232|
                          DCD      0x000fffff
                  |L41.236|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.SD_WriteMultiBlocks||, CODE, READONLY, ALIGN=2

                  SD_WriteMultiBlocks PROC
;;;1583     */
;;;1584   SD_Error SD_WriteMultiBlocks(uint8_t *writebuff, uint64_t WriteAddr, uint16_t BlockSize, uint32_t NumberOfBlocks)
000000  e92d47f0          PUSH     {r4-r10,lr}
;;;1585   {
000004  4681              MOV      r9,r0
000006  4615              MOV      r5,r2
000008  461e              MOV      r6,r3
00000a  e9dd7808          LDRD     r7,r8,[sp,#0x20]
;;;1586     SD_Error errorstatus = SD_OK;
00000e  2400              MOVS     r4,#0
;;;1587   
;;;1588     TransferError = SD_OK;
000010  2000              MOVS     r0,#0
000012  4949              LDR      r1,|L42.312|
000014  7008              STRB     r0,[r1,#0]
;;;1589     TransferEnd = 0;
000016  4949              LDR      r1,|L42.316|
000018  6008              STR      r0,[r1,#0]  ; TransferEnd
;;;1590     StopCondition = 1;
00001a  2001              MOVS     r0,#1
00001c  4948              LDR      r1,|L42.320|
00001e  6008              STR      r0,[r1,#0]  ; StopCondition
;;;1591     
;;;1592     SDIO->DCTRL = 0x0;
000020  2000              MOVS     r0,#0
000022  4948              LDR      r1,|L42.324|
000024  62c8              STR      r0,[r1,#0x2c]
;;;1593   
;;;1594     if (CardType == SDIO_HIGH_CAPACITY_SD_CARD)
000026  4848              LDR      r0,|L42.328|
000028  6800              LDR      r0,[r0,#0]  ; CardType
00002a  2802              CMP      r0,#2
00002c  d108              BNE      |L42.64|
;;;1595     {
;;;1596       BlockSize = 512;
00002e  0207              LSLS     r7,r0,#8
;;;1597       WriteAddr /= 512;
000030  0202              LSLS     r2,r0,#8
000032  2300              MOVS     r3,#0
000034  4628              MOV      r0,r5
000036  4631              MOV      r1,r6
000038  f7fffffe          BL       __aeabi_uldivmod
00003c  4605              MOV      r5,r0
00003e  460e              MOV      r6,r1
                  |L42.64|
;;;1598     }
;;;1599   
;;;1600     /* Set Block Size for Card */ 
;;;1601     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) BlockSize;
000040  4842              LDR      r0,|L42.332|
000042  6007              STR      r7,[r0,#0]  ; SDIO_CmdInitStructure
;;;1602     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCKLEN;
000044  2010              MOVS     r0,#0x10
000046  4941              LDR      r1,|L42.332|
000048  6048              STR      r0,[r1,#4]  ; SDIO_CmdInitStructure
;;;1603     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
00004a  2040              MOVS     r0,#0x40
00004c  6088              STR      r0,[r1,#8]  ; SDIO_CmdInitStructure
;;;1604     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
00004e  2000              MOVS     r0,#0
000050  60c8              STR      r0,[r1,#0xc]  ; SDIO_CmdInitStructure
;;;1605     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
000052  f44f6080          MOV      r0,#0x400
000056  6108              STR      r0,[r1,#0x10]  ; SDIO_CmdInitStructure
;;;1606     SDIO_SendCommand(&SDIO_CmdInitStructure);
000058  4608              MOV      r0,r1
00005a  f7fffffe          BL       SDIO_SendCommand
;;;1607   
;;;1608     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCKLEN);
00005e  2010              MOVS     r0,#0x10
000060  f7fffffe          BL       CmdResp1Error
000064  4604              MOV      r4,r0
;;;1609   
;;;1610     if (SD_OK != errorstatus)
000066  b114              CBZ      r4,|L42.110|
;;;1611     {
;;;1612       return(errorstatus);
000068  4620              MOV      r0,r4
                  |L42.106|
;;;1613     }
;;;1614     
;;;1615     /*!< To improve performance */
;;;1616     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t) (RCA << 16);
;;;1617     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_APP_CMD;
;;;1618     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1619     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1620     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1621     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1622   
;;;1623   
;;;1624     errorstatus = CmdResp1Error(SD_CMD_APP_CMD);
;;;1625   
;;;1626     if (errorstatus != SD_OK)
;;;1627     {
;;;1628       return(errorstatus);
;;;1629     }
;;;1630     /*!< To improve performance */
;;;1631     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)NumberOfBlocks;
;;;1632     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_SET_BLOCK_COUNT;
;;;1633     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1634     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1635     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1636     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1637   
;;;1638     errorstatus = CmdResp1Error(SD_CMD_SET_BLOCK_COUNT);
;;;1639   
;;;1640     if (errorstatus != SD_OK)
;;;1641     {
;;;1642       return(errorstatus);
;;;1643     }
;;;1644   
;;;1645   
;;;1646     /*!< Send CMD25 WRITE_MULT_BLOCK with argument data address */
;;;1647     SDIO_CmdInitStructure.SDIO_Argument = (uint32_t)WriteAddr;
;;;1648     SDIO_CmdInitStructure.SDIO_CmdIndex = SD_CMD_WRITE_MULT_BLOCK;
;;;1649     SDIO_CmdInitStructure.SDIO_Response = SDIO_Response_Short;
;;;1650     SDIO_CmdInitStructure.SDIO_Wait = SDIO_Wait_No;
;;;1651     SDIO_CmdInitStructure.SDIO_CPSM = SDIO_CPSM_Enable;
;;;1652     SDIO_SendCommand(&SDIO_CmdInitStructure);
;;;1653   
;;;1654     errorstatus = CmdResp1Error(SD_CMD_WRITE_MULT_BLOCK);
;;;1655   
;;;1656     if (SD_OK != errorstatus)
;;;1657     {
;;;1658       return(errorstatus);
;;;1659     }
;;;1660   
;;;1661     SDIO_DataInitStructure.SDIO_DataTimeOut = SD_DATATIMEOUT;
;;;1662     SDIO_DataInitStructure.SDIO_DataLength = NumberOfBlocks * BlockSize;
;;;1663     SDIO_DataInitStructure.SDIO_DataBlockSize = (uint32_t) 9 << 4;
;;;1664     SDIO_DataInitStructure.SDIO_TransferDir = SDIO_TransferDir_ToCard;
;;;1665     SDIO_DataInitStructure.SDIO_TransferMode = SDIO_TransferMode_Block;
;;;1666     SDIO_DataInitStructure.SDIO_DPSM = SDIO_DPSM_Enable;
;;;1667     SDIO_DataConfig(&SDIO_DataInitStructure);
;;;1668   
;;;1669     SDIO_ITConfig(SDIO_IT_DCRCFAIL | SDIO_IT_DTIMEOUT | SDIO_IT_DATAEND | SDIO_IT_RXOVERR | SDIO_IT_STBITERR, ENABLE);  
;;;1670     SD_LowLevel_DMA_TxConfig((uint32_t *)writebuff, (NumberOfBlocks * BlockSize));
;;;1671     SDIO_DMACmd(ENABLE);
;;;1672     
;;;1673     return(errorstatus);
;;;1674   }
00006a  e8bd87f0          POP      {r4-r10,pc}
                  |L42.110|
00006e  4838              LDR      r0,|L42.336|
000070  8800              LDRH     r0,[r0,#0]            ;1616  ; RCA
000072  0400              LSLS     r0,r0,#16             ;1616
000074  4935              LDR      r1,|L42.332|
000076  6008              STR      r0,[r1,#0]            ;1616  ; SDIO_CmdInitStructure
000078  2037              MOVS     r0,#0x37              ;1617
00007a  6048              STR      r0,[r1,#4]            ;1617  ; SDIO_CmdInitStructure
00007c  2040              MOVS     r0,#0x40              ;1618
00007e  6088              STR      r0,[r1,#8]            ;1618  ; SDIO_CmdInitStructure
000080  2000              MOVS     r0,#0                 ;1619
000082  60c8              STR      r0,[r1,#0xc]          ;1619  ; SDIO_CmdInitStructure
000084  f44f6080          MOV      r0,#0x400             ;1620
000088  6108              STR      r0,[r1,#0x10]         ;1620  ; SDIO_CmdInitStructure
00008a  4608              MOV      r0,r1                 ;1621
00008c  f7fffffe          BL       SDIO_SendCommand
000090  2037              MOVS     r0,#0x37              ;1624
000092  f7fffffe          BL       CmdResp1Error
000096  4604              MOV      r4,r0                 ;1624
000098  b10c              CBZ      r4,|L42.158|
00009a  4620              MOV      r0,r4                 ;1628
00009c  e7e5              B        |L42.106|
                  |L42.158|
00009e  482b              LDR      r0,|L42.332|
0000a0  f8c08000          STR      r8,[r0,#0]            ;1631  ; SDIO_CmdInitStructure
0000a4  2017              MOVS     r0,#0x17              ;1632
0000a6  4929              LDR      r1,|L42.332|
0000a8  6048              STR      r0,[r1,#4]            ;1632  ; SDIO_CmdInitStructure
0000aa  2040              MOVS     r0,#0x40              ;1633
0000ac  6088              STR      r0,[r1,#8]            ;1633  ; SDIO_CmdInitStructure
0000ae  2000              MOVS     r0,#0                 ;1634
0000b0  60c8              STR      r0,[r1,#0xc]          ;1634  ; SDIO_CmdInitStructure
0000b2  f44f6080          MOV      r0,#0x400             ;1635
0000b6  6108              STR      r0,[r1,#0x10]         ;1635  ; SDIO_CmdInitStructure
0000b8  4608              MOV      r0,r1                 ;1636
0000ba  f7fffffe          BL       SDIO_SendCommand
0000be  2017              MOVS     r0,#0x17              ;1638
0000c0  f7fffffe          BL       CmdResp1Error
0000c4  4604              MOV      r4,r0                 ;1638
0000c6  b10c              CBZ      r4,|L42.204|
0000c8  4620              MOV      r0,r4                 ;1642
0000ca  e7ce              B        |L42.106|
                  |L42.204|
0000cc  481f              LDR      r0,|L42.332|
0000ce  6005              STR      r5,[r0,#0]            ;1647  ; SDIO_CmdInitStructure
0000d0  2019              MOVS     r0,#0x19              ;1648
0000d2  491e              LDR      r1,|L42.332|
0000d4  6048              STR      r0,[r1,#4]            ;1648  ; SDIO_CmdInitStructure
0000d6  2040              MOVS     r0,#0x40              ;1649
0000d8  6088              STR      r0,[r1,#8]            ;1649  ; SDIO_CmdInitStructure
0000da  2000              MOVS     r0,#0                 ;1650
0000dc  60c8              STR      r0,[r1,#0xc]          ;1650  ; SDIO_CmdInitStructure
0000de  f44f6080          MOV      r0,#0x400             ;1651
0000e2  6108              STR      r0,[r1,#0x10]         ;1651  ; SDIO_CmdInitStructure
0000e4  4608              MOV      r0,r1                 ;1652
0000e6  f7fffffe          BL       SDIO_SendCommand
0000ea  2019              MOVS     r0,#0x19              ;1654
0000ec  f7fffffe          BL       CmdResp1Error
0000f0  4604              MOV      r4,r0                 ;1654
0000f2  b10c              CBZ      r4,|L42.248|
0000f4  4620              MOV      r0,r4                 ;1658
0000f6  e7b8              B        |L42.106|
                  |L42.248|
0000f8  4816              LDR      r0,|L42.340|
0000fa  4917              LDR      r1,|L42.344|
0000fc  6008              STR      r0,[r1,#0]            ;1661  ; SDIO_DataInitStructure
0000fe  fb08f007          MUL      r0,r8,r7              ;1662
000102  6048              STR      r0,[r1,#4]            ;1662  ; SDIO_DataInitStructure
000104  2090              MOVS     r0,#0x90              ;1663
000106  6088              STR      r0,[r1,#8]            ;1663  ; SDIO_DataInitStructure
000108  2000              MOVS     r0,#0                 ;1664
00010a  60c8              STR      r0,[r1,#0xc]          ;1664  ; SDIO_DataInitStructure
00010c  6108              STR      r0,[r1,#0x10]         ;1665  ; SDIO_DataInitStructure
00010e  2001              MOVS     r0,#1                 ;1666
000110  6148              STR      r0,[r1,#0x14]         ;1666  ; SDIO_DataInitStructure
000112  4608              MOV      r0,r1                 ;1667
000114  f7fffffe          BL       SDIO_DataConfig
000118  2101              MOVS     r1,#1                 ;1669
00011a  f240302a          MOV      r0,#0x32a             ;1669
00011e  f7fffffe          BL       SDIO_ITConfig
000122  fb08f107          MUL      r1,r8,r7              ;1670
000126  4648              MOV      r0,r9                 ;1670
000128  f7fffffe          BL       SD_LowLevel_DMA_TxConfig
00012c  2001              MOVS     r0,#1                 ;1671
00012e  f7fffffe          BL       SDIO_DMACmd
000132  4620              MOV      r0,r4                 ;1673
000134  e799              B        |L42.106|
;;;1675   
                          ENDP

000136  0000              DCW      0x0000
                  |L42.312|
                          DCD      TransferError
                  |L42.316|
                          DCD      TransferEnd
                  |L42.320|
                          DCD      StopCondition
                  |L42.324|
                          DCD      0x40018000
                  |L42.328|
                          DCD      CardType
                  |L42.332|
                          DCD      SDIO_CmdInitStructure
                  |L42.336|
                          DCD      ||RCA||
                  |L42.340|
                          DCD      0x000fffff
                  |L42.344|
                          DCD      SDIO_DataInitStructure

                          AREA ||i.convert_from_bytes_to_power_of_two||, CODE, READONLY, ALIGN=1

                  convert_from_bytes_to_power_of_two PROC
;;;2813     */
;;;2814   uint8_t convert_from_bytes_to_power_of_two(uint16_t NumberOfBytes)
000000  4601              MOV      r1,r0
;;;2815   {
;;;2816     uint8_t count = 0;
000002  2000              MOVS     r0,#0
;;;2817   
;;;2818     while (NumberOfBytes != 1)
000004  e002              B        |L43.12|
                  |L43.6|
;;;2819     {
;;;2820       NumberOfBytes >>= 1;
000006  1049              ASRS     r1,r1,#1
;;;2821       count++;
000008  1c42              ADDS     r2,r0,#1
00000a  b2d0              UXTB     r0,r2
                  |L43.12|
00000c  2901              CMP      r1,#1                 ;2818
00000e  d1fa              BNE      |L43.6|
;;;2822     }
;;;2823     return(count);
;;;2824   }
000010  4770              BX       lr
;;;2825   
                          ENDP


                          AREA ||.bss||, DATA, NOINIT, ALIGN=3

                  CSD_Tab
                          %        16
                  CID_Tab
                          %        16
                  SDSTATUS_Tab
                          %        16
                  SDCardInfo
                          %        88
                  SDIO_InitStructure
                          %        24
                  SDIO_CmdInitStructure
                          %        20
                  SDIO_DataInitStructure
                          %        24

                          AREA ||.data||, DATA, ALIGN=2

                  CardType
                          DCD      0x00000000
                  ||RCA||
                          DCD      0x00000000
                  StopCondition
                          DCD      0x00000000
                  TransferError
00000c  00000000          DCB      0x00,0x00,0x00,0x00
                  TransferEnd
                          DCD      0x00000000
                  DMAEndOfTransfer
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\..\\User\\bsp\\src\\bsp_sdio_sd.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REV16|
#line 114 "..\\..\\Libraries\\CMSIS\\Include\\core_cmInstr.h"
|__asm___13_bsp_sdio_sd_c_70335e9e____REV16| PROC
#line 115

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___13_bsp_sdio_sd_c_70335e9e____REVSH|
#line 128
|__asm___13_bsp_sdio_sd_c_70335e9e____REVSH| PROC
#line 129

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***
